/*! soon-ui 2020-11-18 */

!function(a,b){function c(){}function d(b){this.classEventMap=new a.KeyArray,this.exclusiveFlag={},this.length=this.classEventMap.length,this.eventName=b||"NONE"}function e(c){return!c||a.core.isJQueryObject(c)?c:b(c)}function f(){var a,b,c,d;for(a={},c=0,d=arguments.length;c<d;c++)b=arguments[c],Array.isArray(b)&&b.forEach(function(b){a.hasOwnProperty(b)||(a[b]=!0)});return Object.keys(a)}function g(b,c,d){var e,g,h;return a.core.isString(b)&&0!==b.length?(e=b.indexOf("."),e<0?b="ui.ctrls."+b:"ui"!==b.substring(0,e)&&(b="ui."+b),d||(d=c,c=a.ctrls.ControlBase),g=a.define(b,c,d),h=a.core.isFunction(c)?c.prototype:c,a.core.isFunction(h._defineOption)&&(g.prototype.option=a.extend(!0,{},h.option,h._defineOption())),a.core.isFunction(h._defineEvents)&&(g.prototype.events=f(h._defineEvents(),h.events)),g):null}a.ctrls={},d.prototype={getClassNames:function(){return this.classEventMap.keys()},call:function(a){var b=Array.prototype.slice.call(arguments,1),c=this.classEventMap.get(a);Array.isArray(c)?c.forEach(function(a){a.apply(null,b)}):c.apply(null,b)},add:function(b,c,d,e){var f;if(!a.core.isFunction(c))throw new TypeError("the delegate event handler is not a function.");f=this.classEventMap.get(b),d&&(Array.isArray(f)?(f.push(c),c=f):a.core.isFunction(f)&&(c=[f,c])),this.classEventMap.set(b,c),this.exclusiveFlag[b]=void 0===e||!!e,this.length=this.classEventMap.length},remove:function(b,c){var d;a.core.isFunction(c)?(d=this.classEventMap.get(b),Array.isArray(d)?this.classEventMap.set(b,d.filter(function(a){return a===c})):this.classEventMap.remove(b)):this.classEventMap.remove(b),this.length=this.classEventMap.length},has:function(a){return this.classEventMap.containsKey(a)},getDelegateHandler:function(c){var d=this;return a.core.isFunction(c)||(c=function(){return!1}),function(a){var e,f,g,h=b(a.target),i=d.length;if(0!==i)for(e=d.getClassNames();;){if(0===h.length||c(h))return;for(g=0;g<i;g++)if(f=e[g],h.hasClass(f)&&(d.call(f,a,h),d.exclusiveFlag[f]))return;h=h.parent()}}}},a.define("ui.ctrls.ControlBase",{version:a.version,i18n:function(){return a.i18n("control",this.toString())},_initialize:function(b,c){var d,g,h;return this.document=document,this.window=window,this.element=e(c)||null,this.constructor&&this.constructor.prototype&&(g=this.constructor.prototype.option,h=this.constructor.prototype.events),this.option=a.extend(!0,{},g,this._defineOption(),b)||{},d=f(h,this._defineEvents()),d.length>0&&(this.eventDispatcher=new a.CustomEvent(this),this.eventDispatcher.initEvents(d)),this._create(),this._render(),this},_defineOption:c,_defineEvents:c,_create:c,_render:c,defineProperty:function(b,c,d){var e,f={};if(!a.core.isString(b)||0===b.length)throw new TypeError("参数propertyName只能是String类型并且不能为空");if("undefined"!=typeof Reflect&&a.core.isFunction(Reflect.defineProperty))e=Reflect.defineProperty;else{if(!a.core.isFunction(Object.defineProperty))return;e=Object.defineProperty}a.core.isFunction(c)&&(f.get=c.bind(this)),a.core.isFunction(d)&&(f.set=d.bind(this)),f.enumerable=!1,f.configurable=!1,e(this,b,f)},createClassEventDelegate:function(a){return new d},toString:function(){return this.fullName}}),a.ctrls.define=g}(ui,ui.$),function(a,b){function c(a){var b,c;if(0!==i.length){for(c=[];;){if(!(b=i.shift()))break;a&&a===b.ctrl||"retain"===b.func.call(b.ctrl)&&c.push(b)}i.push.apply(i,c)}}function d(a,b,c,d,e,f){var g,h,i,j,k;return g={top:d,left:0},g.topOffset=-d,h=b.parent().position(),"hidden"===a.css("overflow")?(i=a.width(),j=a.height()):(k=a[0],i=k.scrollWidth,j=k.scrollHeight,i+=k.scrollLeft,j+=k.scrollTop),h.top+d+f>j?h.top-f>0&&(g.top=-f-1,g.topOffset=d):g.top+=1,h.left+e>i&&(h.left-(h.left+e-i)>0?g.left=-(h.left+e-i):g.left=-h.left),g}function e(a){var b=this.element.width(),c=parseFloat(this.element.css("padding-right"))||0,d=a.offsetX;d||(d=a.clientX-this.element.offset().left),b-c-d<0&&this.isShow()?(this.element.css("cursor","pointer"),this._clearable=!0):(this.element.css("cursor","auto"),this._clearable=!1)}function f(b){var c,d,e;this._clearable&&(c=this.element.width(),d=parseFloat(this.element.css("padding-right"))||0,e=b.offsetX,e||(e=b.clientX-this.element.offset().left),c-d-e<0&&a.core.isFunction(this._clear)&&this._clear())}function g(b){a.hideAll(this),this.show()}function h(a){a.stopPropagation()}var i=[];a.page.htmlclick(function(a,d){var e=b(d);e.isNodeName("body")||e.hasClass("cancel-dropdown-html-click")||c()}),a.addHideHandler=function(b,c){b&&a.core.isFunction(c)&&i.push({ctrl:b,func:c})},a.hideAll=function(a){c(a)},a.ctrls.define("ui.ctrls.DropDownBase",{_create:function(){this.setLayoutPanel(this.option.layoutPanel),this.onMousemoveHandler=e.bind(this),this.onMouseupHandler=f.bind(this),this.fadeAnimator=a.animator({ease:a.AnimationStyle.easeFromTo,onChange:function(a){this.target.css("opacity",a/100)}}).add({ease:a.AnimationStyle.easeFromTo,onChange:function(a){this.target.css("transform","translateY("+a+"px)")}}),this.fadeAnimator.duration=240},_render:function(b){var c;this.element&&(b||(b={focus:g.bind(this)}),a.core.isFunction(b.click)||(b.click=h),c=this,Object.keys(b).forEach(function(a){c.element.on(a,b[a])}))},wrapElement:function(a,c){if(c&&(this._panel=c,!this.hasLayoutPanel()))return void b(document.body).append(this._panel);if(a){var d={display:a.css("display"),position:a.css("position"),"margin-left":a.css("margin-left"),"margin-top":a.css("margin-top"),"margin-right":a.css("margin-right"),"margin-bottom":a.css("margin-bottom"),width:a[0].offsetWidth+"px",height:a[0].offsetHeight+"px"};"relative"!==d.position&&"absolute"!==d.position||(d.top=a.css("top"),d.left=a.css("left"),d.right=a.css("right"),d.bottom=a.css("bottom")),d.position="relative",0===d.display.indexOf("inline")?(d.display="inline-block",d["vertical-align"]=a.css("vertical-align"),a.css("vertical-align","top")):d.display="block";var e=b("<div class='dropdown-wrap cancel-dropdown-html-click' />").css(d);return a.css("margin",0).wrap(e),e=a.parent(),c&&e.append(c),e}},isWrapped:function(a){return a||(a=this.element),a&&a.parent().hasClass("dropdown-wrap")},moveToElement:function(a,c){if(a){var d;!c&&this.element&&this.element[0]===a[0]||(this.hasLayoutPanel()?(d=this.isWrapped(a)?a.parent():this.wrapElement(a),d.append(this._panel)):b(document.body).append(this._panel))}},initPanelWidth:function(b){a.core.isNumber(b)||(b=this.element?this.element.getBoundingClientRect().width:100),this.panelWidth=b-2,this._panel.css("width",this.panelWidth+"px")},hasLayoutPanel:function(){return!!this.layoutPanel},setLayoutPanel:function(b){this.option.layoutPanel=b,this.layoutPanel=a.getJQueryElement(this.option.layoutPanel)},isShow:function(){return this._panel.hasClass(this._showClass)},show:function(b){a.addHideHandler(this,this.hide);var c,e,f,g,h,i,j;this.isShow()||(this._panel.addClass(this._showClass),this._panel.css("opacity","0"),h=this.element.getBoundingClientRect(),f=h.width,g=h.height,h=this._panel.getBoundingClientRect(),c=h.width,e=h.height,this.hasLayoutPanel()?i=d(this.layoutPanel,this.element,f,g,c,e):(i=a.getDownLocation(this.element,c,e),i.topOffset=-g,j=this.element.offset(),i.top<j.top?(i.top-=1,i.topOffset=g):i.top+=1),this._panel.css({top:i.top+"px",left:i.left+"px",transform:"translateY("+i.topOffset+"px)"}),this.panelLocation=i,this._show(this._panel,b))},_show:function(b,c){var d,e,f=this;a.core.isFunction(c)||(c=void 0),d=this._clearClass?function(){f.element.addClass(f._clearClass),f.element.on("mousemove",f.onMousemoveHandler),f.element.on("mouseup",f.onMouseupHandler),c&&c.call(f)}:c,this.fadeAnimator.stop(),e=this.fadeAnimator[0],e.target=b,e.begin=100*parseFloat(e.target.css("opacity"))||0,e.end=100,e=this.fadeAnimator[1],e.target=b,e.begin=this.panelLocation.topOffset,e.end=0,b.css("display","block").addClass("cancel-dropdown-html-click"),this.fadeAnimator.onEnd=d,this.fadeAnimator.start().then(function(){b.removeClass("cancel-dropdown-html-click")})},hide:function(a){this.isShow()&&(this._panel.removeClass(this._showClass),this.element.removeClass(this._clearClass),this.element.off("mousemove",this.onMousemoveHandler),this.element.off("mouseup",this.onMouseupHandler),this.element.css("cursor","auto"),this._hide(this._panel,a))},_hide:function(b,c){var d;a.core.isFunction(c)||(c=void 0),this.fadeAnimator.stop(),d=this.fadeAnimator[0],d.target=b,d.begin=100*parseFloat(d.target.css("opacity"))||100,d.end=0,d=this.fadeAnimator[1],d.target=b,d.begin=0,d.end=this.panelLocation.topOffset,this.fadeAnimator.onEnd=c,this.fadeAnimator.start().then(function(a){d.target.css("display","none")})},_clear:function(){}})}(ui,ui.$),function(a,b){a.ctrls.define("ui.ctrls.SidebarBase",{showTimeValue:300,hideTimeValue:300,_defineOption:function(){return{parent:null,width:240,hasCloseButton:!0}},_defineEvents:function(){return["showing","shown","hiding","hidden","resize"]},_create:function(){this.parent=a.getJQueryElement(this.option.parent),this.parent||(this.parent=b(document.body)),this._showClass="ui-sidebar-show",this.height=0,this.width=this.option.width||240,this.borderWidth=0},_render:function(){var c=this;this._panel=b("<aside class='ui-sidebar-panel border-highlight' />"),this._panel.css("width",this.width+"px"),this.option.hasCloseButton&&(this._closeButton=b("<button class='ui-side-close-button font-highlight-hover' />"),this._closeButton.append("<i class='far fa-angle-right'></i>"),this._closeButton.on("click",function(a){c.hide()})),this.element&&this._panel.append(this.element),this._panel.append(this._closeButton),this.parent.append(this._panel),this.borderWidth+=parseInt(this._panel.css("border-left-width"),10)||0,this.borderWidth+=parseInt(this._panel.css("border-right-width"),10)||0,setTimeout(function(){var a=this.width;this.width=0,c.setSize(a,this.parent.height())}.bind(this)),a.page.resize(function(){c.setSize(this.width,this.parent.height())}.bind(this),a.eventPriority.ctrlResize),this.animator=a.animator({target:this._panel,ease:a.AnimationStyle.easeTo,onChange:function(a){this.target.css("left",a+"px")}})},set:function(c){if(this.element&&this.element.remove(),a.core.isDomObject(c))c=b(c);else if(!a.core.isJQueryObject(c))return;this.element=c,this._closeButton.before(c)},append:function(c){if(a.core.isDomObject(c))c=b(c);else if(!a.core.isJQueryObject(c))return;this._panel.append(c),this.element||(this.element=c)},setSize:function(b,c,d){var e,f=this.width,g=this.height,h={};a.core.isNumber(b)&&b>0&&b!==f&&(this.width=b,h.width=b+"px"),a.core.isNumber(c)&&c>0&&c!==g&&(this.height=c,h.height=c+"px"),(h.width||h.height)&&(this._panel.css(h),h.width&&(e=this.parent.width(),this.hideLeft=e,this.left=e-this.width-this.borderWidth,this.isShow()?this._panel.css({left:this.left+"px",display:"block"}):this._panel.css({left:this.hideLeft+"px",display:"none"})),!1!==d&&this.fire("resize",this.width,this.height))},isShow:function(){return this._panel.hasClass(this._showClass)},show:function(){var b,c,d,e=this;if(!this.isShow()){if(!1===this.fire("showing"))return a.PromiseEmpty;for(this.animator.stop(),this.animator.splice(1,this.length-1),this.animator.duration=this.showTimeValue,b=this.animator[0],b.target.css("display","block"),b.target.addClass(this._showClass),b.begin=parseFloat(b.target.css("left"))||this.hideLeft,b.end=this.left,c=0,d=arguments.length;c<d;c++)arguments[c]&&this.animator.add(arguments[c]);return this.animator.onEnd=function(){this.splice(1,this.length-1),e.fire("shown")},this.animator.start()}return a.PromiseEmpty},hide:function(){var b,c,d,e=this;if(this.isShow()){if(!1===this.fire("hiding"))return a.PromiseEmpty;for(this.animator.stop(),this.animator.splice(1,this.length-1),this.animator.duration=this.hideTimeValue,b=this.animator[0],b.target.removeClass(this._showClass),b.begin=parseFloat(b.target.css("left"))||this.left,b.end=this.hideLeft,c=0,d=arguments.length;c<d;c++)arguments[c]&&this.animator.add(arguments[c]);return this.animator.onEnd=function(){this.splice(1,this.length-1),b.target.css("display","none"),e.fire("hidden")},this.animator.start()}return a.PromiseEmpty}})}(ui,ui.$),function(a,b){function c(){}function d(a){return a<10?"0"+a:""+a}function e(b,c){return b||(b=""),a.core.isNumber(c)?"<span>"+a.str.moneyFormat(c,b)+"</span>":null}function f(b){return a.date.parseJSON(b)}var g,h,i,j="_RowspanContext";new Error("column.len或width设置太小，无法绘制进度条！");g={checkAll:function(a){var c=b("<i class='fa fa-square grid-checkbox-all' />");return this.columnResetter.add(function(){c.removeClass("fa-check-square").addClass("fa-square")}),c},columnText:function(a){var c=b("<span class='table-cell-text' />"),d=a.text;return void 0===d||null===d?null:(c.text(d),c)},empty:function(a){return null}},h={text:function(a,c){var d;return"undefined"===(a+="")||"null"===a||"NaN"===a?null:(d=b("<span class='table-cell-text' />"),d.text(a),d)},empty:function(a,b){return null},rowNumber:function(a,c,d){var e;return"no-count"===a?null:(e=b("<span />"),e.text((this.pageIndex-1)*this.pageSize+(d+1)),e)},check:function(a,c){var d=b("<i class='fa fa-square grid-checkbox' />");return d.attr("data-value",a+""),d},paragraph:function(a,c){var d;return"undefined"===(a+="")||"null"===a||"NaN"===a?null:(d=b("<p class='table-cell-block' />"),d.text(a),d)},date:function(a,c){var e,g=f(a);return null===g?null:(e=b("<span />"),isNaN(g)?e.text("无法转换"):e.text([g.getFullYear(),"-",d(g.getMonth()+1),"-",d(g.getDate())].join("")),e)},time:function(a,c){var e,g=f(a);return null===g?null:(e=b("<span />"),isNaN(g)?e.text("无法转换"):e.text([d(g.getHours()),":",d(g.getMinutes()),":",d(g.getSeconds())].join("")),e)},datetime:function(a,c){var e,g=f(a);return null===g?null:(e=b("<span />"),isNaN(g)?e.text("无法转换"):e.text([g.getFullYear(),"-",d(g.getMonth()+1),"-",d(g.getDate())," ",d(g.getHours()),":",d(g.getMinutes()),":",d(g.getSeconds())].join("")),e)},shortDatetime:function(a,c){var e,g=f(a);return null===g?null:(e=b("<span />"),isNaN(g)?e.text("无法转换"):e.text([g.getFullYear(),"-",d(g.getMonth()+1),"-",d(g.getDate())," ",d(g.getHours()),":",d(g.getMinutes())].join("")),e)},money:function(a,b){return e("￥",a)},cellPhone:function(a,c){var d;if(a)return d=b("<span />"),11===a.length?d.text(a.substring(0,3)+"-"+a.substring(3,7)+"-"+a.substring(7)):d.text(a),d},rowspan:function(a,c,d,e){var f;if(0===d)f=c[j]={rowSpan:1,value:a,td:e};else{if(f=c[j],f.value===a)return f.rowSpan++,f.td.prop("rowSpan",f.rowSpan),e.isAnnulment=!0,null;f.rowSpan=1,f.value=a,f.td=e}return b("<span />").text(a)}},i={getBooleanFormatter:function(c,d,e){return c+="",d+="",2===arguments.length&&(e="--"),function(f,g){var h={};if(!0===f)h.text=c,h.color="green";else{if(!1!==f)return b("<span />").text(e);h.text=d,h.color="red"}return a.ctrls.Tag(h).label}},getNumberFormatter:function(c){return function(d,e){return a.core.isNumber(d)?b("<span />").text(a.str.numberScaleFormat(d,c)):null}},getMoneyFormatter:function(a){return function(b,c){return e(a,c)}},getProgressFormatter:function(c,d){return(!a.core.isNumber(c)||c<60)&&(c=!1),b.isNumeric(d)?d<1&&(d=null):d=null,function(e,f,g,h){var i,j,k,l,m,n,o;return j={},a.core.isNumber(e[0])?(j.value=e[0],j.total=d||e[1]||0):(j.value=e,j.total=d||0),0===j.total&&(j.total=1),a.core.isNumber(j.value)||(j.value=0),o=j.value/j.total,isNaN(o)&&(o=0),o=a.str.numberScaleFormat(100*o,2)+"%",i=b("<div class='cell-progress-panel' />"),k=b("<div class='cell-progress-bar' />"),n=c,a.core.isNumber(n)||(n=f.len-12),n-=52,k.css("width",n+"px"),l=b("<div class='cell-progress-value background-highlight' />"),l.css("width",o),k.append(l),m=b("<div class='cell-progress-text font-highlight'/>"),m.append("<span style='margin:0'>"+o+"</span>"),i.append(k),i.append(m),i.append("<br clear='all' />"),i}},getRowspanFormatter:function(a,b){return function(c,d,e,f){var g;if(0===e)g=d[j]={rowSpan:1,value:c[a],td:f};else{if(g=d[j],g.value===c[a])return g.rowSpan++,g.td.prop("rowSpan",g.rowSpan),f.isAnnulment=!0,null;g.rowSpan=1,g.value=c[a],g.td=f}return b.apply(this,arguments)}},getImageFormatter:function(c,d,e,f,g){var h,i;return(!a.core.isNumber(c)||c<=0)&&(c=120),(!a.core.isNumber(d)||d<=0)&&(d=90),e?e+="":e="",i=function(a){var c,d=this.target,e=d.parent().parent(),f=e.parent(),g=f.parent(),h=g[0].rows.length,i=f[0].rowIndex+a;do{if(i<0||i>=h)return!1;c=b(g[0].rows[i].cells[e[0].cellIndex]).children(),d=c.children("img"),i+=a}while(c.hasClass("failed-image"));return d},h=a.ctrls.ImageZoomer({getNext:function(){return i.call(this,1)||null},getPrev:function(){return i.call(this,-1)||null},hasNext:function(){return!!i.call(this,1)},hasPrev:function(){return!!i.call(this,-1)}}),function(a,i,j,k){var l,m;return a?(l=b("<div class='grid-small-image' style='overflow:hidden;' />"),m=b("<img style='cursor:crosshair;' />"),l.css({width:c+"px",height:d+"px"}),l.append(m),m.setImage(e+a,c,d,g).then(function(a){m.addImageZoomer(h)},function(a){var b={originalWidth:120,originalHeight:90,width:c,height:d};m.attr("alt","请求图片失败"),f&&(m.prop("src",f),g.call(b),m.css({"vertical-align":"top",width:b.displayWidth+"px",height:b.displayHeight+"px","margin-top":b.marginTop+"px","margin-left":b.marginLeft+"px"}),m.addClass("default-image")),l.addClass("failed-image")}),l):"<span>暂无图片</span>"}},hoverView:function(d,e,f){return(!a.core.isNumber(d)||d<=0)&&(d=160),(!a.core.isNumber(e)||e<=0)&&(e=160),a.core.isFunction(f)||(f=c),function(c,g,h){var i,j=g._HoverView;return j||(j=a.ctrls.HoverView({width:d,height:e}),j._contextCtrl=this,j.showing(function(a){var b,c,d;this.clear(),c=parseInt(this.target.attr("data-rowIndex"),10),b=this._contextCtrl.getRowData(c),(d=f.call(this._contextCtrl,b))&&this.append(d)}),g._HoverView=j),i=b("<a href='javascript:void(0)' class='grid-hover-target' />"),i.text(c+" "),i.addHoverView(j),i.attr("data-rowIndex",h),i}},switchButton:function(d,e){return a.core.isFunction(d)||(d=c),a.core.isString(e)||(e=null),function(c,f,g){var h,i;return h=b("<input type='checkbox' />"),h.prop("checked",!!c),i=h.switchButton({thumbColor:"Light"===a.theme.currentTheme?"#666666":"#888888",style:e}),i.changed(d),h.data("switchButton",i),i.switchBox}}},a.ColumnStyle={emptyColumn:{text:g.empty,formatter:h.empty},multipleEmptyColumn:function(b){var c={text:g.empty,formatter:h.empty};return a.core.isNumber(b)&&b>1&&(c.rowspan=b),c},isEmpty:function(a){return a===this.emptyColumn||a&&a.text===g.empty&&a.formatter===h.empty},cnfn:g,cfn:h,cfnp:i}}(ui,ui.$),function(a,b){a.mask={maskId:"#ui_mask_rectangle",isOpen:function(){return"block"===b(this.maskId).css("display")},open:function(c,d){var e,f=b(this.maskId),g=b(document.body);return a.core.isPlainObject(c)&&(d=c,c=null),c||(c=d.target),c=a.getJQueryElement(c),c||(c=g),d||(d={}),d.color=d.color||"#000000",d.opacity=d.opacity||.6,d.animate=!1!==d.animate,0===f.length&&(f=b("<div class='mask-panel' />"),f.prop("id",this.maskId.substring(1)),g.append(f),a.page.resize(function(a,b,c){f.css({height:c+"px",width:b+"px"})},a.eventPriority.ctrlResize),this._mask_animator=a.animator({target:f,onChange:function(a){this.target.css("opacity",a/100)}}),this._mask_animator.duration=500),f.css("background-color",d.color),this._mask_data={option:d,target:c},"BODY"===c.nodeName()?(this._mask_data.overflow=g.css("overflow"),"hidden"!==this._mask_data.overflow&&g.css("overflow","hidden"),f.css({top:"0",left:"0",width:document.documentElement.clientWidth+"px",height:document.documentElement.clientHeight+"px"})):(e=c.getBoundingClientRect(),f.css({top:e.top+"px",left:e.left+"px",width:e.width+"px",height:e.height+"px"})),d.animate?(f.css({display:"block",opacity:"0"}),this._mask_animator[0].begin=0,this._mask_animator[0].end=100*d.opacity,this._mask_animator.start()):f.css({display:"block",opacity:d.opacity}),f},close:function(){var a,c;a=b(this.maskId),0!==a.length&&(c=this._mask_data,this._mask_data=null,"BODY"===c.target.nodeName()&&c.target.css("overflow",c.overflow),c.option.animate?(this._mask_animator[0].begin=60,this._mask_animator[0].end=0,this._mask_animator.start().then(function(){a.css("display","none")})):a.css("display","none"))}}}(ui,ui.$),function(a,b){function c(a){if(!(this instanceof c))return new c(a);this.initialize(a)}c.prototype={constructor:c,initialize:function(a){a||(a={}),this.pageNumPanel=null,this.pageInfoPanel=null,this.pageButtonCount=5,this.pageIndex=1,this.pageSize=100,this.data=[],this.pageInfoFormatter=a.pageInfoFormatter,b.isNumeric(a.pageIndex)&&a.pageIndex>0&&(this.pageIndex=a.pageIndex),(b.isNumeric(a.pageSize)||a.pageSize>0)&&(this.pageSize=a.pageSize),(b.isNumeric(a.pageButtonCount)||a.pageButtonCount>0)&&(this.pageButtonCount=a.pageButtonCount),this._ex=Math.floor((this.pageButtonCount-1)/2)},renderPageList:function(a){var c=this._createPageInfo();(!b.isNumeric(a)||a<1)&&(a=this.data?this.data.length||0:0),c.pageIndex=this.pageIndex,c.pageSize=this.pageSize,c.rowCount=a,c.pageCount=Math.floor((a+this.pageSize-1)/this.pageSize),this.pageInfoPanel&&(this.pageInfoPanel.html(""),this._showRowCount(c)),this._renderPageButton(c.pageCount),c.pageCount&&this._checkAndSetDefaultPageIndexHash(this.pageIndex)},_showRowCount:function(a){var c=this.data?this.data.length:0;if(1==a.pageCount?a.currentRowNum=a.rowCount<a.pageSize?a.rowCount:a.pageSize:a.currentRowNum=c<a.pageSize?c:a.pageSize,this.pageInfoFormatter)for(var d in this.pageInfoFormatter)this.pageInfoFormatter.hasOwnProperty(d)&&b.isFunction(this.pageInfoFormatter[d])&&this.pageInfoPanel.append(this.pageInfoFormatter[d].call(this,a[d]))},_createPageInfo:function(){return{rowCount:-1,pageCount:-1,pageIndex:-1,pageSize:-1,currentRowNum:-1}},_renderPageButton:function(a){if(this.pageNumPanel){this.pageNumPanel.empty();var b=this.pageIndex-this._ex;b=b<1?1:b;var c=b+this.pageButtonCount-1;c=c>a?a:c,c-b+1<this.pageButtonCount&&(b=c-(this.pageButtonCount-1)>0?c-(this.pageButtonCount-1):1),b>1&&this.pageNumPanel.append(this._createPageButton("1..."));for(var d,e=b;e<=c;e++)d=e==this.pageIndex?this._createCurrentPage(e):this._createPageButton(e),this.pageNumPanel.append(d);c<a&&this.pageNumPanel.append(this._createPageButton("..."+a))}},_createPageButton:function(a){return"<a class='pager-button font-highlight-hover'>"+a+"</a>"},_createCurrentPage:function(a){return"<span class='pager-current font-highlight'>"+a+"</span>"},pageChanged:function(c,d){var e;this.pageNumPanel&&b.isFunction(c)&&(d=d||a,this.pageChangedHandler=function(){c.call(d,this.pageIndex,this.pageSize)},e=this,(!a.core.ie||a.core.ie>=8)&&a.page.hashchange(function(a,b){if(e._breakHashChanged)return void(e._breakHashChanged=!1);e._isPageHashChange(b)&&(e.pageIndex=e._getPageIndexByHash(b),e.pageChangedHandler())}),this.pageNumPanel.on("click",function(c){var d=b(c.target);if("A"===d.nodeName()){var f=d.text();f=f.replace("...",""),f=parseInt(f,10),e.pageIndex=f,(!a.core.ie||a.core.ie>=8)&&e._setPageHash(e.pageIndex),e.pageChangedHandler()}}))},empty:function(){this.pageNumPanel&&this.pageNumPanel.html(""),this.pageInfoPanel&&this.pageInfoPanel.html(""),this.data=[],this.pageIndex=1},_setPageHash:function(a){a&&(this._breakHashChanged=!0,window.location.hash="page="+a)},_isPageHashChange:function(a){var b=0;return!!a&&("#"===a.charAt(0)&&(b=1),a.indexOf("page")==b)},_getPageIndexByHash:function(a){var b,c;return a&&(c=a.indexOf("="))>=0?(b=a.substring(c+1,a.length),parseInt(b,10)):1},_checkAndSetDefaultPageIndexHash:function(a){var b=window.location.hash,c=b.length;"#"===b.charAt(0)&&c--,c<=0&&this._setPageHash(a)}},a.ctrls.Pager=c}(ui,ui.$),function(a,b){var c,d,e;c={up:function(){var a,b,c;a=this.getParentSize(),c=this,b=this.animator[0],b.begin=a.height,b.end=(a.height-this.offsetHeight)/2,b.onChange=function(a){c.box.css("top",a+"px")},this.openMask(),this.animator.onEnd=function(){c.onShown()},this.box.css({top:b.begin+"px",left:(a.width-this.offsetWidth)/2+"px",display:"block"})},down:function(){var a,b,c;a=this.getParentSize(),c=this,b=this.animator[0],b.begin=-this.offsetHeight,b.end=(a.height-this.offsetHeight)/2,b.onChange=function(a){c.box.css("top",a+"px")},this.openMask(),this.animator.onEnd=function(){c.onShown()},this.box.css({top:b.begin+"px",left:(a.width-this.offsetWidth)/2+"px",display:"block"})},left:function(){var a,b,c;a=this.getParentSize(),c=this,b=this.animator[0],b.begin=-this.offsetWidth,b.end=(a.width-this.offsetWidth)/2,b.onChange=function(a){c.box.css("left",a+"px")},this.openMask(),this.animator.onEnd=function(){c.onShown()},this.box.css({top:(a.height-this.offsetHeight)/2+"px",left:b.begin+"px",display:"block"})},right:function(){var a,b,c;a=this.getParentSize(),c=this,b=this.animator[0],b.begin=a.width,b.end=(a.width-this.offsetWidth)/2,b.onChange=function(a){c.box.css("left",a+"px")},this.openMask(),this.animator.onEnd=function(){c.onShown()},this.box.css({top:(a.height-this.offsetHeight)/2+"px",left:b.begin+"px",display:"block"})},fadein:function(){var a,b,c;a=this.getParentSize(),c=this,b=this.animator[0],b.begin=0,b.end=100,b.onChange=function(a){c.box.css("opacity",a/100)},this.openMask(),this.animator.onEnd=function(){c.onShown()},this.box.css({top:(a.height-this.offsetHeight)/2+"px",left:(a.width-this.offsetWidth)/2+"px",opacity:0,display:"block"})}},d={up:function(){var a,b;b=this,a=this.animator[0],a.begin=parseFloat(this.box.css("top")),a.end=-this.offsetHeight,a.onChange=function(a){b.box.css("top",a+"px")},this.closeMask(),this.animator.onEnd=function(){b.onHidden()}},down:function(){var a,b,c;a=this.getParentSize(),c=this,b=this.animator[0],b.begin=parseFloat(this.box.css("top"),10),b.end=a.height,b.onChange=function(a){c.box.css("top",a+"px")},this.closeMask(),this.animator.onEnd=function(){c.onHidden()}},left:function(){var a,b;b=this,a=this.animator[0],a.begin=parseFloat(this.box.css("left"),10),a.end=-this.offsetWidth,a.onChange=function(a){b.box.css("left",a+"px")},this.closeMask(),this.animator.onEnd=function(){b.onHidden()}},right:function(){var a,b,c;a=this.getParentSize(),c=this,b=this.animator[0],b.begin=parseFloat(this.box.css("left"),10),b.end=a.width,b.onChange=function(a){c.box.css("left",a+"px")},this.closeMask(),this.animator.onEnd=function(){c.onHidden()}},fadeout:function(){var a,b;b=this,a=this.animator[0],a.begin=100,a.end=0,a.onChange=function(a){b.box.css("opacity",a/100)},this.closeMask(),this.animator.onEnd=function(){b.onHidden()},this.box.css({opacity:1,display:"block"})}},e={closable:function(a){var c,d=this;return c=b("<a href='javascript:void(0)'>×</a>"),c.attr("class",a.className||"closable-button font-highlight-hover"),c.on("click",function(){d.hide()}),c},maximizable:function(a){var c,d=this;return c=b("<a href='javascript:void(0)'><i class='fa fa-window-maximize'></i></a>"),c.attr("class",a.className||"maximizable-button font-highlight-hover"),c.on("click",function(){d._maximize(!d.isMaximizeState,c)}),c}},a.ctrls.define("ui.ctrls.DialogBox",{_defineOption:function(){return{title:"",titleHeight:48,show:"up",hide:"down",done:"up",src:null,parent:null,hasIframe:!1,width:640,height:480,maskable:!0,buttons:[],operatePanelHeight:48,suitable:!0,resizeable:!1,draggable:!0,style:null,boxCtrls:["closable"]}},_defineEvents:function(){return["showing","shown","hiding","hidden","resize"]},_create:function(){var b;this.box=null,this.mask=null,this.buttons=[],this.isMaximizeState=!1,this.animator=a.animator(),this.animator.duration=500,a.core.isNumber(this.option.width)||(this.option.width=640),a.core.isNumber(this.option.height)||(this.option.height=480),this.option.titleHeight=parseInt(this.option.titleHeight,10)||48,this.offsetWidth=this.width=this.option.width,this.offsetHeight=this.height=this.option.height,this.contentWidth=this.width,this.contentHeight=0,b=this,a.core.each("show, hide, done",function(a){b[a+"Async"]=function(b){this._asyncCall(a,b)}})},_render:function(){this.box=b("<div class='ui-dialog-box border-highlight' />"),this.titlePanel=b("<section class='ui-dialog-box-title' />"),this.contentPanel=b("<section class='ui-dialog-box-content' />"),this.operatePanel=null,this.box.append(this.titlePanel).append(this.contentPanel),this._initTitle(),this._iniBoxCtrlsButton(),this._initContent(),this._initOperateButtons(),this.animator.add({target:this.box,ease:a.AnimationStyle.easeFromTo}),this.parent=a.getJQueryElement(this.option.parent),this.parent?this.getParentSize=function(){return{width:this.parent.width(),height:this.parent.height()}}:(this.parent=b(document.body),this.getParentSize=function(){return{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}}),this.maskable()&&(this.mask=b("<div class='ui-dialog-box-mask' />"),this.parent.append(this.mask),this.animator.add({target:this.mask,ease:a.AnimationStyle.easeFrom})),this.parent.append(this.box),this.draggable()&&this._initDraggable(),this.resizeable()&&this._initResizeable(),this._initSuitable(),a.core.isPlainObject(this.option.style)&&this.box.css(this.option.style),this.titlePanel.css("height",this.option.titleHeight+"px"),this.contentPanel.css({height:this.contentHeight+"px",top:this.option.titleHeight+"px"})},_initTitle:function(){var b=this.option.title;a.core.isPlainObject(b)?this.setTitle(b.text,b.hasHr,b.style):b&&this.setTitle(b)},_iniBoxCtrlsButton:function(){var c,d=this;c=this.option.boxCtrls,Array.isArray(c)&&0!==c.length&&(this.boxCtrls=b("<div class='ui-dialog-box-ctrls' />"),c.forEach(function(b){var c,f,b;if(a.core.isString(b))b={type:b};else if(a.core.isFunction(b))return void((f=b.call(d))&&d.boxCtrls.append(f));(c=e[b.type])&&(f=c.call(d,b),a.core.isPlainObject(b.css)&&f.css(b.css),d.boxCtrls.append(f))}),this.box.append(this.boxCtrls))},_initContent:function(){this.option.src&&(this.option.hasIframe=!0,this.element=b("<iframe class='content-frame' frameborder='0' scrolling='auto' />"),this.element.prop("src",this.option.src)),this.contentPanel.append(this.element)},_initOperateButtons:function(){var b,c;for(Array.isArray(this.option.buttons)||(a.core.isString(this.option.buttons)?this.option.buttons=[this.option.buttons]:this.option.buttons=[]),b=0,c=this.option.buttons.length;b<c;b++)this.addButton(this.option.buttons[b])},_initDraggable:function(){var a={target:this.box,parent:this.parent,hasIframe:this.hasIframe()};this.titlePanel.addClass("draggable-handle").draggable(a)},_initResizeable:function(){var c;this.resizeHandle=b("<u class='resize-handle' />"),this.box.append(this.resizeHandle),c={context:this,target:this.box,handle:this.resizeHandle,parent:b(document.body),hasIframe:this.hasIframe(),minWidth:320,minHeight:240,onMoving:function(a){var b,d,e,f=this.option;b=f.context,d=b.offsetWidth+a.x,e=b.offsetHeight+a.y,d<c.minWidth&&(d=c.minWidth),e<c.minHeight&&(e=c.minHeight),b._setSize(d,e)}},this.resizer=a.MouseDragger(c),this.resizer.on()},_initSuitable:function(){var b,c=this;this.suitable()?(b=function(a,b,d){c._calculateSize(b,d)},b(),a.page.resize(b,a.eventPriority.ctrlResize)):this._setSize(this.width,this.height,!1)},_maximize:function(b,c){var d,e=this.getParentSize();b!==this.isMaximize&&(this.maximizeAnimator||(this.maximizeAnimator=a.animator({target:this.box,onChange:function(a){this.target.css("top",a+"px")}}).add({target:this.box,onChange:function(a){this.target.css("left",a+"px")}}).add({target:this.box,onChange:function(a){this.target.css("width",a+"px")}}).add({target:this.box,onChange:function(a){this.target.css("height",a+"px")}}),this.maximizeAnimator.onBegin=function(){this.contentPanel.css("display","none"),this.operatePanel&&this.operatePanel.css("display","none")}.bind(this),this.maximizeAnimator.onEnd=function(){this.contentPanel.css("display","block"),this.operatePanel&&this.operatePanel.css("display","block"),this._setSize(this.maximizeAnimator[2].end,this.maximizeAnimator[3].end)}.bind(this),this.maximizeAnimator.duration=500),this.maximizeAnimator.isStarted||(b?(this.isMaximizeState=!0,c.html("<i class='fa fa-window-restore'></i>"),this.resizeHandle&&this.resizeHandle.css("display","none"),d=this.maximizeAnimator[0],d.begin=parseFloat(this.box.css("top"))||0,d.end=0,d=this.maximizeAnimator[1],
d.begin=parseFloat(this.box.css("left"))||0,d.end=0,d=this.maximizeAnimator[2],d.begin=this.offsetWidth,d.end=e.width,d=this.maximizeAnimator[3],d.begin=this.offsetHeight,d.end=e.height,this.maximizeAnimator.start()):(this.isMaximizeState=!1,c.html("<i class='fa fa-window-maximize'></i>"),this.resizeHandle&&this.resizeHandle.css("display","block"),this.maximizeAnimator.back())))},_calculateSize:function(b,c){var d,e,f;f=this.getParentSize(),a.core.isNumber(b)||(b=f.width),a.core.isNumber(c)||(c=f.height),d=this.option.width,e=.85*c,this.height>e&&(e=this.height>c?c:this.height),d>b&&(d=b),this.setSize(d,e,b,c)},_setSize:function(b,c,d){var e=Math.floor(parseFloat(this.box.css("border-top-width")))||0,f=Math.floor(parseFloat(this.box.css("border-bottom-width")))||0,g=Math.floor(parseFloat(this.box.css("border-left-width")))||0,h=Math.floor(parseFloat(this.box.css("border-right-width")))||0;a.core.isNumber(b)&&b>0&&(this.offsetWidth=b,this.width=this.offsetWidth-g-h,this.box.css("width",this.width+"px"),this.contentWidth=this.width),a.core.isNumber(c)&&c>0&&(this.offsetHeight=c,this.height=this.offsetHeight-e-f,this.box.css("height",this.height+"px"),this._updateContentPanelHeight()),!1!==d&&this.fire("resize")},_updateContentPanelHeight:function(){this.contentHeight=this.height-this.option.titleHeight-(this.operatePanel?this.option.operatePanelHeight:0),this.contentPanel.css("height",this.contentHeight+"px")},_asyncCall:function(b,c){var d=null;a.core.isFunction(this[b])&&(d=this[b].call(this))&&a.core.isFunction(c)&&d.then(c)},maskable:function(){return!!this.option.maskable},suitable:function(){return!!this.option.suitable},resizeable:function(){return!!this.option.resizeable},draggable:function(){return!!this.option.draggable},hasIframe:function(){return!!this.option.hasIframe},setTitle:function(c,d,e){var f,g;a.core.isString(c)?f=b("<span class='title-text font-highlight' />").text(c):a.core.isDomObject(c)?f=b(c):a.core.isJQueryObject(c)&&(f=c),this.titlePanel.empty(),g=b("<div class='title-inner-panel' />"),g.append(f),!1!==d&&(d=!0),d&&g.append("<hr class='ui-dialog-box-spline background-highlight' />"),this.titlePanel.append(g),Array.isArray(e)?e.forEach(function(a){this.titlePanel.addClass(a)}.bind(this)):a.core.isPlainObject(e)&&this.titlePanel.css(e)},addButton:function(c){if(c=a.getJQueryElement(c))return this.operatePanel||(this.operatePanel=b("<section class='ui-dialog-box-operate' />"),this.box.append(this.operatePanel),this._updateContentPanelHeight(),this.fire("resize")),this.operatePanel.append(c),this},isShow:function(){return"block"===this.box.css("display")},show:function(b){return this.animator.isStarted||this.isShow()?a.PromiseEmpty:!1===this.fire("showing")?a.PromiseEmpty:a.core.isFunction(b)||(b=c[this.option.show],a.core.isFunction(b))?(b.call(this),this.animator.start()):a.PromiseEmpty},hide:function(b){return this.animator.isStarted||!this.isShow()?a.PromiseEmpty:!1===this.fire("hiding")?a.PromiseEmpty:a.core.isFunction(b)||(b=d[this.option.hide],a.core.isFunction(b))?(b.call(this),this.animator.start()):a.PromiseEmpty},done:function(b){return a.core.isFunction(b)||(b=d[this.option.done],a.core.isFunction(b))?this.hide(b):a.PromiseEmpty},onShown:function(){this.fire("shown")},onHidden:function(){this.box.css("display","none"),this.maskable()&&(this.parent.css("overflow",this._oldBodyOverflow),this.mask.css("display","none")),this.fire("hidden")},openMask:function(){var a,b=this.getParentSize();this.maskable()&&(this._oldBodyOverflow=this.parent.css("overflow"),this.parent.css("overflow","hide"),this.mask.css({display:"block",opacity:0,height:b.height+"px"}),a=this.animator[1],a.begin=0,a.end=70,a.onChange=function(a){this.target.css("opacity",a/100)})},closeMask:function(){var a;this.maskable()&&(a=this.animator[1],a.begin=70,a.end=0,a.onChange=function(a){this.target.css("opacity",a/100)})},setSize:function(b,c,d,e,f){var g=this.getParentSize(),h=a.core.isNumber(d),i=a.core.isNumber(e);h||(d=g.width),i||(e=g.height),h&&i&&(this.getParentSize=function(){return{width:d,height:e}}),this._setSize(b,c),this.box.css(a.core.isFunction(f)?f.call(this,d,e):{top:(e-this.offsetHeight)/2+"px",left:(d-this.offsetWidth)/2+"px"}),this.maskable()&&this.mask.css("height",e+"px")}}),b.fn.dialogBox=function(b){return 0===this.length?null:a.ctrls.DialogBox(b,this)},a.ctrls.DialogBox.setShowStyle=function(b,d){a.core.isString(b)&&b.length>0&&a.core.isFunction(d)&&(c[b]=d)},a.ctrls.DialogBox.setHideStyle=function(b,c){a.core.isString(b)&&b.length>0&&a.core.isFunction(c)&&(d[b]=c)}}(ui,ui.$),function(a,b){function c(a){if(!(this instanceof c))return new c(a);this.initialize(a)}var d;c.prototype={constructor:c,initialize:function(b){b||(b={}),this.delay=b.delay,("number"!==a.core.type(this.delay)||this.delay<0)&&(this.delay=1e3),this.timeoutHandle=null,this.isOpening=!1,this.box=null,this.openCount=0},getBox:function(){return this.box||(this.box=b("#loadingElement")),this.box},isShow:function(){return"block"===this.getBox().css("display")},show:function(){var a;if(this.isOpening||this.isShow())return void this.openCount++;this.isOpening=!0,a=this,this.timeoutHandle=setTimeout(function(){a.timeoutHandle=null,a._doShow()},this.delay)},_doShow:function(){this.getBox(),this.box.addClass("c_dotsPlaying").css("display","block")},hide:function(){return this.openCount>0?void this.openCount--:(this.isOpening=!1,this.timeoutHandle?void clearTimeout(this.timeoutHandle):(this.getBox(),void this.box.removeClass("c_dotsPlaying").css("display","none")))}},d=c(),a.loadingShow=function(){d.show()},a.loadingHide=function(){d.hide()}}(ui,ui.$),function(a,b){function c(){if(!(this instanceof c))return new c;this.initialize()}function d(a,b){b||(b=f.message),e.show(a,b)}var e,f={message:0,warn:1,error:3,success:4,failed:5};c.prototype={constructor:c,initialize:function(){this.box=null,this.type=f,this.isStartHide=!1,this.boxAnimator=null,this.width=322,this.top=88},_initAnimator:function(){this.boxAnimator=a.animator({target:this.box,ease:a.AnimationStyle.easeTo,onChange:function(a){this.target.css("left",a+"px")}}),this.boxAnimator.duration=200},getIcon:function(a){return a===f.warn?"mb-warn fas fa-exclamation-triangle":a===f.error?"mb-error fas fa-times-circle":a===f.success?"mb-success far fa-check-circle":a===f.failed?"mb-failed far fa-times-circle":"mb-message fas fa-comment-dots"},getBox:function(){var a,c;if(!this.box){a=document.documentElement.clientWidth,c=document.documentElement.clientHeight,this.box=b("<div class='ui-message-box border-highlight' />"),this.box.css({top:this.top+"px",left:a+"px","max-height":c-2*this.top+"px"});var d=b("<a href='javascript:void(0)' class='closable-button'>×</a>"),e=this;d.on("click",function(a){e.hide(!0)}),this.box.on("mouseenter",function(a){e.isClosing||(e.isStartHide?e._show():clearTimeout(e.hideHandler))}),this.box.on("mouseleave",function(a){e.waitSeconds(5)}),this.box.append(d),b(document.body).append(this.box),this._initAnimator()}return this.box},isShow:function(){return"block"===this.getBox().css("display")},show:function(c,d){var f,g,h,i;if(g=b("<div class='message-item' />"),g.append(b("<i class='message-icon "+this.getIcon(d)+"'></i>")),h=b("<div class='message-content' />"),a.core.isFunction(c)?(i=c(),a.core.isString(i)?h.text(i):h.append(i)):h.text(c),g.append(h),f=this.getBox(),this.isShow())return void f.append(g);f.children(".message-item").remove(),f.append(g),this._show(function(){e.waitSeconds(5)})},_show:function(a){var b,c=(this.getBox(),document.documentElement.clientWidth);this.isStartHide=!1,this.boxAnimator.stop(),b=this.boxAnimator[0],b.begin=parseFloat(b.target.css("left"))||c,b.end=c-this.width,b.target.css("display","block"),this.boxAnimator.start().then(a)},hide:function(a){var b,c,d=this,e=document.documentElement.clientWidth;a&&(this.isClosing=!0),b=this.getBox(),this.isStartHide=!0,this.boxAnimator.stop(),c=this.boxAnimator[0],c.begin=parseFloat(c.target.css("left"))||e-this.width,c.end=e,this.boxAnimator.start().then(function(){b.css("display","none"),d.isClosing=!1,d.isStartHide=!1})},waitSeconds:function(a){var b=this;b.hideHandler&&window.clearTimeout(b.hideHandler),isNaN(parseInt(a))&&(a=5),b.hideHandler=window.setTimeout(function(){b.hideHandler=null,!1===b.isStartHide&&b.hide()},1e3*a)}},e=c(),a.page.resize(function(a){var b,c=e.getBox(),d=document.documentElement.clientWidth,f=document.documentElement.clientHeight;b=e.isShow()?d-e.width:d,e.waitSeconds(5),c.css({left:b+"px","max-height":f-2*e.top+"px"})}),a.messageShow=function(a){d(a,f.message)},a.warnShow=function(a){d(a,f.warn)},a.errorShow=function(a){d(a,f.error)},a.successShow=function(a){d(a,f.success)},a.failedShow=function(a){d(a,f.failed)}}(ui,ui.$),function(a,b){a.ctrls.define("ui.ctrls.OptionBox",a.ctrls.SidebarBase,{_defineOption:function(){return{title:"",buttons:null}},_create:function(){this._super(),this.contentPanel=null,this.contentTop=40,this.buttonTop=0,this.operatePanelHeight=0,this.buttons=[],this.opacityOption={ease:a.AnimationStyle.easeFromTo,onChange:function(a,b){b.css("opacity",a/100)}}},_render:function(){this._super(),this._panel.addClass("ui-option-box-panel"),this.titlePanel=b("<section class='ui-option-box-title' />"),this.contentPanel=b("<section class='ui-option-box-content' />"),this.contentPanel.append(this.element),this.borderWidth+=parseInt(this._panel.css("border-left-width"),10)||0,this.borderWidth+=parseInt(this._panel.css("border-right-width"),10)||0,this._panel.append(this.titlePanel).append(this.contentPanel),this._initOperateButtons(),this.setTitle(this.option.title)},_initOperateButtons:function(){var b,c;for(Array.isArray(this.option.buttons)||(a.core.isString(this.option.buttons)?this.option.buttons=[this.option.buttons]:this.option.buttons=[]),b=0,c=this.option.buttons.length;b<c;b++)this.addButton(this.option.buttons[b])},addButton:function(c){var d;if(c=a.getJQueryElement(c))return this.buttons.push(c),this.operatePanel?d=this.operatePanel.children(".ui-form"):(this.operatePanel=b("<section class='ui-option-box-buttons' />"),d=b("<div class='ui-form' />"),this.operatePanel.append(d),this._panel.append(this.operatePanel),this.buttonTop=16,this.operatePanelHeight=24),d.append(c),this},setTitle:function(c){this.titlePanel.empty(),c&&(a.core.isString(c)&&(c=b("<span class='option-box-title-text font-highlight'/>").text(c)),this.titlePanel.append(c))},setSize:function(b,c,d){var e;this._super(b,c,d),e=this.height-this.contentTop-this.buttonTop-this.operatePanelHeight-this.buttonTop,this.contentPanel.css({"max-height":e+"px"}),this.operatePanel&&(e<this.element.width()?this.operatePanel.css("width",this.width-a.scrollbarWidth+"px"):this.operatePanel.css("width","100%"))},show:function(){return this.showTimeValue=240,this.opacityOption.target=this._panel,this.opacityOption.begin=0,this.opacityOption.end=100,this._super(this.opacityOption)},hide:function(){return this.hideTimeValue=240,this.opacityOption.target=this._panel,this.opacityOption.begin=100,this.opacityOption.end=0,this._super(this.opacityOption)}})}(ui,ui.$),function(a,b){function c(){}function d(a){return a<10?"0"+a:""+a}function e(a){return a+""}function f(a,b,c){var d,e,f;for(f=[],f.push(null),d=3;d<arguments.length;d++)f.push(arguments[d]);for(e=[],d=a;d<=b;d++)f[0]=d,e.push(c.apply(this,f));return e}function g(a,b,c){var e,g;return e=[],a&&(g={title:"时"},g.list=f.call(this,0,23,d),e.push(g)),b&&(g={title:"分"},g.list=f.call(this,0,59,d),e.push(g)),c&&(g={title:"秒"},g.list=f.call(this,0,59,d),e.push(g)),e}function h(a){return Math.pow(a,.25)}function i(a){var b,c,d,e;if(a.beginAnimation)return a.duration=200,void(a.startTime=(new Date).getTime());a.startTime=(new Date).getTime(),a.duration=160,a.beginAnimation=!0,b=this,c=60,d=h,e=function(){var c=(new Date).getTime(),e=c-a.startTime,f=d(e/a.duration),g=a.scrollEnd-a.scrollBegin,h=Math.ceil(a.scrollBegin+f*g);a.target.scrollTop(h),a.duration<=e&&(a.target.scrollTop(a.scrollEnd),j.call(b,a),b._selectItem(a))},this._deselectItem(a),e(),a.stopScrollHandler=setInterval(e,1e3/c)}function j(a){clearInterval(a.stopScrollHandler),a.beginAnimation=!1}function k(a,b){b<0&&(b=0),a.scrollTop(b*(this.option.itemSize+this.option.margin))}function l(b){a.hideAll(this),this.show(),this._updateSelectionState()}function m(a){var c,d,e;for(a.stopPropagation(),c=b(a.target);"LI"!==c.nodeName();)if(c.hasClass("ui-chooser-list"))return;c.hasClass("ui-chooser-empty-item")||c.hasClass(p)||(d=parseInt(c.attr("data-index"),10),e=this.scrollData[parseInt(c.parent().parent().attr("data-index"),10)],this._chooseItem(e,d))}function n(a){var b,c,d,e,f,g,h;return a.stopPropagation(),b=a.data.target,c=parseInt(b.attr("data-index"),10),d=this.scrollData[c],e=this.option.itemSize+this.option.margin,h=Math.trunc(a.deltaY||-a.wheelDelta),f=h*e,g=h>0,null===d.lastDirection&&(d.lastDirection=g),d.lastDirection!==g&&(d.lastDirection=g,j.call(this,d)),d.beginAnimation?(d.scrollBegin=b.scrollTop(),d.scrollEnd=parseInt((d.scrollEnd+f)/e,10)*e):(d.scrollBegin=b.scrollTop(),d.scrollEnd=parseInt((d.scrollBegin+f)/e,10)*e),i.call(this,d),!1}var o,p="ui-chooser-selection-item",q={S:3,M:5,L:9};o={hourMinute:function(){var a;return a=g(!0,!0,!1),this.option.spliter=":",this.defaultValue=function(){var a=new Date;return[d(a.getHours()),d(a.getMinutes())]},this.getValue=this.getText=e,a},time:function(){var a;return a=g(!0,!0,!0),this.option.spliter=":",this.defaultValue=function(){var a=new Date;return[d(a.getHours()),d(a.getMinutes()),d(a.getSeconds())]},this.getValue=this.getText=e,a},yearMonth:function(){var a,b,c,g;return a=[],b=(new Date).getFullYear()-49,c=b+99,g={title:"年"},g.list=f.call(this,b,c,e),a.push(g),b=1,c=12,g={title:"月"},g.list=f.call(this,b,c,d),a.push(g),this.option.spliter="-",this.defaultValue=function(){var a=new Date;return[d(a.getFullYear()),d(a.getMonth()+1)]},this.getValue=this.getText=e,a}},a.ctrls.define("ui.ctrls.Chooser",a.ctrls.DropDownBase,{_defineOption:function(){return{type:!1,title:null,viewData:null,spliter:"",margin:0,size:"M",itemSize:32}},_defineEvents:function(){return["changing","changed","cancel","listChanged"]},_create:function(){var b;this._super(),this.scrollData=null,q.hasOwnProperty(this.option.size)?this.size=q[this.option.size]:this.size=q.M,(!a.core.isNumber(this.option.margin)||this.option.margin<0)&&(this.option.margin=0),(!a.core.isNumber(this.option.itemSize)||this.option.itemSize<=0)&&(this.option.itemSize=32),b=this.element.getBoundingClientRect(),this.width=b.width-2,this.width<this.itemSize+2*this.margin&&(this.width=120),this.onFocusHandler=l.bind(this),this.onItemClickHandler=m.bind(this),this.onMousewheelHandler=n.bind(this)},_render:function(){this.chooserPanel=b("<div class='ui-chooser-panel border-highlight' />"),this.chooserPanel.css("width",this.width+"px"),this._itemTitlePanel=b("<div class='ui-chooser-title-panel' />"),this._itemListPanel=b("<div class='ui-chooser-list-panel' />"),this._itemListPanel.append(this._createFocusElement()),this._createItemList(this._itemTitlePanel,this._itemListPanel),this.chooserPanel.append(this._itemTitlePanel).append(this._itemListPanel),this._selectTextClass="ui-select-text",this._showClass="ui-chooser-show",this._clearClass="ui-clear-text",this._clear=function(){this.cancelSelection()},this.wrapElement(this.element,this.chooserPanel),this._super({focus:this.onFocusHandler}),this.chooserPanel.on("click",function(a){a.stopPropagation()})},_createFocusElement:function(){var a=b("<div class='focus-choose-element' />");return a.addClass("border-highlight"),a.css("top",this.option.itemSize*((this.size-1)/2)),a},_createItemList:function(a,b){var c=this._fillList(a,b);this.chooserPanel.css("width",c.width+"px"),b.css("height",c.height+"px")},_fillList:function(c,d){var e,f,g,h,i,j,k,l,m,n,p,q;if(e={width:0,height:this.size*(this.option.itemSize+this.option.margin)+this.option.margin},a.core.isString(this.option.type)?o.hasOwnProperty(this.option.type)&&(this.scrollData=o[this.option.type].call(this)):a.core.isFunction(this.option.type)&&(this.scrollData=this.option.type.call(this)),this.scrollData||(this.scrollData=this.option.viewData),!Array.isArray(this.scrollData)||0===this.scrollData.length)return e;for(k=this.scrollData.length,n=Math.floor(this.width/k),p=this.width-n*k,m=!1,j=0;j<k;j++)if(this.scrollData[j].title){m=!0;break}for(m||c.append("<span class='font-highlight'>"+this.option.title+"</span>"),j=0;j<k;j++)i=this.scrollData[j],p>0?(q=1,p--):q=0,g={left:e.width+"px",width:n+q+"px"},m&&(f=b("<div class='ui-chooser-title-item font-highlight' />"),f.css(g),f.text(i.title||""),c.append(f)),f=b("<div class='ui-chooser-list' />"),f.css(g),f.attr("data-index",j),l=this.scrollData[j],l.target=f,l.lastDirection=null,e.width+=n+q+this.option.margin,f.on("wheel",{target:f},this.onMousewheelHandler),f.on("click",this.onItemClickHandler),h=this._createList(i),f.append(h),d.append(f);return e},_createList:function(a){var c,d,e,f,g,h,i,j;for(h=this._getAttachmentCount(),c=a.list,d=[],e=[],i=0;i<h;i++)d.push(null),e.push(null);for(c=d.concat(c,e),f=b("<ul class='ui-chooser-list-ul' />"),i=0,j=c.length;i<j;i++)g=this._createItem(c[i]),i-h==0&&(a._current=g,g.addClass(p).addClass("font-highlight")),g.attr("data-index",i),f.append(g);return g.css("margin-bottom",this.option.margin+"px"),f},_createItem:function(a){var c;return c=b("<li class='ui-chooser-list-li' />"),{width:this.option.itemSize+"px",height:this.option.itemSize+"px"},c.addClass("ui-chooser-item"),a?c.text(this.getText(a)):c.addClass("ui-chooser-empty-item"),c},_getAttachmentCount:function(){return Math.floor((this.size-1)/2)},_getIndexes:function(b){var d,e,f,g,h,i;for(d=this._getAttachmentCount(),e=[],a.core.isFunction(b)||(b=c),f=0,g=this.scrollData.length;f<g;f++)h=this.scrollData[f],h._current?(i=parseInt(h._current.attr("data-index"),10),i-=d,e.push(i),b.call(this,h.list[i])):(e.push(-1),b.call(this,null));return e},_getValues:function(){var a,b;return a=[],b=this._getIndexes(function(b){b?a.push(this.getValue(b)):a.push("")}),{values:a,indexes:b}},_setValues:function(a){var b,c,d,e,f;if(Array.isArray(a)){for(f=[],b=0;b<a.length;b++)if(e=this.scrollData[b])for(f[b]=0,c=0,d=e.list.length;c<d;c++)if(this.getValue(e.list[c])===a[b]){f[b]=c;break}this._setSelectionState(f)}},_setSelectionState:function(a){var b,c,d,e;if(a.length==this.scrollData.length)for(d=0,e=a.length;d<e;d++)c=a[d],b=this.scrollData[d],this._deselectItem(b),k.call(this,b.target,c),this._selectItem(b)},_updateSelectionState:function(){var b,c;for(c=this._getIndexes(),b=c.length-1;b>=0;b--)-1===c[b]&&c.splice(b,1);if(c.length>0)this._setSelectionState(c);else if(a.core.isFunction(this.defaultValue))this._setValues(this.defaultValue());else{for(c=[],b=0;b<this.scrollData.length;b++)c.push(0);this._setSelectionState(c)}},_chooseItem:function(a,b){a.beginAnimation&&j.call(this,a),b-=this._getAttachmentCount(),a.scrollBegin=a.target.scrollTop(),a.scrollEnd=b*(this.option.itemSize+this.option.margin),i.call(this,a)},_selectItem:function(a){var c,d,e,f,g,h,i;for(f=0,g=this.scrollData.length;f<g;f++)if(this.scrollData[f].beginAnimation)return;c=a.target.find("ul"),d=a.target.scrollTop(),e=parseInt((d+.3*this.option.itemSize)/(this.option.itemSize+this.option.margin),10),i={listItem:a,itemIndex:e},this.fire("listChanged",i),a._current=b(c.children()[e+this._getAttachmentCount()]),a._current.addClass(p).addClass("font-highlight"),i=this._getValues(),i.text="",Array.isArray(i.values)&&(h=this,i.text=i.values.map(function(a){return h.getText(a)}).join(this.option.spliter)),!1!==this.fire("changing",i)&&(this._selectedItems=i.indexes,this.fire("changed",i))},_deselectItem:function(a){a._current&&a._current.removeClass(p).removeClass("font-highlight")},getSelection:function(){var a,b,c=[];for(a=this._getValues(),b=0;b<a.indexes.length;b++)-1===a.indexes[b]?c.push(null):c.push(a.values[b]);return c},setSelection:function(a){this._setValues(a)},cancelSelection:function(a){this.scrollData.forEach(function(a){a._current=null}),!1!==a&&this.fire("cancel")}}),a.ctrls.Chooser.extendType=function(b,c){a.core.isFunction(c)&&a.core.isString(b)&&!o.hasOwnProperty(b)&&(o[b]=c)},b.fn.chooser=function(b){return 0===this.length?null:a.ctrls.Chooser(b,this)}}(ui,ui.$),function(a,b){function c(c,d){var e=this;e.eventDispatcher=new a.CustomEvent(e),e.eventDispatcher.initEvents(["changed"]),b(c).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var f=b(".farbtastic",c);e.wheel=b(".wheel",c).get(0),e.radius=84,e.square=100,e.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&b("*",f).each(function(){if("none"!=this.currentStyle.backgroundImage){var a=this.currentStyle.backgroundImage;a=this.currentStyle.backgroundImage.substring(5,a.length-2),b(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+a+"')"})}}),e.linkTo=function(a){return"object"==typeof e.callback&&b(e.callback).unbind("keyup",e.updateValue),e.color=null,"function"==typeof a?e.callback=a:"object"!=typeof a&&"string"!=typeof a||(e.callback=b(a),e.callback.bind("keyup",e.updateValue),e.callback.get(0).value&&e.setColor(e.callback.get(0).value)),this},e.updateValue=function(a){this.value&&this.value!=e.color&&e.setColor(this.value)},e.setColor=function(a){var b=e.unpack(a);return e.color!=a&&b&&(e.color=a,e.rgb=b,e.hsl=e.RGBToHSL(e.rgb),e.updateDisplay()),this},e.setHSL=function(a){return e.hsl=a,e.rgb=e.HSLToRGB(a),e.color=e.pack(e.rgb),e.updateDisplay(),this},e.widgetCoords=function(a){var c,d,f,g,h=a.target||a.srcElement,i=e.wheel;if(void 0!==a.offsetX){f={x:a.offsetX,y:a.offsetY};for(var j=h;j;)j.mouseX=f.x,j.mouseY=f.y,f.x+=j.offsetLeft,f.y+=j.offsetTop,j=j.offsetParent;for(j=i,g={x:0,y:0};j;){if(void 0!==j.mouseX){c=j.mouseX-g.x,d=j.mouseY-g.y;break}g.x+=j.offsetLeft,g.y+=j.offsetTop,j=j.offsetParent}for(j=h;j;)j.mouseX=void 0,j.mouseY=void 0,j=j.offsetParent}else f=e.absolutePosition(i),c=(a.pageX||0*(a.clientX+b("html").get(0).scrollLeft))-f.x,d=(a.pageY||0*(a.clientY+b("html").get(0).scrollTop))-f.y;return{x:c-e.width/2,y:d-e.width/2}},e.mousedown=function(a){document.dragging||(b(document).bind("mousemove",e.mousemove).bind("mouseup",e.mouseup),document.dragging=!0);var c=e.widgetCoords(a);return e.circleDrag=2*Math.max(Math.abs(c.x),Math.abs(c.y))>e.square,e.mousemove(a),!1},e.mousemove=function(a){var b=e.widgetCoords(a);if(e.circleDrag){var c=Math.atan2(b.x,-b.y)/6.28;c<0&&(c+=1),e.setHSL([c,e.hsl[1],e.hsl[2]])}else{var d=Math.max(0,Math.min(1,-b.x/e.square+.5)),f=Math.max(0,Math.min(1,-b.y/e.square+.5));e.setHSL([e.hsl[0],d,f])}return!1},e.mouseup=function(){b(document).unbind("mousemove",e.mousemove),b(document).unbind("mouseup",e.mouseup),document.dragging=!1},e.updateDisplay=function(){var a=6.28*e.hsl[0];b(".h-marker",f).css({left:Math.round(Math.sin(a)*e.radius+e.width/2)+"px",top:Math.round(-Math.cos(a)*e.radius+e.width/2)+"px"}),b(".sl-marker",f).css({left:Math.round(e.square*(.5-e.hsl[1])+e.width/2)+"px",top:Math.round(e.square*(.5-e.hsl[2])+e.width/2)+"px"}),b(".color",f).css("backgroundColor",e.pack(e.HSLToRGB([e.hsl[0],1,.5]))),"object"==typeof e.callback?(b(e.callback).css({backgroundColor:e.color,color:e.hsl[2]>.5?"#000":"#fff"}),b(e.callback).each(function(){this.value&&this.value!=e.color&&(this.value=e.color)})):"function"==typeof e.callback&&e.callback.call(e,e.color),this.fire("changed",e.color)},e.absolutePosition=function(a){var b={x:a.offsetLeft,y:a.offsetTop};if(a.offsetParent){var c=e.absolutePosition(a.offsetParent);b.x+=c.x,b.y+=c.y}return b},e.pack=function(a){var b=Math.round(255*a[0]),c=Math.round(255*a[1]),d=Math.round(255*a[2]);return"#"+(b<16?"0":"")+b.toString(16)+(c<16?"0":"")+c.toString(16)+(d<16?"0":"")+d.toString(16)},e.unpack=function(a){return 7==a.length?[parseInt("0x"+a.substring(1,3))/255,parseInt("0x"+a.substring(3,5))/255,parseInt("0x"+a.substring(5,7))/255]:4==a.length?[parseInt("0x"+a.substring(1,2))/15,parseInt("0x"+a.substring(2,3))/15,parseInt("0x"+a.substring(3,4))/15]:void 0},e.HSLToRGB=function(a){var b,c,d=a[0],e=a[1],f=a[2];return c=f<=.5?f*(e+1):f+e-f*e,b=2*f-c,[this.hueToRGB(b,c,d+.33333),this.hueToRGB(b,c,d),this.hueToRGB(b,c,d-.33333)]},e.hueToRGB=function(a,b,c){return c=c<0?c+1:c>1?c-1:c,6*c<1?a+(b-a)*c*6:2*c<1?b:3*c<2?a+(b-a)*(.66666-c)*6:a},e.RGBToHSL=function(a){var b,c,d,e,f,g,h=a[0],i=a[1],j=a[2];return b=Math.min(h,Math.min(i,j)),c=Math.max(h,Math.max(i,j)),d=c-b,g=(b+c)/2,f=0,g>0&&g<1&&(f=d/(g<.5?2*g:2-2*g)),e=0,d>0&&(c==h&&c!=i&&(e+=(i-j)/d),c==i&&c!=j&&(e+=2+(j-h)/d),c==j&&c!=h&&(e+=4+(h-i)/d),e/=6),[e,f,g]},b("*",f).mousedown(e.mousedown),e.setColor("#000000"),d&&e.linkTo(d)}function d(a,d){return a=b(a).get(0),a.farbtastic||(a.farbtastic=new c(a,d))}function e(b,c){(b=a.getJQueryElement(b))&&(c||(c=arguments[2]||b.css("background-color")),c&&"transparent"!==c?(c=a.color.parseRGB(c),c=a.color.rgb2hex(c.red,c.green,c.blue).toLowerCase()):c="#ffffff",b.val(c),this.setColor(c))}b.fn.colorPicker=function(c){var f,g,h;return 0===this.length?null:(f=a.ctrls.DropDownBase(c,this),g=b("<div class='ui-color-picker border-highlight' />"),g.on("click",function(a){a.stopPropagation()}),f.colorPickerPanel=g,f._showClass="color-picker-show",f.wrapElement(this,g),f._render(),h=f.hide,d(g,this),f.farbtastic=f.colorPickerPanel[0].farbtastic,f.hide=function(){if(document.dragging)return"retain";h.call(this)},f.setColorValue=function(){e.apply(this.farbtastic,arguments)},f.setColorValue(this),f)}}(ui,ui.$),function(a,b){function c(a,b,d,e){if(!(this instanceof c))return new c(a,b,d,e);this.initialize(a,b,d,e)}function d(a){return a<10?"0"+a:""+a}function e(a,b){return b+=1,a+"-"+d.call(this,b)+"&nbsp;▼"}function f(a,b,c){var e;return e=a.exec(c),null!==e&&e[0].length>1&&(b=d(b)),c.replace(a,b)}function g(a,b,c){var d;return d=a.exec(c),d?parseInt(b.substring(d.index,d.index+d[0].length),10):NaN}function h(a,b){var d,e,f;return d=g.call(this,B,a,b),e=g.call(this,C,a,b),f=g.call(this,D,a,b),isNaN(d)||isNaN(e)||isNaN(f)?null:c(d,e-1,f,this)}function i(a){return a.hasClass("date-chooser-prev-disabled")||a.hasClass("date-chooser-next-disabled")}function j(a){var c,d,e,f=a.data.value;c=b(a.target),i(c)||(d=this._currentYear?parseInt(this._currentYear.attr("data-year"),10):this._selYear,e=this._currentMonth?parseInt(this._currentMonth.attr("data-month"),10):this._selMonth,d+=f,this._fillYear(d,e))}function k(a){var c,d;if(a.stopPropagation(),c=b(a.target),"TD"===c.nodeName()&&!c.hasClass("disabled-year")){if(this._currentYear){if(this._currentYear[0]===c[0])return;this._currentYear.removeClass(z).removeClass("background-highlight")}this._currentYear=c,this._currentYear.addClass(z).addClass("background-highlight"),d=this._currentMonth?parseInt(this._currentMonth.attr("data-month"),10):this._selMonth,this._updateMonthsStatus(d)}}function l(a){var c;if(a.stopPropagation(),c=b(a.target),"TD"===c.nodeName()&&!c.hasClass("disabled-month")){if(this._currentMonth){if(this._currentMonth[0]===c[0])return;this._currentMonth.removeClass(A).removeClass("background-highlight")}this._currentMonth=c,this._currentMonth.addClass(A).addClass("background-highlight")}}function m(a){a.stopPropagation(),this._selYear=parseInt(this._currentYear.attr("data-year"),10),this._selMonth=parseInt(this._currentMonth.attr("data-month"),10),this._updateCalendarTitle(),this._fillMonth(this._currentDays,this._selYear,this._selMonth),this._closeYearMonthPanel()}function n(a){a.stopPropagation(),this._closeYearMonthPanel()}function o(a){var c,d,e=a.data.value;c=b(a.target),i(c)||(d=new Date(this._selYear,this._selMonth+e,1),this._changeMonth(d,e>0))}function p(a){a.stopPropagation(),this._fillYear(this._selYear,this._selMonth),this._openYearMonthPanel()}function q(a){var c;if(c=b(a.target),!this._currentDays.parent().hasClass("click-disabled")){for(;"TD"!==c.nodeName();){if(c.hasClass("date-chooser-days-panel"))return;c=c.parent()}c[0]!==a.target&&(c.context=a.target),this._selectItem(c)}}function r(a){var b,c,d=new Date;b=d.getFullYear(),c=d.getMonth(),b===this._selYear&&c===this._selMonth?this.setSelection(d):this._changeMonth(d,12*b+c+1>12*this._selYear+this._selMonth+1,function(){this.setSelection(d)})}function s(a){var c,e,f,g,h,i,j;c=b(a.target),"INPUT"===c.nodeName()&&(e=c.hasClass("hour")?24:60,f=c.val(),f=parseFloat(f),g=Math.trunc(a.deltaY||-a.wheelDelta),f+=g,f<0?f=e-1:f>=e&&(f=0),c.val(d(f)),h=parseInt(this.hourText.val(),10),i=parseInt(this.minuteText.val(),10),j=parseInt(this.secondText.val(),10),this.setSelection(new Date(this._selYear,this._selMonth,this._selDay,h,i,j)))}function t(a){var c,e,f,g,h;if(c=b(a.target),0!==c.val().length){if(e=new Date,f=parseInt(this.hourText.val(),10),isNaN(f)||f<0||f>=24)return f=e.getHours(),void this.hourText.val(d(f));if(g=parseInt(this.minuteText.val(),10),isNaN(g)||g<0||g>=60)return g=e.getMinutes(),void this.minuteText.val(d(g));if(h=parseInt(this.secondText.val(),10),isNaN(h)||h<0||h>=60)return h=e.getSeconds(),void this.secondText.val(d(h));this.setSelection(new Date(this._selYear,this._selMonth,this._selDay,f,g,h))}}function u(){}function v(b,c){var d=a.ctrls.DateChooser(b,c);return d.selecting(function(b,c){if(a.core.isFunction(this.selectingHandler))return this.selectingHandler.apply(this,arguments)}),d.selected(function(b,c){a.core.isFunction(this.selectedHandler)?this.selectedHandler.apply(this,arguments):"INPUT"===this.element.nodeName()?this.element.val(c.value):this.element.html(c.value)}),d.cancel(function(){a.core.isFunction(this.cancelHandler)?this.cancelHandler.apply(this,arguments):"INPUT"===this.element.nodeName()?this.element.val(""):this.element.html("")}),d}function w(a){var b,c,d;if(!this.isShow())return this.element.css("cursor","auto"),void(this._clearable=!1);b=this.element.width(),c=parseFloat(this.element.css("padding-right"))||0,d=a.offsetX,d||(d=a.clientX-this.element.offset().left),b-c-d<0?(this.element.css("cursor","pointer"),this._clearable=!0):(this.element.css("cursor","auto"),this._clearable=!1)}function x(a){var c,d,e;this._clearable&&(c=this.element.width(),d=parseFloat(this.element.css("padding-right"))||0,e=a.offsetX,e||(e=a.clientX-this.element.offset().left),c-d-e<0&&b.isFunction(this._clear)&&this._clear())}function y(a,b){this.option=b,this._monthPrev.removeClass("date-chooser-prev-disabled"),this._monthNext.removeClass("date-chooser-next-disabled"),this._initDateRange(),this.isDateTime()||this._setTodayButton(),this.setLayoutPanel(b.layoutPanel),this.element=a,this.selectingHandler=b.selectingHandler,this.selectedHandler=b.selectedHandler,this.clearHandler=b.cancelHandler,"INPUT"===a.nodeName()?(this.onMousemoveHandler=w.bind(this),this.onMouseupHandler=x.bind(this)):(this.onMousemoveHandler=u,this.onMouseupHandler=u)}var z="year-selected",A="month-selected",B=/y+/i,C=/M+/,D=/d+/i,E=/h+/i,F=/m+/,G=/s+/i;c.prototype={constructor:c,initialize:function(a,b,c,d){this.year=a,this.month=b,this.day=c,this.dateChooser=d,this.today=null,this._isCurrentMonth=!0},isCurrentMonth:function(a){return arguments.length>0?(this._isCurrentMonth=a,this):this._isCurrentMonth},setToday:function(a){this.today=a},isToday:function(){return this.today||(this.today=new Date),this.year===this.today.getFullYear()&&this.month===this.today.getMonth()&&this.day===this.today.getDate()},isTheDay:function(a,b,c){return this.year===a&&this.month===b&&this.day===c},isDisabled:function(){return!!this.dateChooser&&this.dateChooser._isDisabledDay(this.year,this.month,this.day)},lt:function(a,b,c){var d=new Date(this.year,this.month,this.day),e=new Date(a,b,c);return d.getTime()<e.getTime()},gt:function(a,b,c){var d=new Date(this.year,this.month,this.day),e=new Date(a,b,c);return d.getTime()>e.getTime()},toDate:function(){return new Date(this.year,this.month,this.day,0,0,0)}},
a.ctrls.define("ui.ctrls.DateChooser",a.ctrls.DropDownBase,{_defineOption:function(){return{dateFormat:"yyyy-MM-dd",calendarPanel:null,isDateTime:!1,startDate:null,endDate:null}},_defineEvents:function(){return["selecting","selected","cancel"]},_create:function(){var a;this._super(),this.isDateTime()?this.option.dateFormat=this.option.dateFormat||"yyyy-MM-dd hh:mm:ss":this.option.dateFormat=this.option.dateFormat||"yyyy-MM-dd",this._initDateRange(),a=this.formatDateValue(new Date),this._setCurrentDate(a),this._language=this.i18n(),this.onYearChangedHandler=j.bind(this),this.onYearSelectedHandler=k.bind(this),this.onMonthSelectedHandler=l.bind(this),this.onApplyYearMonthHandler=m.bind(this),this.onCancelYearMonthHandler=n.bind(this),this.onMonthChangedHandler=o.bind(this),this.onCalendarTitleClickHandler=p.bind(this),this.onDayItemClickHandler=q.bind(this),this.onTodayButtonClickHandler=r.bind(this),this.isDateTime()&&(this.onTimeMousewheelHandler=s.bind(this),this.onTimeTextinputHandler=t.bind(this))},_initDateRange:function(){this.startDay=null,a.core.isString(this.option.startDate)&&this.option.startDate.length>0&&(this.startDay=h.call(this,this.option.startDate,this.option.dateFormat)),this.endDay=null,a.core.isString(this.option.endDate)&&this.option.endDate.length>0&&(this.endDay=h.call(this,this.option.endDate,this.option.dateFormat))},_render:function(){this._calendarPanel=a.getJQueryElement(this.option.calendarPanel),this._calendarPanel?this._calendarPanel.css("position","relative"):this._calendarPanel=b("<div />"),this._calendarPanel.addClass("ui-date-chooser-panel").addClass("border-highlight").on("click",function(a){a.stopPropagation()}),this._showClass="ui-date-chooser-show",this._panel=this._calendarPanel,this._selectTextClass="ui-date-text",this._clearClass="ui-clear-text",this._clear=function(){this.cancelSelection()}.bind(this),this._initCalendarPanel(),this._initYearMonthPanel(),this._initYearMonthPanelAnimator(),this._initCalendarChangeAnimator()},_initYearMonthPanelAnimator:function(){this.ymAnimator=a.animator({target:this._settingPanel,onChange:function(a){this.target.css("top",a+"px")}}),this.ymAnimator.duration=240},_initCalendarChangeAnimator:function(){this.mcAnimator=a.animator({onChange:function(a){this.target.css("left",a+"px")}}).add({onChange:function(a){this.target.css("left",a+"px")}}),this.mcAnimator.duration=240},_initYearMonthPanel:function(){var a,c,d,e,f;this._settingPanel=b("<div class='year-month-setting-panel' />"),a=b("<div class='set-title font-highlight' style='height:24px;line-height:24px;' />"),this._settingPanel.append(a),d=b("<div class='date-chooser-prev'/>"),d.on("click",{value:-10},this.onYearChangedHandler),a.append(d),this._yearPrev=d,a.append("<div class='date-chooser-title'><span id='yearTitle'>"+this._language.year+"</span></div>"),e=b("<div class='date-chooser-next'/>"),e.on("click",{value:10},this.onYearChangedHandler),a.append(e),this._yearNext=e,a.append(b("<br clear='left' />")),this._settingPanel.append(this._createYearPanel()),c=b("<div class='set-title font-highlight' style='text-align:center;height:27px;line-height:27px;' />"),f=[],f.push("<fieldset class='title-fieldset border-highlight'>"),f.push("<legend class='title-legend font-highlight'>",this._language.month,"</legend>"),f.push("</fieldset>"),c.html(f.join("")),this._settingPanel.append(c),this._settingPanel.append(this._createMonthPanel()),this._settingPanel.append(this._createOkCancel()),this._calendarPanel.append(this._settingPanel)},_createYearPanel:function(){var a,c,d,e,f,g;for(a=b("<div class='date-chooser-year-panel' />"),this._yearsTable=b("<table class='date-chooser-table' cellpadding='0' cellspacing='0' />"),this._yearsTable.on("click",this.onYearSelectedHandler),c=b("<tbody />"),f=0;f<3;f++){for(d=b("<tr />"),g=0;g<5;g++)e=b("<td class='date-chooser-year-td' />"),d.append(e);c.append(d)}return this._yearsTable.append(c),a.append(this._yearsTable),a},_createMonthPanel:function(){var a,c,d,e,f,g,h;for(a=b("<div class='date-chooser-month-panel' />"),this._monthsTable=b("<table class='date-chooser-table' cellpadding='0' cellspacing='0' />"),this._monthsTable.on("click",this.onMonthSelectedHandler),c=b("<tbody />"),h=0,f=0;f<3;f++){for(d=b("<tr />"),g=0;g<4;g++)e=b("<td class='date-chooser-month-td' />"),e.html(this._language.months[h]),e.attr("data-month",h++),d.append(e);c.append(d)}return this._monthsTable.append(c),a.append(this._monthsTable),a},_createOkCancel:function(){var a=b("<div class='date-chooser-operate-panel' />");return a.append(this._createButton(this.onApplyYearMonthHandler,"<i class='far fa-check'></i>",null,{"margin-right":"10px"})),a.append(this._createButton(this.onCancelYearMonthHandler,"<i class='far fa-times'></i>")),a},_initCalendarPanel:function(){this._calendarPanel.append(this._createTitlePanel()),this._calendarPanel.append(this._createDatePanel()),this._calendarPanel.append(this._createCtrlPanel())},_createTitlePanel:function(){var a,c,d,e;return a=b("<div class='date-chooser-calendar-title' />"),c=b("<div class='date-chooser-prev' />"),c.on("click",{value:-1},this.onMonthChangedHandler),a.append(c),this._monthPrev=c,e=b("<div class='date-chooser-title' />"),this._linkBtn=b("<a href='javascript:void(0)' class='date-chooser-title-text font-highlight' />"),this._linkBtn.on("click",this.onCalendarTitleClickHandler),this._updateCalendarTitle(),e.append(this._linkBtn),a.append(e),d=b("<div class='date-chooser-next' />"),d.on("click",{value:1},this.onMonthChangedHandler),a.append(d),this._monthNext=d,a},_createDatePanel:function(){var a=b("<div class='date-chooser-calendar-panel' />");return a.append(this._createWeekHead()),a.append(this._createDaysBody()),a},_createWeekHead:function(){var a,c,d,e,f,g;for(a=b("<div class='date-chooser-week-panel'/>"),c=b("<table class='date-chooser-table' cellpadding='0' cellspacing='0' />"),d=b("<tbody />"),e=b("<tr />"),g=0;g<7;g++)f=b("<th class='date-chooser-calendar-th' />"),f.text(this._language.weeks[g]),0!==g&&6!==g||f.addClass("date-chooser-weekend"),e.append(f);return d.append(e),c.append(d),a.append(c),a},_createDaysBody:function(){var a;return a=b("<div class='date-chooser-days-panel' />"),this._currentDays=this._createDaysTable(),this._nextDays=this._createDaysTable(),this._nextDays.css("display","none"),a.append(this._currentDays),a.append(this._nextDays),a.on("click",this.onDayItemClickHandler),a},_createDaysTable:function(){var a,c,d,e,f;for(a=b("<table class='date-chooser-table' cellpadding='0' cellspacing='0' />"),c=b("<tbody />"),e=0;e<6;e++){for(d=b("<tr />"),f=0;f<7;f++)d.append(b("<td class='date-chooser-calendar-td' />"));c.append(d)}return a.append(c),a},_createCtrlPanel:function(){var a,c,e;return a=b("<div class='date-chooser-operate-panel' />"),c=new Date,this.isDateTime()?(e=d(c.getHours()),this.hourText=b("<input type='text' class='hour date-chooser-time-input font-highlight-hover' />"),this.hourText.val(e),this.hourText.textinput(this.onTimeTextinputHandler),a.append(this.hourText),a.append("<span style='margin-left:2px;margin-right:2px;'>:</span>"),e=d(c.getMinutes()),this.minuteText=b("<input type='text' class='minute date-chooser-time-input font-highlight-hover' />"),this.minuteText.val(e),this.minuteText.textinput(this.onTimeTextinputHandler),a.append(this.minuteText),a.append("<span style='margin-left:2px;margin-right:2px;'>:</span>"),e=d(c.getSeconds()),this.secondText=b("<input type='text' class='second date-chooser-time-input font-highlight-hover' />"),this.secondText.val(e),this.secondText.textinput(this.onTimeTextinputHandler),a.append(this.secondText),a.on("wheel",this.onTimeMousewheelHandler)):this._setTodayButton(function(){this._todayButton=this._createButton(this.onTodayButtonClickHandler,c.getDate()),a.append(this._todayButton)}),a},_setTodayButton:function(a,b){var c;a&&a.call(this),b||(b=new Date),c=!this.startDay||this.startDay.lt(b.getFullYear(),b.getMonth(),b.getDate()),c=c&&(!this.endDay||this.endDay.gt(b.getFullYear(),b.getMonth(),b.getDate())),c?(this._todayButton.attr("title",this.formatDateValue(b)),this._todayButton.removeAttr("disabled")):(this._todayButton.removeAttr("title"),this._todayButton.attr("disabled","disabled"))},_createButton:function(c,d,e,f){var g=b("<button class='icon-button date-chooser-button' />");return d&&g.html(d),e&&g.addClass(e),a.core.isObject(f)&&g.css(f),c&&g.on("click",c),g},_setCurrentDate:function(a){var b=this.option.dateFormat,c=new Date;this._selYear=g.call(this,B,a,b),this._selMonth=g.call(this,C,a,b),this._selDay=g.call(this,D,a,b),(isNaN(this._selYear)||this._selYear<=1970||this._selYear>9999)&&(this._selYear=c.getFullYear()),this._selMonth--,(isNaN(this._selMonth)||this._selMonth<0||this._selMonth>11)&&(this._selMonth=c.getMonth()),(isNaN(this._selDay)||this._selDay<=0||this._selDay>31)&&(this._selDay=c.getDate()),this._isDisabledDay(this._selYear,this._selMonth,this._selDay)&&(this._selYear=this.startDay.year,this._selMonth=this.startDay.month,this._selDay=this.startDay.day)},_setCurrentTime:function(a){var b,c,e,f,h;this.isDateTime()&&(f=this.option.dateFormat,h=new Date,b=g.call(this,E,a,f),c=g.call(this,F,a,f),e=g.call(this,G,a,f),(isNaN(b)||b<0||b>=24)&&(b=h.getHours()),(isNaN(c)||c<0||c>=60)&&(c=h.getMinutes()),(isNaN(e)||e<0||e>=60)&&(e=h.getSeconds()),this.hourText.val(d(b)),this.minuteText.val(d(c)),this.secondText.val(d(e)))},_updateCalendarTitle:function(){this._linkBtn.html(e.call(this,this._selYear,this._selMonth))},_fillMonth:function(a,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;if(this._checkPrev(d,e,this._monthPrev),this._checkNext(d,e,this._monthNext),f=[],h=new Date(d,e,1),(j=h.getDay())>0)for(g=new Date(d,e,0),k=g.getFullYear(),l=g.getMonth(),m=g.getDate(),n=m-(j-1);n<=m;n++)f.push(c(k,l,n,this).isCurrentMonth(!1));for(t=new Date(d,e+1,0).getDate(),n=1;n<=t;n++)f.push(c(d,e,n,this));for(i=new Date(e,e+1,1),k=i.getFullYear(),l=i.getMonth(),t=42-f.length,n=1;n<=t;n++)f.push(c(k,l,n,this).isCurrentMonth(!1));for(s=new Date,a.data("days",f),q=a[0].rows,n=0;n<6;n++)for(o=0;o<7;o++)p=7*n+o,m=f[p],m.setToday(s),r=b(q[n].cells[o]),r.attr("data-index",p),m.isDisabled()?r.addClass("disabled-day").html(""):(r.removeClass("disabled-day").html("<span>"+m.day+"</span>"),m.isTheDay(this._selYear,this._selMonth,this._selDay)&&this._selectItem(r),m.isToday()?r.addClass("font-highlight"):r.removeClass("font-highlight"),m.isCurrentMonth()||r.addClass("other-month-day"))},_fillYear:function(a,c){var d,e,f,g,h,i,j;for(e=15,d=15*Math.floor(a/15),b("#yearTitle").text(d+"年 ~ "+(d+e-1)+"年"),this._checkPrev(d-1,-1,this._yearPrev),this._checkNext(d+e,-1,this._yearNext),this._currentYear&&(this._currentYear.removeClass(z).removeClass("background-highlight"),this._currentYear=null),f=this._yearsTable[0].rows,i=0;i<3;i++)for(j=0;j<5;j++)g=b(f[i].cells[j]),h=d+(5*i+j),this.startDay&&h<this.startDay.year||this.endDay&&h>this.endDay.year?g.addClass("disabled-year"):g.html(h),g.attr("data-year",h),h===a&&(g.addClass(z).addClass("background-highlight"),this._currentYear=g);this._updateMonthsStatus(c)},_updateMonthsStatus:function(a){var c,d,e,f,g,h,i,j,k,l;if(f=parseInt(this._currentYear.attr("data-year"),10),e=new Array(12),this.startDay||this.endDay)for(h=-1,i=-1,this.startDay&&(this.startDay.year===f?h=this.startDay.month:this.startDay.year<f&&(h=0)),this.endDay&&this.endDay.year>=f&&(this.endDay.year===f?i=this.endDay.month:this.endDay.year>f&&(i=11)),k=0;k<e.length;k++)(k<h||k>i)&&(e[k]=!1);for(this._currentMonth&&(this._currentMonth.removeClass(A).removeClass("background-highlight"),this._currentMonth=null),c=this._monthsTable[0].rows,g=null,k=0;k<3;k++)for(l=0;l<4;l++)j=4*k+l,d=b(c[k].cells[l]),!1===e[j]?d.addClass("disabled-month"):(g||(g=d),d.removeClass("disabled-month")),j===a&&!1!==e[j]&&(this._currentMonth=d,d.addClass(A).addClass("background-highlight"));this._currentMonth||(this._currentMonth=g,g.addClass(A).addClass("background-highlight"))},_checkPrev:function(a,b,c){var d,e;this.startDay&&(d=12*this.startDay.year,e=12*a,b>=0&&(d+=this.startDay.month+1,e+=b+1),e<=d?c.addClass("date-chooser-prev-disabled"):c.removeClass("date-chooser-prev-disabled"))},_checkNext:function(a,b,c){var d,e;this.endDay&&(d=12*this.endDay.year,e=12*a,b>=0&&(d+=this.endDay.month+1,e+=b+1),e>=d?c.addClass("date-chooser-next-disabled"):c.removeClass("date-chooser-next-disabled"))},_isDisabledDay:function(a,b,c){return!(!this.startDay||!this.startDay.gt(a,b,c))||!(!this.endDay||!this.endDay.lt(a,b,c))},_getSelectionData:function(a){var b,c,d,e,f=0,g=0,h=0;return e={},this.isDateTime()&&(f=parseInt(this.hourText.val(),10)||0,g=parseInt(this.minuteText.val(),10)||0,h=parseInt(this.secondText.val(),10)||0),b=parseInt(a.attr("data-index"),10),c=a.parent().parent().parent(),c=c.data("days"),d=c[b],e.date=new Date(d.year,d.month,d.day,f,g,h),e.value=this.formatDateValue(e.date),e},_selectItem:function(a){var c;a.hasClass("disabled-day")||(c=this._getSelectionData(a),a.element=a,c.originElement=a.context?b(a.context):null,!1!==this.fire("selecting",c)&&(this._selYear=c.date.getFullYear(),this._selMonth=c.date.getMonth(),this._selDay=c.date.getDate(),this._currentDate&&this._currentDate.removeClass("date-selected").removeClass("background-highlight"),this._currentDate=a,this._currentDate.addClass("date-selected").addClass("background-highlight"),this.fire("selected",c)))},_openYearMonthPanel:function(){var b;b=this.ymAnimator[0],b.target.css("display","block"),b.begin=parseFloat(b.target.css("top")),b.end=0,b.ease=a.AnimationStyle.easeTo,this.ymAnimator.start()},_closeYearMonthPanel:function(){var b;b=this.ymAnimator[0],b.begin=parseFloat(b.target.css("top")),b.end=-b.target.height(),b.ease=a.AnimationStyle.easeFrom,this.ymAnimator.start().then(function(){b.target.css("display","none")}),this._currentYear.removeClass(z).removeClass("background-highlight"),this._currentMonth.removeClass(A).removeClass("background-highlight"),this._currentYear=null,this._currentMonth=null},_changeMonth:function(b,c,d){var e,f,g,h,i;this.mcAnimator.isStarted||(f=this._currentDays.parent(),h=f.width(),g=parseFloat(this._currentDays.css("left"))||0,e=this.mcAnimator[0],e.target=this._currentDays,e.begin=g,e.end=c?-h:h,e=this.mcAnimator[1],e.target=this._nextDays,e.target.css("display","block"),c?(e.begin=h-g,e.target.css("left",e.begin+"px")):(e.begin=g-h,e.target.css("left",e.begin+"px")),e.end=0,this._selYear=b.getFullYear(),this._selMonth=b.getMonth(),this._updateCalendarTitle(),this._fillMonth(this._nextDays,this._selYear,this._selMonth),f.addClass("click-disabled"),i=this,this.mcAnimator.start().then(function(){var b=i._currentDays;i._currentDays=i._nextDays,i._nextDays=b,i._nextDays.css("display","none"),f.removeClass("click-disabled"),a.core.isFunction(d)&&d.call(i)}))},isDateTime:function(){return!!this.option.isDateTime},setSelection:function(a){var c,d,e,f,g;a&&!this._isDisabledDay(a.getFullYear(),a.getMonth(),a.getDate())&&(f=new Date(a.getFullYear(),a.getMonth(),1),c=f.getDay()+a.getDate()-1,d=Math.floor(c/7),e=c-7*d,g=b(this._currentDays[0].rows[d].cells[e]),g.length>0&&this._selectItem(g))},getSelection:function(){return this._currentDate?this._getSelectionData(this._currentDate):null},cancelSelection:function(){this._currentDate&&this._currentDate.removeClass("date-selected").removeClass("background-highlight"),this.fire("cancel")},setDateValue:function(a){this._setCurrentDate(a),this.isDateTime()&&this._setCurrentTime(a),this._updateCalendarTitle(),this._fillMonth(this._currentDays,this._selYear,this._selMonth)},formatDateValue:function(a){var b=this.option.dateFormat;return b=f(B,a.getFullYear(),b),b=f(C,a.getMonth()+1,b),b=f(D,a.getDate(),b),this.isDateTime()&&(b=f(E,a.getHours(),b),b=f(F,a.getMinutes(),b),b=f(G,a.getSeconds(),b)),b},show:function(){var a,b,c,d,e;this._todayButton&&(d=new Date,c=parseInt(this._todayButton.text(),10),d.getDate()!==c&&this._todayButton.html(d.getDate()).attr("title",this.formatDateValue(d))),a=this,b=this._super,e=function(){a.moveToElement(a.element,!0),b.call(a)},this.isShow()?this.hide(e):e()}});var H,I;b.fn.dateChooser=function(c){var d,e,f;return 0===this.length?null:(this.hasClass("date-text")&&this.css("width",parseFloat(this.css("width"),10)-23+"px"),d=this.nodeName(),"INPUT"!==d&&"A"!==d&&"SELECT"!==d&&this.attr("tabindex",0),e="INPUT"===d?function(){return this.val()}:function(){return this.text()},c&&c.isDateTime?(I||(c.dateFormat||(c.dateFormat="yyyy-MM-dd hh:mm:ss"),I=v(c,this)),f=I):(H||(H=v(null,this)),f=H),c=a.extend({},f.option,c),this.focus(function(d){var g,h=b(d.target);f.isShow()&&f.element&&f.element[0]===h[0]||(f.element&&f.element.removeClass(f._clearClass),y.call(f,h,c),g=e.call(h),f.setDateValue(g),a.hideAll(f),f.show())}).on("click",function(a){a.stopPropagation()}),f)}}(ui,ui.$),function(a,b){function c(a){var b,c,d,e;for(c=a.split("."),b=this[c[0]],d=1,e=c.length;d<e&&(void 0!==(b=b[c[d]])&&null!==b);d++);return void 0===b&&(b=null),b}function d(a){for(var b,c=[],d=0;d<a.length;d++)b=this[a[d]],void 0===b&&(b=null),c.push(b+"");return c.join("_")}function e(c,d,e){var f="";return a.core.isString(c)?f=c:c&&(f=this._getText.call(c,this.option.textField)),b("<span />").text(f)}function f(a,b){b?a.removeClass("fa-square").addClass("fa-check-square").addClass("font-highlight"):a.removeClass("fa-check-square").removeClass("font-highlight").addClass("fa-square")}function g(a){return a.hasClass("fa-check-square")}function h(a){var c;for(this.isMultiple()&&a.stopPropagation(),c=b(a.target);"LI"!==c.nodeName()&&!c.hasClass("ui-selection-list-li");){if(c.hasClass("ui-selection-list-panel"))return;c=c.parent()}c[0]!==a.target&&(c.context=a.target),this._selectItem(c)}var i="ui-selection-list-selected",j="ui-selection-list-checkbox";a.ctrls.define("ui.ctrls.SelectionList",a.ctrls.DropDownBase,{_defineOption:function(){return{multiple:!1,valueField:null,textField:null,viewData:null,itemFormatter:null,width:null}},_defineEvents:function(){return["changing","changed","cancel"]},_create:function(){var a,e;this._super(),this._current=null,this._selectList=[],a=[this.option.valueField,this.option.textField],e=["_getValue","_getText"],a.forEach(function(a,f){Array.isArray(a)?this[e[f]]=d:b.isFunction(a)?this[e[f]]=a:this[e[f]]=c},this),this.onItemClickHandler=h.bind(this)},_render:function(){this.listPanel=b("<div class='ui-selection-list-panel border-highlight' />"),this.listPanel.on("click",this.onItemClickHandler),this.wrapElement(this.element,this.listPanel),this._showClass="ui-selection-list-show",this._clearClass="ui-clear-text",this._clear=function(){this.cancelSelection()},this._selectTextClass="ui-select-text",this.initPanelWidth(this.option.width),a.core.isFunction(this.option.itemFormatter)?this.itemFormatter=this.option.itemFormatter:this.itemFormatter=e,Array.isArray(this.option.viewData)&&this._fill(this.option.viewData),this._super()},_fill:function(a){var c,d,e;for(this.clear(),c=b("<ul class='ui-selection-list-ul' />"),e=0;e<a.length;e++)this.option.viewData.push(a[e]),d=b("<li class='ui-selection-list-li' />"),this.isMultiple()&&d.append(this._createCheckbox()),d.append(this.itemFormatter(a[e],e,d)),d.attr("data-index",e),c.append(d);this.listPanel.append(c)},_createCheckbox:function(){var a=b("<i class='fa fa-square' />");return a.addClass(j),a},_getItemIndex:function(a){return parseInt(a.getAttribute("data-index"),10)},_getSelectionData:function(a){var b=this._getItemIndex(a),c={},d=this.getViewData();return c.itemData=d[b],c.itemIndex=b,c},_selectItem:function(c,d,e){var h,k,l,m,n;if(h=this._getSelectionData(c[0]),h.element=c,h.originElement=c.context?b(c.context):null,l=this.isMultiple(),l&&(k=c.find("."+j)),a.core.isBoolean(d)?h.isSelection=d:h.isSelection=!l||!g.call(this,k),!1!==this.fire("changing",h)){if(l)if(h.isSelection){if(g.call(this,k))return;f.call(this,k,!0),this._selectList.push(c[0])}else{if(!g.call(this,k))return;for(m=0,n=this._selectList.length;m<n;m++)if(this._selectList[m]===c[0]){f.call(this,k,!1),this._selectList.splice(m,1);break}}else{if(this._current){if(this._current[0]==c[0])return;this._current.removeClass(i).removeClass("background-highlight")}this._current=c,this._current.addClass(i).addClass("background-highlight")}!1!==e&&this.fire("changed",h)}},_selectByValues:function(a,c){var d,e,f,g,h,i;for(d=a.length,a=a.slice(0),e=this.getViewData(),g=0,i=e.length;g<i;g++)for(f=e[g],h=0;h<d;h++)if(this._equalValue(f,a[h])){c.elem=b(this.listPanel.children("ul").children()[g]),this._selectItem(c.elem,!0,!1),d--,a.splice(h,1);break}},_equalValue:function(b,c){return a.core.isString(b)?b===c+"":a.core.isObject(b)&&!a.core.isObject(c)?this._getValue.call(b,this.option.valueField)===c:this._getValue.call(b,this.option.valueField)===this._getValue.call(c,this.option.valueField)},getSelection:function(){var a,b,c=null;if(this.isMultiple())for(c=[],a=0,b=this._selectList.length;a<b;a++)c.push(this._getSelectionData(this._selectList[a]).itemData);else this._current&&(c=this._getSelectionData(this._current[0]).itemData);return c},getSelectionValues:function(){var a,b,c,d=null;if(this.isMultiple())for(d=[],b=0,c=this._selectList.length;b<c;b++)a=this._getSelectionData(this._selectList[b]).itemData,d.push(this._getValue.call(a,this.option.valueField));else this._current&&(a=this._getSelectionData(this._current[0]).itemData,d=this._getValue.call(a,this.option.valueField));return d},setSelection:function(a){var b,c;this.cancelSelection(),this.isMultiple()?Array.isArray(a)||(a=[a]):a=Array.isArray(a)?[a[0]]:[a],b={elem:null},this._selectByValues(a,b),b.elem&&(c=this._getSelectionData(b.elem[0]),c.element=b.elem,c.originElement=null,this.fire("changed",c))},cancelSelection:function(c,d){var e,g,h,k,l,m;if(a.core.isBoolean(c)&&(d=c,c=null),this.isMultiple()){if(m=!1,c){for(c=Array.isArray(c)?Array.from(c):[c],k=this._selectList.length-1;k>=0&&0!==c.length;k--)for(e=b(this._selectList[k]),l=this._getSelectionData(e[0]).itemData,g=0,h=c.length;g<h;g++)if(this._equalValue(l,c[g])){this._selectItem(e,!1),c.splice(g,1);break}}else{for(g=0,h=this._selectList.length;g<h;g++)e=b(this._selectList[g]),f.call(this,e.find("."+j),!1);this._selectList=[]}m=0===this._selectList.length}else m=!0,this._current&&(this._current.removeClass(i).removeClass("background-highlight"),this._current=null);!1!==d&&m&&this.fire("cancel")},setViewData:function(a){Array.isArray(a)&&this._fill(a)},getViewData:function(){return Array.isArray(this.option.viewData)?this.option.viewData:[]},count:function(){return this.viewData.length},isMultiple:function(){return!0===this.option.multiple},clear:function(){this.option.viewData=[],this.listPanel.empty(),this._current=null,this._selectList=[]}}),b.fn.selectionList=function(b){return 0===this.length?null:a.ctrls.SelectionList(b,this)}}(ui,ui.$),function(a,b){function c(a,b){var c=this[s];c||(c={},this[s]=c),c[a]=b}function d(a){var b=this[s];return b?b[a]||null:null}function e(){return d.call(this,"parentNode")}function f(a){var b,c,d,e;for(c=a.split("."),b=this[c[0]],d=1,e=c.length;d<e&&(void 0!==(b=b[c[d]])&&null!==b);d++);return void 0===b&&(b=null),b}function g(a){for(var b,c=[],d=0;d<a.length;d++)b=this[a[d]],void 0===b&&(b=null),c.push(b+"");return c.join("_")}function h(a,c,d){var e=b("<span />").text(a);return c>0&&e.css("margin-left",c),e}function i(a,b){b?a.removeClass("fa-square").addClass("fa-check-square").addClass("font-highlight"):a.removeClass("fa-check-square").removeClass("font-highlight").addClass("fa-square")}function j(a){return a.hasClass("fa-check-square")}function k(a){var c,d,e;if(this.isMultiple()&&a.stopPropagation(),c=b(a.target),c.hasClass(p))return a.stopPropagation(),void this.onTreeFoldClickHandler(a);for(;"DT"!==c.nodeName()&&!c.hasClass("ui-selection-tree-dt");){if(c.hasClass("ui-selection-tree-panel"))return;c=c.parent()}c[0]!==a.target&&(c.context=a.target),d=this._getNodeData(c),e=this._hasChildren(d),!0!==this.option.nodeSelectable&&e?e&&(a.stopPropagation(),this.onTreeFoldClickHandler({target:c.children(".fold-button")[0]})):this._selectItem(c,d)}function l(a){var c,d;c=b(a.target),d=c.parent(),c.hasClass(q)?this._setChildrenExpandStatus(d,!1,c):this._setChildrenExpandStatus(d,!0,c)}function m(a){var c,d,e;c=b(a.target),d=c.parent(),e=d.next(),c.hasClass(q)?this._setChildrenExpandStatus(d,!1,c):(this._setChildrenExpandStatus(d,!0,c),0===e.children().length&&this._loadChildren(d,e,this._getNodeData(d)))}var n="ui-selection-tree-selected",o="ui-selection-tree-checkbox",p="fold-button",q="expand-button",r=0,s="_extensions";a.ctrls.define("ui.ctrls.SelectionTree",a.ctrls.DropDownBase,{_defineOption:function(){return{multiple:!1,valueField:null,textField:null,parentField:null,childField:null,viewData:null,nodeSelectable:!0,defaultExpandLevel:!1,lazy:!1,itemFormatter:null,width:null}},_defineEvents:function(){return["changing","changed","cancel"]},_create:function(){var c,d;this._super(),this._current=null,this._selectList=[],this._treePrefix="selectionTree_"+ ++r+"_",c=[this.option.valueField,this.option.textField,this.option.parentField],d=["_getValue","_getText","_getParent"],c.forEach(function(a,c){Array.isArray(a,c)?this[d[c]]=g:b.isFunction(a)?this[d[c]]=a:this[d[c]]=f},this),!1===this.option.defaultExpandLevel?this.expandLevel=0:a.core.isNumber(this.option.defaultExpandLevel)?this.expandLevel=this.option.defaultExpandLevel<=0?0:this.option.defaultExpandLevel:this.expandLevel=1e3,this.option.lazy?(a.core.isFunction(this.option.lazy.hasChildren)&&(this._hasChildren=this.option.lazy.hasChildren),a.core.isFunction(this.option.lazy.loadChildren)&&(this._loadChildren=this.option.lazy.loadChildren,this.expandLevel=0),this.onTreeFoldClickHandler=m.bind(this),this.option.lazy=!0):(this.onTreeFoldClickHandler=l.bind(this),this.option.lazy=!1),a.core.isFunction(this.option.itemFormatter)||(this.option.itemFormatter=h),this.onTreeItemClickHandler=k.bind(this)},_render:function(){this.treePanel=b("<div class='ui-selection-tree-panel border-highlight' />"),this.treePanel.on("click",this.onTreeItemClickHandler),this.wrapElement(this.element,this.treePanel),this._showClass="ui-selection-tree-show",this._clearClass="ui-clear-text",this._clear=function(){this.cancelSelection()},this._selectTextClass="ui-select-text",this.initPanelWidth(this.option.width),a.core.isFunction(this.option.itemFormatter)?this.itemFormatter=this.option.itemFormatter:this.itemFormatter=h,Array.isArray(this.option.viewData)&&this._fill(this.option.viewData),this._super.apply(this,arguments)},_fill:function(a){var c,d;this.clear(),this.option.viewData=a,c=b("<dl class='ui-selection-tree-dl' />"),d=this.getViewData(),this.option.childField?this._renderTree(d,c,0):this.option.parentField&&this._listDataToTree(d,c,0),this.treePanel.append(c)},_listDataToTree:function(b,c,d){var e;Array.isArray(b)&&0!==b.length&&(this.originalViewData=b,e="children",b=a.trans.listToTree(b,this.option.parentField,this.option.valueField,e),b?(this.option.childField=e,this.option.viewData=b,this._renderTree(b,c,d)):delete this.originalViewData)},_renderTree:function(a,d,f,g,h){var i,j,k,l,m,n,o,p,r,s,t,u;if(Array.isArray(a)&&0!==a.length)for(u=g,m=0,n=a.length;m<n;m++)o=0,l=a[m],i=u?u+"_"+m:""+m,j=this._getText.call(l,this.option.textField)||"",c.call(l,"parentNode",h||null),c.call(l,"elementId",i),l.getParent=e,r=b("<dt class='ui-selection-tree-dt' />"),this.isMultiple()&&(t=this._createCheckbox()),r.prop("id",this._treePrefix+i),d.append(r),this._hasChildren(l)?(k=this._getChildren(l),s=b("<dd class='ui-selection-tree-dd' />"),f+1<=this.expandLevel?r.append(this._createFoldButton(f,q,"fa-angle-down")):(r.append(this._createFoldButton(f,"fa-angle-right")),s.css("display","none")),!0===this.option.nodeSelectable&&t&&r.append(t),this.option.lazy?f+1<=this.expandLevel&&this._loadChildren(r,s,l):(p=b("<dl class='ui-selection-tree-dl' />"),this._renderTree(k,p,f+1,i,l),s.append(p)),d.append(s)):(o=17*(f+1)+3,t&&(t.css("margin-left",o+"px"),o=0,r.append(t))),r.append(this.option.itemFormatter.call(this,j,o,l,r))},_createCheckbox:function(){var a=b("<i class='fa fa-square' />");return a.addClass(o),a},_createFoldButton:function(a){var c,d,e;for(c=b("<i class='fold-button font-highlight-hover far' />"),d=1,e=arguments.length;d<e;d++)c.addClass(arguments[d]);return c.css("margin-left",17*a+3+"px"),c},_setChildrenExpandStatus:function(a,b,c){var d=a.next();c&&0!==c.length||(c=a.children(".fold-button")),b?(c.addClass(q).removeClass("fa-angle-right").addClass("fa-angle-down"),d.css("display","block")):(c.removeClass(q).removeClass("fa-angle-down").addClass("fa-angle-right"),d.css("display","none"))},_getChildren:function(a){return a[this.option.childField]||null},_hasChildren:function(a){var b=this._getChildren(a);return Array.isArray(b)&&b.length>0},_loadChildren:function(c,d,e){var f,g;f=this._getChildren(e),Array.isArray(f)&&f.length>0&&(g=b("<dl />"),this._renderTree(f,g,this._getLevel(e)+1,a.str.trimLeft(c.prop("id"),this._treePrefix),e),d.append(g))},_getLevel:function(a){for(var b,c=0;b=a.getParent();)c++,a=b;return c},_getNodeData:function(a){var b;return a?(b=a.prop("id"),0===b.length||0!==b.indexOf(this._treePrefix)?null:(b=b.substring(this._treePrefix.length),this._getNodeDataByPath(b))):null},_getNodeDataByPath:function(a){var b,c,d,e,f;if(!a)return null;for(b=a.split("_"),d=this.getViewData(),c=d[parseInt(b[0],10)],e=1,f=b.length;e<f;e++)c=this._getChildren(c)[parseInt(b[e],10)];return c},_getSelectionData:function(a,b){var c={};return b||(b=this._getNodeData(a)),c.nodeData=b,c.children=this._getChildren(b),c.parent=c.nodeData.getParent(),c.isRoot=!c.parent,c.isNode=this._hasChildren(b),c},_selectItem:function(c,d,e,f){var g,h,k,l,m;if(g=this._getSelectionData(c,d),g.element=c,g.originElement=c.context?b(c.context):null,k=this.isMultiple(),k&&(h=c.find("."+o)),a.core.isBoolean(e)?g.isSelection=e:g.isSelection=!k||!j.call(this,h),!1!==this.fire("changing",g)){if(k)if(g.isSelection){if(j.call(this,h))return;i.call(this,h,!0),this._selectList.push(c[0])}else{if(!j.call(this,h))return;for(l=0,m=this._selectList.length;l<m;l++)if(this._selectList[l]===c[0]){i.call(this,h,!1),this._selectList.splice(l,1);break}}else{if(this._current){if(this._current[0]==c[0])return;this._current.removeClass(n).removeClass("background-highlight")}this._current=c,this._current.addClass(n).addClass("background-highlight")}!1!==f&&this.fire("changed",g)}},_selectTreeByValues:function(a,b,c,d,e){var f,g,h,i,j;if(Array.isArray(a)&&0!==a.length&&Array.isArray(b)&&0!==b.length)for(f=0,h=a.length;f<h;f++){for(i=a[f],j=d?d+"_"+f:""+f,g=0;g<b.length;g++)if(this._equalValue(i,b[g])){e.elem=this._selectNodeByValue(i,j),b.splice(g,1);break}if(0===b.length)break;this._selectTreeByValues(this._getChildren(i),b,c+1,j,e)}},_equalValue:function(b,c){return a.core.isObject(b)&&!a.core.isObject(c)?this._getValue.call(b,this.option.valueField)===c:this._getValue.call(b,this.option.valueField)===this._getValue.call(c,this.option.valueField)},_selectNodeByValue:function(a,c){var d,e,f,g,h,i,j;if(this.option.lazy){for(f=[],g=c.split("_"),e="#"+this._treePrefix+c,d=b(e);0===d.length&&(f.push(e),g.splice(g.length-1,1),0!==g.length);)e="#"+this._treePrefix+g.join("_"),d=b(e);if(0===d.length)return;for(h=f.length-1;h>=0;h--)i=d,j=i.next(),this._loadChildren(i,j,this._getNodeData(i)),d=b(f[h])}else d=b("#"+this._treePrefix+c);for(j=d.parent().parent();"DD"===j.nodeName()&&j.hasClass("ui-selection-tree-dd");)i=j.prev(),"none"===j.css("display")&&this._setChildrenExpandStatus(i,!0),j=i.parent().parent();return this._selectItem(d,a,!0,!1),d},_selectChildNode:function(a,c,d){var e,f,g,h,i;if(e=this._getChildren(a),Array.isArray(e)&&0!==e.length)for(f=c.prop("id"),g=c.next(),this.option.lazy&&0===g.children().length&&this._loadChildren(c,g,a),h=0,i=e.length;h<i;h++)a=e[h],c=b("#"+f+"_"+h),this._selectItem(c,a,d,!1),this._selectChildNode(a,c,d)},_selectParentNode:function(a,c,d){var e,f,g,h,i,k,l,m;if(e=a.getParent()){
if(f=c.substring(0,c.lastIndexOf("_")),g=b("#"+f),!d&&(h=g.next(),"DD"===h.nodeName()))for(i=h.find("dt"),k=0,l=i.length;k<l;k++)if(m=b(i[k]).find("."+o),j.call(this,m))return;this._selectItem(g,e,d,!1),this._selectParentNode(e,f,d)}},getSelection:function(){var a,c,d=null;if(this.isMultiple())for(d=[],a=0,c=this._selectList.length;a<c;a++)d.push(this._getNodeData(b(this._selectList[a])));else this._current&&(d=this._getNodeData(this._current));return d},getSelectionValues:function(){var a,c,d,e=null;if(this.isMultiple())for(e=[],c=0,d=this._selectList.length;c<d;c++)a=this._getNodeData(b(this._selectList[c])),e.push(this._getValue.call(a,this.option.valueField));else this._current&&(a=this._getNodeData(this._current),e=this._getValue.call(a,this.option.valueField));return e},setSelection:function(a){var b,c,d;this.cancelSelection(),a=this.isMultiple()?Array.isArray(a)?Array.from(a):[a]:Array.isArray(a)?[a[0]]:[a],b={elem:null},c=this.getViewData(),this._selectTreeByValues(c,a,0,null,b),b.elem&&(d=this._getSelectionData(b.elem),d.element=b.elem,d.originElement=null,d.isSelection=!0,this.fire("changed",d))},selectChildNode:function(a,b){var c;b=1===arguments.length||!!b,(c=this._getNodeData(a))&&this.isMultiple()&&!0===this.option.nodeSelectable&&this._selectChildNode(c,a,b)},selectParentNode:function(a,b){var c,d;b=1===arguments.length||!!b,(c=this._getNodeData(a))&&this.isMultiple()&&!0===this.option.nodeSelectable&&(d=a.prop("id"),this._selectParentNode(c,d,b))},cancelSelection:function(c,d){var e,f,g,h,j,k;if(a.core.isBoolean(c)&&(d=c,c=null),this.isMultiple()){if(k=!1,c){for(c=Array.isArray(c)?Array.from(c):[c],h=this._selectList.length-1;h>=0&&0!==c.length;h--)for(e=b(this._selectList[h]),j=this._getNodeData(e),f=0,g=c.length;f<g;f++)if(this._equalValue(j,c[f])){this._selectItem(e,j,!1),c.splice(f,1);break}}else{for(f=0,g=this._selectList.length;f<g;f++)e=b(this._selectList[f]),i.call(this,e.find("."+o),!1);this._selectList=[]}k=0===this._selectList.length}else k=!0,this._current&&(this._current.removeClass(n).removeClass("background-highlight"),this._current=null);!1!==d&&k&&this.fire("cancel")},setViewData:function(a){Array.isArray(a)&&this._fill(a)},getViewData:function(){return Array.isArray(this.option.viewData)?this.option.viewData:[]},count:function(){return this.viewData.length},isMultiple:function(){return!0===this.option.multiple},clear:function(){this.option.viewData=[],this.treePanel.empty(),this._current=null,this._selectList=[],delete this.originalViewData}}),b.fn.selectionTree=function(b){return 0===this.length?null:a.ctrls.SelectionTree(b,this)}}(ui,ui.$),function(a,b){function c(b){a.hideAll(this),this._resetTreeList(),this.show()}function d(b){b.which===a.keyCode.DOWN?this._moveSelection(1):b.which===a.keyCode.UP?this._moveSelection(-1):b.which===a.keyCode.ENTER&&this._selectCompleter()}function e(a){for(var c=b(a.target);"DT"!==c.nodeName()&&!c.hasClass("autocomplete-dt");){if(c.hasClass("autocomplete-dl"))return;c=c.parent()}this._currentCompleterElement&&this._currentCompleterElement.removeClass(h),this._currentCompleterElement=c,this._currentCompleterElement.addClass(h)}function f(a){a.stopPropagation(),this._selectCompleter()}function g(a){var c=b(a.target),d=c.val(),e=c.data("autocomplete.value");if(!this._cancelAutoComplete)return 0===d.length?(this._resetTreeList(),void this.cancelSelection()):void(this._autoCompleteListIsShow()&&e===d||(c.data("autocomplete.value",d),this.isShow()||this.show(),this._launch(d)))}var h="autocomplete-selected";a.ctrls.define("ui.ctrls.AutocompleteSelectionTree",a.ctrls.SelectionTree,{_create:function(){this.option.multiple=!1,a.core.isNumber(this.option.limit)?this.option.limit<=0?this.option.limit=10:this.option.limit>100&&(this.option.limit=100):this.option.limit=10,this.onFocusHandler=c.bind(this),this.onKeyupHandler=d.bind(this),this.onMouseoverHandler=e.bind(this),this.onClickHandler=f.bind(this),this.onTextinputHandler=g.bind(this),this._super()},_render:function(){var b;this._super({focus:this.onFocusHandler,keyup:this.onKeyupHandler}),a.browser.ie&&a.browser<9&&(b=this.fire,this.fire=function(){this._callAndCancelPropertyChange(b,arguments)}),this.element.textinput(this.onTextinputHandler),this._clear=function(){this.cancelSelection(!0,this._autoCompleteListIsShow())}},_callAndCancelPropertyChange:function(a,b){this._cancelAutoComplete=!0,a.apply(this,b),this._cancelAutoComplete=!1},_launch:function(a){var b,c=this.getViewData();0!==c.length&&(this.cancelSelection(!1,!1),b=this._search(a,c,this.option.limit),this._showSearchInfo(b,a))},_search:function(a,b,c){var d,e=[],f=[];return a=a.toLowerCase(),this._doSearch(e,f,a,b,c),d=e.concat(f),d.slice(0,c)},_doSearch:function(a,b,c,d,e,f){var g,h,i,j;for(g=0,h=d.length;g<h;g++){if(a.length>e)return;j=f?f+"_"+g:""+g,i=d[g],this._hasChildren(i)?(!0===this.option.nodeSelectable&&this._doQuery(a,b,c,i,j),this._doSearch(a,b,c,this._getChildren(i),e,j)):this._doQuery(a,b,c,i,j)}},_doQuery:function(a,b,c,d,e){var f;f=this._getText.call(d,this.option.textField).toLowerCase().search(c),0===f?a.push({nodeData:d,path:e}):f>0&&b.push({nodeData:d,path:e})},_showSearchInfo:function(a,c){var d,e,f,g,h,i,j;for(d=this._autoCompleteList,d?d.empty():(d=this._autoCompleteList=b("<dl class='autocomplete-dl' />"),d.hide(),d.on("click",this.onClickHandler).mouseover(this.onMouseoverHandler),this.treePanel.append(d)),e=[],g=new RegExp(c,"gi"),h="<span class='font-highlight'>"+c+"</span>",i=0,j=a.length;i<j;i++)e.push("<dt class='autocomplete-dt' data-path='"+a[i].path+"'>"),e.push("<span class='normal-text'>"),f=this._getText.call(a[i].nodeData,this.option.textField),f=f.replace(g,h),e.push(f),e.push("</span></dt>");b(this.treePanel.children()[0]).hide(),d.append(e.join("")),d.show(),this._moveSelection(1)},_autoCompleteListIsShow:function(){return!!this._autoCompleteList&&"block"===this._autoCompleteList.css("display")},_resetTreeList:function(){var a=this.treePanel.children();b(a[1]).hide(),b(a[0]).show()},_selectCompleter:function(){var b,c,d;this._currentCompleterElement&&(b=this._currentCompleterElement.attr("data-path"),c=this._getNodeDataByPath(b),c&&(d=this._selectNodeByValue(c,b),this.fire("changed",this._getSelectionData(d,c))),a.hideAll())},_moveSelection:function(a){var c,d;c=b(this.treePanel.children()[1]).children(),this._currentCompleterElement?this._currentCompleterElement.removeClass(h):this._currentCompleterElement=b(c[0]),0===a?this._currentCompleterElement=b(c[0]):1===a?(d=this._currentCompleterElement.next(),0===d.length&&(d=b(c[0])),this._currentCompleterElement=d):-1===a&&(d=this._currentCompleterElement.prev(),0===d.length&&(d=b(c[c.length-1])),this._currentCompleterElement=d),this._currentCompleterElement.addClass(h)},_selectItem:function(){this._callAndCancelPropertyChange(this._super,arguments)},cancelSelection:function(a,b){b?(this._callAndCancelPropertyChange(function(){this.element.val("")}),this._resetTreeList()):this._super(a)}}),b.fn.autocompleteSelectionTree=function(b){return 0===this.length?null:a.ctrls.AutocompleteSelectionTree(b,this)}}(ui,ui.$),function(a,b){function c(){}function d(a){return a<10?"0"+a:""+a}function e(a,b){var c,e,f=a.getHours(),g=a.getMinutes(),h=a.getSeconds();return b&&(c=new Date(b.getFullYear(),b.getMonth(),b.getDate(),0,0,0),e=a-c,(e=e/1e3/60/60)>=24&&(f=24)),[d(f),":",d(g),":",d(h)].join("")}function f(a){return["<span",this.calendar.isWeekend(a.getDay())?" class='ui-calendar-weekend'":"",">",a.getMonth()+1," / ",a.getDate(),"（"+r.sundayFirstWeek[a.getDay()],"）","</span>"].join("")}function g(a){for(var c,d=b(a.target);"TD"!==(c=d.nodeName());){if("TABLE"===c)return;d=d.parent()}d[0]!==a.target&&(d.context=a.target),this._selectItem(d)}function h(a){for(var c,d=b(a.target);"TD"!==(c=d.nodeName());){if("TABLE"===c)return;d=d.parent()}d[0]!==a.target&&(d.context=a.target),this._selectItem(d)}function i(a){for(var c,d,e=b(a.target);"TH"!==(d=e.nodeName());){if("TABLE"===d)return;e=e.parent()}c={view:this,index:e[0].cellIndex},this.calendar.fire("weekTitleClick",c)}function j(a){var b={view:this,index:0};this.calendar.fire("weekTitleClick",b)}function k(a){if(!(this instanceof k))return new k(a);this.initialize(a)}function l(a){if(!(this instanceof l))return new l(a);this.initialize(a)}function m(a){if(!(this instanceof m))return new m(a);this.initialize(a)}function n(a){if(!(this instanceof n))return new n(a);this.initialize(a)}function o(a,b,c){if(!(this instanceof o))return new o(a,b,c);this.initialize(a,b,c)}function p(c){var d,e,f,g;t=!0,s?g=a.StyleSheet(s):(s=b("#GlobalThemeChangeStyle"),0===s.length?(g=a.StyleSheet.createStyleSheet("GlobalThemeChangeStyle"),s=g.styleSheet):g=a.StyleSheet(s)),c||(c=a.theme.currentHighlight||{color:"#3E5A99"}),d=a.theme.backgroundColor||"#FFFFFF",e=c.Color||c.color,f=a.color.overlay(e,d,.4),f=a.color.rgb2hex(f.red,f.green,f.blue),g.setRule(".ui-calendar-selector",{"background-color":f}),g.setRule(".ui-calendar-hour-panel .schedule-item-panel",{"background-color":f}),g.setRule(".ui-calendar-hour-panel .schedule-item-panel:hover",{"background-color":e}),g.setRule(".ui-calendar-month-day-view .month-days-table .selected",{"background-color":f}),g.setRule(".ui-calendar-year-view .year-month-table .selected",{"background-color":f}),f=a.color.overlay(e,d,.85),f=a.color.rgb2hex(f.red,f.green,f.blue),g.setRule(".ui-calendar-hour-panel .week-hour-cell-today",{"background-color":f}),f=a.color.overlay(e,d,.7),f=a.color.rgb2hex(f.red,f.green,f.blue),g.setRule(".ui-calendar-month-day-view .month-days-cell .schedule-item",{"background-color":f}),g.setRule(".ui-calendar-month-day-view .month-days-cell .schedule-border",{"background-color":e})}var q,r=a.i18n("control","ui.ctrls.CalendarView");k.prototype={constructor:k,initialize:function(a){this.calendar=a,this.initialled=!1,this.year=null,this._selectList=[],this._current=null,this.width=null,this.height=null,this.viewPanel=b("<div class='calendar-view-panel' />"),this.calendar.element.append(this.viewPanel)},render:function(){this.initialled||(this.onYearItemClickHandler=g.bind(this),this.yearPanel=b("<div class='ui-calendar-year-view' />"),this._initYear(),this.viewPanel.append(this.yearPanel),this.initialled=!0)},_initYear:function(){var a,c;for(c=0;c<12;c++)a=b("<div class='year-month-panel' />"),a.append(b("<div class='year-month-title' />").append("<span class='font-highlight'>"+(c+1)+r.monthUnit+"</span>")),a.append("<div class='year-month-content' />"),this.yearPanel.append(a);this.yearPanel.append("<br clear='all' />")},_oddStyle:function(a,b,c){c%2&&a.addClass("year-month-odd")},_evenStyle:function(a,b,c){Math.floor(c/b)%2?c%2&&a.addClass("year-month-odd"):c%2==0&&a.addClass("year-month-odd")},_setCellSize:function(c,d){var e,f,g,h,i,j,k;if(c&&d&&(this.width!==c||this.height!==d))for(this.width=c,this.height=d,e=this.getMonthCount(c),f=e%2?this._oddStyle:this._evenStyle,g=this.yearPanel.children(),g.removeClass("year-month-odd"),i=Math.floor(c/e),j=Math.floor(i/4*3),(j*(12/e)>d||this.yearPanel[0].scrollHeight>d)&&(c-=a.scrollbarWidth,i=Math.floor(c/e)),j<248&&(j=248),k=0;k<12;k++)h=b(g[k]),h.css({width:i+"px",height:j+"px"}),h.children(".year-month-content").css("height",j-40+"px"),f.call(this,h,e,k)},_changeYear:function(a){this.calendar.currentDate=a,this.year=this.calendar.currentDate.getFullYear(),this._setCellSize(this.viewPanel.width(),this.viewPanel.height()),this._updateYear(),this._current=null,this._selectList=[]},_updateYear:function(){var a,c=this.yearPanel.children(".year-month-panel"),d=this.calendar.currentDate.getFullYear(),e=null,f=new Date;for(a=0;a<12;a++)e=b(c[a]),this._createMonth(b(e.children()[1]),d,a,f)},_createMonth:function(a,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t;for(f=b("<table class='year-month-table unselectable' cellspacing='0' cellpadding='0' />"),g=b("<colgroup />"),h=b("<thead />"),i=b("<tbody />"),l=this.calendar.getWeekNames(),j=b("<tr />"),s=0;s<l.length;s++)g.append("<col />"),p=this.calendar.isWeekend(s)?"<th class='year-month-table-head ui-calendar-weekend'>":"<th class='year-month-table-head'>",j.append(p+"<span>"+l[s]+"</span></th>");for(h.append(j),m=1,n=this.calendar.getWeekIndexOf(new Date(c,d,m)),o=new Date(c,d+1,0).getDate(),p=!1,c===e.getFullYear()&&d===e.getMonth()&&(p=!0,q=e.getDate()),s=0;s<6;s++){for(j=b("<tr />"),t=0;t<7;t++)k=b("<td class='year-month-table-cell' />"),j.append(k),0===s&&t<n?k.addClass("ui-calendar-empty"):m<=o&&(r=b("<span>"+m+"</span>"),p&&m===q&&r.addClass("today").addClass("background-highlight"),k.append(r),m++);i.append(j)}f.append(g).append(h).append(i),a.empty().append(f),f.data("month",d),f.on("click",this.onYearItemClickHandler)},_isDateCell:function(a){return!a.hasClass("ui-calendar-empty")&&a.children().length>0},_getDateByCell:function(a){var b,c,d;return b=a.parent().parent().parent(),c=parseInt(b.data("month"),10),d=parseInt(a.children().text(),10),new Date(this.year,c,d)},_getCellByDate:function(a,c){var d,e;return d=b(b(a[c.getMonth()]).children()[1]),e=this.calendar.getTableIndexOf(c),b(d.children()[0].tBodies[0].rows[e.rowIndex].cells[e.cellIndex])},_selectItem:function(a){var c,d,e;if(this._isDateCell(a)&&(c={},c.date=this._getDateByCell(a),c.view=this,c.element=a,c.originElement=a.context?b(a.context):null,!1!==this.calendar.fire("selecting",c)))if(this.isMultiple())if(a.hasClass("selected")){for(a.removeClass("selected"),d=0,e=this._selectList.length;d<e;d++)if(this._selectList[d]===a[0]){this._selectList.splice(d,1);break}this.calendar.fire("deselected",c)}else a.addClass("selected"),this._selectList.push(a[0]),this.calendar.fire("selected",c);else{if(this._current){if(this._current.removeClass("selected"),this._current[0]===a[0])return void this.calendar.fire("deselected",c);this._current=null}this._current=a,this._current.addClass("selected"),this.calendar.fire("selected",c)}},_updateSchedules:function(b,c,d){var e,f,g,h,i,j,k,l;if(Array.isArray(b))for(c||(c="date"),f=a.core.isFunction(c)?c:function(){return this[c]},l=a.core.isFunction(d),e=this.yearPanel.children(".year-month-panel"),i=0,j=b.length;i<j;i++){if((k=b[i])instanceof Date)g=k;else if(!((g=f.call(k))instanceof Date))continue;h=this._getCellByDate(e,g),l&&d.call(h,k)}},getMonthCount:function(a){return a>=1024?4:a>=768?3:a>=512?2:1},checkChange:function(){return this.calendar.hideTimeLine(),this.year!==this.calendar.currentDate.getFullYear()&&(this._changeYear(this.calendar.currentDate),!0)},active:c,dormant:c,previous:function(){var a=this.calendar.currentDate;this._changeYear(new Date(a.setFullYear(a.getFullYear()-1)))},next:function(){var a=this.calendar.currentDate;this._changeYear(new Date(a.setFullYear(a.getFullYear()+1)))},today:function(a){a&&a instanceof Date||(a=new Date),this._changeYear(new Date(a.getTime()))},addSchedules:function(b,c,d){var e;a.core.isFunction(d)||(d=null),e=function(a){0===this.children(".year-day-marker").length&&this.append("<i class='year-day-marker border-highlight'></i>"),d&&d.call(this,a)},this._updateSchedules(b,c,e)},removeSchedules:function(b,c,d){var e;a.core.isFunction(d)||(d=null),e=function(a){var b=this.children(".year-day-marker");b.length>0&&b.remove(),d&&d.call(this,a)},this._updateSchedules(b,c,e)},clearSchedules:function(){var a,c,d,e,f,g,h,i;for(a=this.yearPanel.children(".year-month-panel"),g=0;g<12;g++)for(c=b(a[g]).children(".year-month-content").children(".year-month-table")[0].tBodies[0].rows,h=0;h<c.length;h++)for(d=c[h].cells,i=0;i<d.length;i++)e=b(d[i]),f=e.children(".year-day-marker"),f.length>0&&f.remove()},isMultiple:function(){return!!this.calendar.option.yearMultipleSelect},getSelection:function(){var a,c,d=null;if(this.isMultiple())for(d=[],a=0,c=this._selectList.length;a<c;a++)d.push(this._getDateByCell(b(this._selectList[a])));else this._current&&(d=this._getDateByCell(this._current));return d},setSelection:function(b){var c,d,e,f,g;for(Array.isArray(b)||(b=[b]),c=this.yearPanel.children(".year-month-panel"),f=0,g=b.length;f<g;f++)if((d=b[f])instanceof Date){if(d.getFullYear()!==this.year)throw new Error(a.str.format("the date({0}) does not belong to {1}",a.date.format(d,"yyyy-MM-dd"),this.year));e=this._getCellByDate(c,d),this._selectItem(e)}},cancelSelection:function(){var a,c,d,e;if(a="selected",this.isMultiple()){for(d=0,e=this._selectList.length;d<e;d++)c=b(this._selectList[d]),c.removeClass(a);this._selectList=[]}else this._current&&(this._current.removeClass(a),this._current=null);this.calendar.fire("cancel",this)},setSize:function(a,b){this._setCellSize(a,b)},getTitle:function(){return this.year+r.yearUnit},toString:function(){return"ui.ctrls.CalendarView.YearView"}},l.prototype={constructor:l,initialize:function(a){this.calendar=a,this.year=null,this.month=null,this.initialled=!1,this._selectList=[],this._current=null,this.width=null,this.height=null,this.viewPanel=b("<div class='calendar-view-panel' />"),this.calendar.element.append(this.viewPanel)},render:function(){this.initialled||(this.onMonthItemClickHandler=h.bind(this),this._setCurrent(),this.weekPanel=b("<div class='ui-calendar-month-week-view' />"),this._createWeek(),this.daysPanel=b("<div class='ui-calendar-month-day-view' />"),this._createDays(),this.viewPanel.append(this.weekPanel).append(this.daysPanel),this.initialled=!0)},_setCurrent:function(){var a=this.calendar.currentDate;this.year=a.getFullYear(),this.month=a.getMonth()},_createWeek:function(){var a,c,d,e,f,g,h;for(this.weekTable=b("<table class='month-week-table unselectable' cellspacing='0' cellpadding='0' />"),d=b("<thead />"),c=b("<colgroup />"),this.weekTable.append(c).append(d),e=b("<tr />"),a=this.calendar.getWeekNames(),g=0,h=a.length;g<h;g++)c.append("<col />"),f=b("<th class='month-week-cell' />"),this.calendar.isWeekend(g)&&f.addClass("ui-calendar-weekend"),f.append("<span class='month-week-text'>星期"+a[g]+"</span>"),g===h-1&&f.addClass("month-week-cell-last"),e.append(f);d.append(e),this.weekPanel.append(this.weekTable)},_createDays:function(){var a,c,d,e,f,g,h,i,j,k,l,m,n,o;for(this.daysTable?this.daysTable.html(""):(this.daysTable=b("<table class='month-days-table unselectable' cellspacing='0' cellpadding='0' />"),this.daysTable.on("click",this.onMonthItemClickHandler)),a=b("<tbody />"),c=b("<colgroup />"),m=0;m<7;m++)c.append("<col />");for(this.daysTable.append(c).append(a),f=this.calendar.currentDate,g=new Date(f.getFullYear(),f.getMonth(),1),i=this.calendar.getWeekIndexOf(g),h=new Date(g.getFullYear(),g.getMonth()+1,0).getDate(),g=1,j=new Date,k=j.getDate(),j.getFullYear()===f.getFullYear()&&j.getMonth()===f.getMonth()&&(l=function(a,b){b===k&&a.children().children(".month-date").addClass("font-highlight")}),o=g,m=0;m<6;m++){for(d=b("<tr />"),n=0;n<7;n++)e=b("<td class='month-days-cell' />"),d.append(e),0===m&&n<i||o>h||(e.append("<div class='day-container' />"),this.calendar.isWeekend(n)&&e.addClass("month-days-cell-weekend"),6===n&&e.addClass("month-days-cell-last"),e.children().html("<span class='month-date'>"+o+"</span>"),l&&l.call(this,e,o),o++);if(a.append(d),o>h)break}this.daysPanel.append(this.daysTable)},_setCellSize:function(a,c){var d,e,f,g,h,i,j,k,l;if(a&&c&&(this.width!==a||this.height!==c)){for(this.width=a,this.height=c,c-=26,this.daysPanel.css("height",c+"px"),d=this._setCellWidth(a),e=this.daysTable[0].rows,l=e.length,c-=l,g=Math.floor(c/l),h=c-g*(l-1),k=0;k<l;k++)k<l-1?b(e[k]).children().css("height",g+"px"):b(e[k]).children().css("height",h+"px");for(f=this.weekTable[0].tHead.rows[0].cells,i="",j=this.calendar.getWeekNames(),d>=60&&(i="星期"),k=0,l=f.length;k<l;k++)b(f[k]).children().text(i+j[k])}},_setCellWidth:function(a){var b,c,d;return b=Math.floor(a/7),c=this.weekTable.children("colgroup").children(),d=this.daysTable.children("colgroup").children("col"),c.splice(6,1),d.splice(6,1),c.css("width",b+"px"),d.css("width",b+"px"),b},_changeMonth:function(a){this.calendar.currentDate=a,this._setCurrent(),this._createDays(),this._setCellSize(this.viewPanel.width(),this.viewPanel.height()),this._current=null,this._selectList=[]},_isDateCell:function(a){return a.children(".day-container").children().length>0},_getDateByCell:function(a){var b,c;return b=a.children(".day-container"),c=b.children(".month-date"),0===c.length?null:(c=parseInt(c.text(),10),new Date(this.year,this.month,c))},_getCellByDate:function(a){var c,d;return c=this.daysTable[0].tBodies[0].rows,d=this.calendar.getTableIndexOf(a),b(c[d.rowIndex].cells[d.cellIndex])},_selectItem:k.prototype._selectItem,_updateSchedules:function(b,c,d){var e,f,g,h,i,j,k;if(Array.isArray(b))for(c||(c="date"),e=a.core.isFunction(c)?c:function(){return this[c]},k=a.core.isFunction(d),h=0,i=b.length;h<i;h++){if((j=b[h])instanceof Date)f=j;else if(!((f=e.call(j))instanceof Date))continue;g=this._getCellByDate(f),k&&d.call(g,j)}},checkChange:function(){var a;return this.calendar.hideTimeLine(),a=this.calendar.currentDate,(this.year!==a.getFullYear()||this.month!==a.getMonth())&&(this._changeMonth(a),!0)},active:c,dormant:c,previous:function(){var a=this.calendar.currentDate;this.width=null,this.height=null,this._changeMonth(new Date(a.setMonth(a.getMonth()-1)))},next:function(){var a=this.calendar.currentDate;this.width=null,this.height=null,this._changeMonth(new Date(a.setMonth(a.getMonth()+1)))},today:function(a){a&&a instanceof Date||(a=new Date),this.width=null,this.height=null,this._changeMonth(new Date(a.getTime()))},addSchedules:function(c,d,e){var f,g;a.core.isPlainObject(c)?(f=c,c=f.data,d=f.dateField,e=f.action):f={textField:"text"},g=a.core.isFunction(f.textField)?f.textField:function(){return this[f.textField]||null},a.core.isFunction(e)||(e=function(a){var c,d,e,f,h,i;e=this.children(".day-container"),c=e.children(".schedule-list"),0===c.length&&(c=b("<ul class='schedule-list' />"),c.data("schedule-items",[]),e.append(c)),d=c.data("schedule-items"),d.push(a),a.backgroundColor&&(h=" style='background-color:"+a.backgroundColor+"'"),a.borderColor&&(i=" style='background-color:"+a.borderColor+"'"),f=[],f.push("<li class='schedule-item'",h,">"),f.push("<b class='schedule-border'",i,"></b>"),f.push("<span class='schedule-text'>",g.call(a),"</span>"),f.push("</li>"),c.append(f.join(""))}),this._updateSchedules(c,d,e)},removeSchedules:function(c,d,e){var f,g;a.core.isPlainObject(c)?(f=c,c=f.data,d=f.dateField,e=f.action):f={idField:function(){return this}},g=a.core.isFunction(f.idField)?f.idField:function(){return this[f.idField]||null},a.core.isFunction(e)||(e=function(a){var c,d,e,f,h,i,j;if(c=this.children(".day-container"),d=c.children(".schedule-list"),0!==d.length){for(e=d.data("schedule-items"),f=-1,h=0,i=e.length;h<i;h++)if(j=e[h],g.call(j)===g.call(a)){f=h;break}f>-1&&(b(d.children()[f]).remove(),e.splice(f,1))}}),this._updateSchedules(c,d,e)},clearSchedules:function(b){var c,d,e;for(e=new Date(this.year,this.month+1,0).getDate(),a.core.isFunction(b)||(b=function(){var a,b;a=this.children(".day-container"),b=a.children(".schedule-list"),b.removeData("schedule-items"),b.remove()}),d=1;d<=e;d++)c=this._getCellByDate(new Date(this.year,this.month,d)),b.call(c)},isMultiple:function(){return!!this.calendar.option.monthMultipleSelect},getSelection:k.prototype.getSelection,setSelection:function(b){var c,d,e,f;for(Array.isArray(b)||(b=[b]),e=0,f=b.length;e<f;e++)if((c=b[e])instanceof Date){if(c.getFullYear()!==this.year||c.getMonth()!==this.month)throw new Error(a.str.format("the date({0}) does not belong to {1}-{2}",a.date.format(c,"yyyy-MM-dd"),this.year,this.month));d=this._getCellByDate(c),this._selectItem(d)}},cancelSelection:k.prototype.cancelSelection,setSize:function(a,b){this._setCellSize(a,b)},getTitle:function(){return this.year+"年"+(this.month+1)+"月"},toString:function(){return"ui.ctrls.CalendarView.MonthView"}},m.prototype={constructor:m,initialize:function(a){this.calendar=a,this.startDate=null,this.endDate=null,this.year=null,this.month=null,this.todayIndex=-1,this.weekDays=null,this.weekHours=[],this.initialled=!1,this.width=null,this.height=null,this.singleSelect=!!this.calendar.option.weekSingleSelect,this.viewPanel=b("<div class='calendar-view-panel' />"),this.calendar.element.append(this.viewPanel)},render:function(){this.initialled||(this._formatDayText=this.calendar.option.formatWeekDayHead,a.core.isFunction(this._formatDayText)||(this._formatDayText=f),this.onWeekHeadItemClickHandler=i.bind(this),this.weekDays=this.calendar.getWeek(this.calendar.currentDate),this._setCurrent(),this.weekDayPanel=b("<div class='ui-calendar-week-view' />"),this._createWeek(),this.hourPanel=b("<div class='ui-calendar-hour-panel' />"),this._createHourName(),this._createHour(),this._setTodayStyle(),this.viewPanel.append(this.weekDayPanel).append(this.hourPanel),this.selector=o(this,this.hourPanel,this.hourTable),this.selector.getDateByIndex=function(a){return this.view.weekDays[a]},this.hourAnimator=a.animator(this.hourPanel,{ease:a.AnimationStyle.easeTo,onChange:function(a,b){b.scrollTop(a)}}),this.hourAnimator.duration=800,this.initialled=!0)},_setCurrent:function(){var a=this.weekDays[0];this.startDate=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0),a=this.weekDays[6],this.endDate=new Date(a.getFullYear(),a.getMonth(),a.getDate(),23,59,59),this.year=a.getFullYear(),this.month=a.getMonth()},_createWeek:function(){var a,c,d,e,f,g;for(this.weekTable=b("<table class='ui-calendar-weekday unselectable' cellspacing='0' cellpadding='0' />"),a=b("<thead />"),c=b("<colgroup />"),d=b("<tr />"),f=0;f<7;f++)g=this.weekDays[f],c.append("<col />"),e=b("<th class='weekday-cell' />"),e.html(this._formatDayText(g)),d.append(e);a.append(d),this.weekTable.append(c).append(a),this.weekDayPanel.append(this.weekTable),this.weekTable.on("click",this.onWeekHeadItemClickHandler)},_createHourName:function(){var a,c,d,e,f,g,h,i;for(this.hourNames=b("<div class='hour-name-panel' />"),a=b("<table class='hour-name-table unselectable' cellspacing='0' cellpadding='0' />"),c=b("<colgroup />"),c.append("<col style='width:0px;' />").append("<col />"),a.append(c),d=b("<tbody />"),i=this.calendar._getTimeCellCount(),g=0;g<24;g++)for(h=0;h<i;h++)e=b("<tr />"),f=b("<td class='hour-name-cell' />"),(h+1)%i&&f.addClass("hour-name-cell-odd"),e.append(f),0===h&&(f=b("<td class='hour-name-cell' rowspan='"+i+"' />"),f.append("<h3 class='hour-name-text'>"+g+"</h3>"),e.append(f)),d.append(e);a.append(d),this.hourNames.append(a),this.hourPanel.append(this.hourNames)},_createHour:function(){var a,c,d,e,f,g,h,i;for(this.weekHour=b("<div class='week-hour-panel' />"),this.hourTable=b("<table class='week-hour-table unselectable' cellspacing='0' cellpadding='0' />"),a=b("<tbody />"),c=b("<colgroup />"),f=0;f<7;f++)c.append("<col />");for(i=this.calendar._getTimeCellCount(),g=24*i,f=0;f<g;f++){for(d=b("<tr />"),h=0;h<7;h++)e=b("<td class='week-hour-cell' />"),this.calendar.isWeekend(h)&&e.addClass("week-hour-cell-weekend"),(f+1)%i&&e.addClass("week-hour-cell-odd"),d.append(e);a.append(d)}this.hourTable.append(c).append(a),this.weekHour.append(this.hourTable),this.hourPanel.append(this.weekHour)},_setTodayStyle:function(){var a,c,d,e,f,g;for(a=new Date,this.todayIndex=-1,f=0;f<7;f++)if(c=this.weekDays[f],c.getFullYear()==a.getFullYear()&&c.getMonth()==a.getMonth()&&c.getDate()==a.getDate()){this.todayIndex=f;break}if(!(this.todayIndex<0))for(d=this.hourTable[0],f=0,g=d.rows.length;f<g;f++)e=d.rows[f],b(e.cells[this.todayIndex]).addClass("week-hour-cell-today")},_clearTodayStyle:function(){var a,c,d,e,f;for(a=this.hourTable[0].tBodies[0].rows,d=-1,e=0,f=a[0].cells.length;e<f;e++)if(c=b(a[0].cells[e]),c.hasClass("week-hour-cell-today")){d=e;break}if(!(d<0))for(e=0,f=a.length;e<f;e++)c=b(a[e].cells[d]),c.removeClass("week-hour-cell-today")},_setCellSize:function(b,c){var d,e,f,g,h=0;b&&c&&(this.width===b&&this.height===c||(this.width=b,this.height=c,c<this.hourPanel[0].scrollHeight&&(h=a.scrollbarWidth),d=b-80-h,e=Math.floor(d/7),e<95&&(e=95),f=this.weekTable.find("col"),g=this.hourTable.find("col"),this.weekTable.css("width",7*e+"px"),this.hourTable.css("width",7*e+"px"),f.css("width",e+"px"),g.css("width",e+"px"),this.selector.cellWidth>1&&this._restoreSchedules(e-this.selector.cellWidth),this.selector.cellWidth=e,this.selector.cancelSelection()))},_updateWeek:function(){var a,c,d,e;for(a=this.weekTable[0].tHead.rows[0],e=0;e<7;e++)d=this.weekDays[e],c=b(a.cells[e]),c.html(this._formatDayText(d)),c.attr("class","weekday-cell")},_addScheduleItem:function(c,d,e,f,g){var h,i,j,k,l;h=b("<div class='schedule-item-panel' />"),i=b("<div class='time-title' />"),i.html("<span class='time-title-text'>"+g+"</span>"),j=b("<div class='schedule-container' />"),h.append(i).append(j),k=this._getPositionAndSize(c),l=this._getPositionAndSize(d),h.css({top:k.top+"px",left:k.left+"px",width:k.width+"px",height:l.height+l.top-k.top+"px"}),b(this.hourPanel).append(h),f.itemPanel=h,this._setScheduleInfo(f.columnIndex,f),a.core.isFunction(e)&&e.call(this,f,j)},_findSchedules:function(b,c){var d,f,g,h,i,j,k;for(k=a.core.isFunction(c),d=0;d<b.length;d++)if((g=b[d])instanceof Date&&(h=this.calendar.getWeekIndexOf(g),i=this.calendar.timeToIndex(e(g)),j=this._getScheduleInfo(h)))for(f=j.length-1;f>=0;f--)i===j[f].beginRowIndex&&k&&c.call(this,j[f],f,j)},_restoreSchedules:function(a){var b,c,d,e,f,g,h;for(e=0;e<this.weekHours.length;e++)if(g=this.weekHours[e])for(f=0;f<g.length;f++)h=g[f].itemPanel,b=g[f].weekIndex,c=parseFloat(h.css("left")),d=parseFloat(h.css("width")),h.css({left:c+b*val+"px",width:d+val+"px"})},_setScheduleInfo:function(a,b){var c=this.weekHours[a];c||(c=[],this.weekHours[a]=c),b.weekIndex=a,c.push(b)},_getScheduleInfo:function(a){var b=this.weekHours[a];return b||null},_changeWeek:function(){this.calendar.currentDate=this.weekDays[0],this._setCurrent(),this.clearSchedules(),this.selector.cancelSelection(),this._updateWeek(),this._clearTodayStyle(),this._setTodayStyle()},_getUnitHourNameHeight:function(){var a,b;return this.hourNames?(a=this.hourNames.children("table")[0],b=a.tBodies[0].rows[0].cells[1].getBoundingClientRect(),b.height/this.calendar._getTimeCellCount()):25},_getPositionAndSize:function(a){var b,c;return b=a.position(),b.left=b.left+80,b.top=b.top,c=a.getBoundingClientRect(),{top:b.top,left:b.left,width:c.width-1,height:c.height-1}},checkChange:function(){var a=this.calendar.currentDate;return this.calendar.showTimeLine(this.hourPanel,this._getUnitHourNameHeight()),!(a>=this.startDate&&a<=this.endDate)&&(this.weekDays=this.calendar.getWeek(a),this._changeWeek(),!0)},active:function(){this.selector.active()},dormant:function(){this.selector.dormant()},previous:function(){var a=this.calendar.currentDate;this.weekDays=this.calendar.getWeek(new Date(a.getFullYear(),a.getMonth(),a.getDate()-7)),this._changeWeek()},next:function(){var a=this.calendar.currentDate;this.weekDays=this.calendar.getWeek(new Date(a.getFullYear(),a.getMonth(),a.getDate()+7)),this._changeWeek()},today:function(a){a&&a instanceof Date||(a=new Date),this.weekDays=this.calendar.getWeek(a),this._changeWeek()},setBeginTime:function(a){var b,c,d,e,f,g,h;b=this.hourPanel.height(),c=this.hourPanel[0].scrollHeight,b>=c||(this.hourAnimator.stop(),d=this.calendar.timeToIndex(a),e=this.calendar._getTimeCellCount(),d>e&&(d-=e),f=c-b,g=25*d,g>f&&(g=f),h=this.hourAnimator[0],h.begin=this.hourPanel.scrollTop(),h.end=g,this.hourAnimator.start())},addSchedules:function(c,d,f,g,h){var i,j,k,l,m,n,o,p;if(Array.isArray(c))for(i=a.core.isFunction(d)?d:function(){return this[d+""]||null},j=a.core.isFunction(f)?f:function(){return this[f+""]||null},a.core.isFunction(h)||(h=function(a){return this.calendar.getWeekIndexOf(a)}),n=0,o=c.length;n<o;n++)p=c[n],k={data:p},k.beginDate=i.call(p),k.endDate=j.call(p),k.beginDate instanceof Date&&k.endDate instanceof Date&&(k.columnIndex=h.call(this,k.beginDate),l=e(k.beginDate),m=e(k.endDate,k.beginDate),k.beginRowIndex=this.calendar.timeToIndex(l),k.endRowIndex=this.calendar.timeToIndex(m)-1,
this._addScheduleItem(b(this.hourTable[0].rows[k.beginRowIndex].cells[k.columnIndex]),b(this.hourTable[0].rows[k.endRowIndex].cells[k.columnIndex]),g,k,l.substring(0,5)+" - "+m.substring(0,5)))},removeSchedules:function(a){this._findSchedules(a,function(a,b,c){a.itemPanel.remove(),c.splice(b,1)})},findSchedules:function(b,c,d){var e;b instanceof Date&&(b=[b]),Array.isArray(b)&&(d||(d=this),e=a.core.isFunction(c)?function(){c.apply(d,arguments)}:null,this._findSchedules(b,e))},clearSchedules:function(){var a,b,c;for(a=0;a<this.weekHours.length;a++)if(c=this.weekHours[a])for(b=0;b<c.length;b++)c[b].itemPanel.remove();this.weekHours=[]},hasSchedule:function(a){var b=this.weekHours[a];return!!b&&b.length>0},getSelection:function(){var a,b,c,d,e,f;if(f=[],!(a=this.selector.getSelection()))return f;for(b=this.weekDays[a.weekIndex],d=0,e=a.timeArray.length;d<e;d++)c=a.timeArray[d],f.push(new Date(b.getFullYear(),b.getMonth(),b.getDate(),c.hours,c.minutes,c.seconds));return f},setSelection:function(b,c){var d,e,f,g,h,i;if(b instanceof Date&&c instanceof Date){for(d=-1,g=0,h=this.weekDays.length;g<h;g++)if(i=this.weekDays[g],i.getFullYear()==b.getFullYear()&&i.getMonth()==b.getMonth()&&i.getDate()==b.getDate()){d=g;break}d<0||(e=a.date.format(b,"hh:mm:ss"),f=a.date.format(c,"hh:mm:ss"),this.selector.setSelectionByTime(d,e,f))}},cancelSelection:function(){this.selector.cancelSelection()},setSize:function(a,b){this.hourPanel.css("height",b-25+"px"),this._setCellSize(a,b)},getTitle:function(){return a.str.format("{0}年{1}月{2}日 ~ {3}年{4}月{5}日",this.startDate.getFullYear(),this.startDate.getMonth()+1,this.startDate.getDate(),this.endDate.getFullYear(),this.endDate.getMonth()+1,this.endDate.getDate())},toString:function(){return"ui.ctrls.CalendarView.WeekView"}},n.prototype={constructor:n,initialize:function(a){this.calendar=a,this.year=null,this.month=null,this.day=null,this.dayHours=[],this.initialled=!1,this.width=null,this.height=null,this.singleSelect=!!this.calendar.option.daySingleSelect,this.viewPanel=b("<div class='calendar-view-panel' />"),this.calendar.element.append(this.viewPanel)},render:function(){this.initialled||(this._formatDayText=this.calendar.option.formatDayHead,a.core.isFunction(this._formatDayText)||(this._formatDayText=f),this.onDayHeadItemClickHandler=j.bind(this),this._setCurrent(),this.dayPanel=b("<div class='ui-calendar-day-view' />"),this._createDay(),this.hourPanel=b("<div class='ui-calendar-hour-panel' />"),this._createHourName(),this._createHour(),this.viewPanel.append(this.dayPanel).append(this.hourPanel),this.selector=o(this,this.hourPanel,this.hourTable),this.selector.getDateByIndex=function(a){return new Date(this.view.year,this.view.month,this.view.day)},this.hourAnimator=a.animator(this.hourPanel,{ease:a.AnimationStyle.easeTo,onChange:function(a,b){b.scrollTop(a)}}),this.hourAnimator.duration=800,this.initialled=!0)},_setCurrent:function(){var a=this.calendar.currentDate;this.year=a.getFullYear(),this.month=a.getMonth(),this.day=a.getDate()},_createDay:function(){this.dayTitle=b("<div class='ui-calendar-day-title' />"),this.dayTitle.html("<span class='ui-calendar-day-title-text'>"+this._formatDayText(this.calendar.currentDate)+"</span>"),this.dayPanel.append(this.dayTitle),this.dayTitle.on("click",this.onDayHeadItemClickHandler)},_createHourName:m.prototype._createHourName,_createHour:function(){var a,c,d,e,f,g;for(this.weekHour=b("<div class='week-hour-panel' />"),this.hourTable=b("<table class='week-hour-table unselectable' cellspacing='0' cellpadding='0' />"),a=b("<tbody />"),e=this.calendar._getTimeCellCount(),f=0,g=24*e;f<g;f++)c=b("<tr />"),d=b("<td class='week-hour-cell' style='width:100%' />"),(f+1)%e&&d.addClass("week-hour-cell-odd"),c.append(d),a.append(c);this.hourTable.append(a),this.weekHour.append(this.hourTable),this.hourPanel.append(this.weekHour)},_setCellSize:function(b,c){var d,e=0;b&&c&&(this.width===b&&this.height===c||(this.width=b,this.height=c,c<this.hourPanel[0].scrollHeight&&(e=a.scrollbarWidth),d=b-80-e-2,this.dayTitle.css("width",d+"px"),this.hourTable.css("width",d+"px"),this.selector.cellWidth>1&&this._restoreSchedules(d-this.selector.cellWidth),this.selector.cellWidth=d,this.selector.cancelSelection()))},_addScheduleItem:m.prototype._addScheduleItem,_restoreSchedules:function(a){var b,c,d,e,f;for(e=0;e<this.dayHours.length;e++)f=this.dayHours[e].itemPanel,b=this.dayHours[e].weekIndex,c=parseFloat(f.css("left")),d=parseFloat(f.css("width")),f.css({left:c+b*val+"px",width:d+val+"px"})},_setScheduleInfo:function(a,b){this.dayHours.push(b)},_getScheduleInfo:function(a){return this.dayHours},_changeDay:function(){this._setCurrent(),this.clearSchedules(),this.selector.cancelSelection(),this.dayTitle.html("<span class='ui-calendar-day-title-text'>"+this._formatDayText(this.calendar.currentDate)+"</span>")},_getUnitHourNameHeight:m.prototype._getUnitHourNameHeight,_getPositionAndSize:m.prototype._getPositionAndSize,checkChange:function(){var a=this.calendar.currentDate;return this.calendar.showTimeLine(this.hourPanel,this._getUnitHourNameHeight()),(this.year!=a.getFullYear()||this.month!=a.getMonth()||this.day!=a.getDate())&&(this._changeDay(),!0)},active:function(){this.selector.active()},dormant:function(){this.selector.dormant()},previous:function(){var a=this.calendar.currentDate;this.calendar.currentDate=new Date(a.setDate(a.getDate()-1)),this._changeDay()},next:function(){var a=this.calendar.currentDate;this.calendar.currentDate=new Date(a.setDate(a.getDate()+1)),this._changeDay()},today:function(a){a&&a instanceof Date||(a=new Date),this.calendar.currentDate=new Date(a.getTime()),this._changeDay()},setBeginTime:m.prototype.setBeginTime,addSchedules:function(a,b,c,d,e){m.prototype.addSchedules.call(this,a,b,c,d,function(){return 0})},clearSchedules:function(){for(var a=0;a<this.dayHours.length;a++)this.dayHours[a].itemPanel.remove();this.dayHours=[]},hasSchedule:function(){return this.dayHours.length>0},getSelection:function(){var a,b,c,d,e,f;if(f=[],!(a=this.selector.getSelection()))return f;for(b=new Date(this.year,this.month,this.day),d=0,e=a.timeArray.length;d<e;d++)c=a.timeArray[d],f.push(new Date(b.getFullYear(),b.getMonth(),b.getDate(),c.hours,c.minutes,c.seconds));return f},setSelection:function(b,c){var d,e;b instanceof Date&&c instanceof Date&&(d=a.date.format(b,"hh:mm:ss"),e=a.date.format(c,"hh:mm:ss"),this.selector.setSelectionByTime(0,d,e))},cancelSelection:function(){this.selector.cancelSelection()},setSize:function(a,b){this.hourPanel.css("height",b-25+"px"),this._setCellSize(a,b)},getTitle:function(){return a.str.format("{0}年{1}月{2}日",this.year,this.month+1,this.day)},toString:function(){return"ui.ctrls.CalendarView.DayView"}},o.prototype={constructor:o,initialize:function(a,c,d){this.view=a,this.panel=c,this.grid=d,this.cellWidth=1,this.cellHeight=25,this.grid[0].onselectstart=function(){return!1},this.selectionBox=b("<div class='ui-calendar-selector unselectable click-enabled border-highlight' />"),this.selectionBox.boxTextSpan=b("<span class='ui-calendar-selector-time click-enabled' />"),this.selectionBox.append(this.selectionBox.boxTextSpan),this.panel.append(this.selectionBox),this._initEvents(),this._initAnimator()},_initEvents:function(){this.mouseLeftButtonDownHandler=function(a){1===a.which&&(b(document).on("mousemove",this.mouseMoveHandler),b(document).on("mouseup",this.mouseLeftButtonUpHandler),this.onMouseDown(b(a.target),a.clientX,a.clientY)&&(this._isBeginSelect=!0))}.bind(this),this.mouseMoveHandler=function(a){this._isBeginSelect&&this.onMouseMove(a)}.bind(this),this.mouseLeftButtonUpHandler=function(a){1===a.which&&this._isBeginSelect&&(this._isBeginSelect=!1,b(document).off("mousemove",this.mouseMoveHandler),b(document).off("mouseup",this.mouseLeftButtonUpHandler),this.onMouseUp(a))}.bind(this)},_initAnimator:function(){var b=this;this.selectAnimator=a.animator(this.selectionBox,{ease:a.AnimationStyle.swing,onChange:function(a,c){"up"!==b._selectDirection&&c.css("top",a+"px")}}).add(this.selectionBox,{ease:a.AnimationStyle.swing,onChange:function(a,b){b.css("left",a+"px")}}).add(this.selectionBox,{ease:a.AnimationStyle.swing,onChange:function(a,b){b.css("width",a+"px")}}).add(this.selectionBox,{ease:a.AnimationStyle.swing,onChange:function(a,c){b._selectDirection||c.css("height",a+"px")}}),this.selectAnimator.onEnd=function(){b._isNotCompletedYet&&(b._isNotCompletedYet=!1,b.onSelectCompleted())},this.selectAnimator.duration=200,this.selectAnimator.fps=60},_getSelectedCells:function(){var c,d,e,f,g,h,i,j,k,l,m,n,o=[],p=this.selectionBox;if("none"===p.css("display"))return o;if(c=p.text().split("-"),d=a.str.trim(c[0]||""),e=a.str.trim(c[1]||""),!d||!e)return o;for(d=this.view.calendar.timeToIndex(d),e=this.view.calendar.timeToIndex(e)-1,f=parseFloat(p.css("border-top-width")),g=d*this.cellHeight+1,h=parseFloat(p.css("left"))+f+1,i=this._getCellByPoint(h,g),o.push(i),j=e-d+1,k=this.grid[0],n=1;n<j;n++)l=k.rows[n+i.hourIndex],m=b(l.cells[i.weekIndex]),m.hourIndex=n+i.hourIndex,m.weekIndex=i.weekIndex,o.push(m);return o},_getCellByPoint:function(a,c){var d,e,f,g,h,i;return d=Math.ceil(a/this.cellWidth),e=Math.ceil(c/this.cellHeight),f=24*this.view.calendar._getTimeCellCount(),d<1&&(d=1),d>7&&(d=7),e<1&&(e=1),e>f&&(e=f),e--,d--,g=this.grid[0],h=g.rows[e],i=b(h.cells[d]),i.hourIndex=e,i.weekIndex=d,i},_selectCell:function(a){var b,c,d,e,f,g;return b=this.selectionBox,c=this._getPositionAndSize(a),e=a.hourIndex,f=a.hourIndex+1,arguments.length>1&&arguments[1]&&(f=arguments[1].hourIndex+1,d=this._getPositionAndSize(arguments[1]),c.height=d.top+d.height-c.top),this._selectDirection=null,this._beginTime=this.view.calendar.indexToTime(e),this._endTime=this.view.calendar.indexToTime(f),b.boxTextSpan.text(this._beginTime+" - "+this._endTime),this.selectAnimator.stop(),g=this.selectAnimator[0],g.begin=parseFloat(g.target.css("top")),g.end=c.top,g=this.selectAnimator[1],g.begin=parseFloat(g.target.css("left")),g.end=c.left,g=this.selectAnimator[2],g.begin=parseFloat(g.target.css("width")),g.end=c.width,g=this.selectAnimator[3],g.begin=parseFloat(g.target.css("height")),g.end=c.height,b.css("display","block"),this._isNotCompletedYet=!1,this.selectAnimator.start()},_autoScrollY:function(a,b){var c,d;c=this.panel.scrollTop(),"up"===b?a<c&&this.panel.scrollTop(c<this.cellHeight?0:c-this.cellHeight):"down"===b&&(d=c+this.panel.height(),a>d&&this.panel.scrollTop(c+this.cellHeight))},_isClickInGrid:function(b,c){var d,e,f,g,h,i,j;return d=this.panel.offset(),e=d.left+80,f=d.top,i=this.grid.width(),j=this.panel.height(),g=e+i-1,h=f+j,j<this.panel[0].scrollHeight&&(g-=a.scrollbarWidth),b>=e&&b<=g&&c>=f&&c<=h},_changeToGridPoint:function(a,b){var c=this.panel.offset();return c.left=c.left+80,{gridX:a-c.left+this.panel[0].scrollLeft,gridY:b-c.top+this.panel[0].scrollTop}},_getPositionAndSize:function(a){var b,c;return b=a.position(),b.left=b.left+80,c=a.getBoundingClientRect(),{top:b.top-2,left:b.left-2,width:c.width-1,height:c.height-1}},onMouseDown:function(a,b,c){var d,e,f;if(!this._isClickInGrid(b,c))return void(this._clickInGrid=!1);if(this._clickInGrid=!0,e=this._changeToGridPoint(b,c),"TD"!=a.nodeName()){if(!a.hasClass("click-enabled"))return;d=this._getCellByPoint(e.gridX,e.gridY)}else d=a,d.weekIndex=d[0].cellIndex,d.hourIndex=d.parent()[0].rowIndex;return f={view:this.view,element:this.selectionBox,weekIndex:d.weekIndex,hourIndex:d.hourIndex,originElement:null},!1!==this.view.calendar.fire("selecting",f)?(this._startCell=d,this._selectCell(d),this.checkSelectable(d),this.focusX=e.gridX,this.focusY=e.gridY,!0):void 0},onMouseMove:function(a){var b,c,d,e,f,g,h;b=this._changeToGridPoint(a.clientX,a.clientY),c=this._getCellByPoint(this.focusX,b.gridY),d=this._getPositionAndSize(c),e=this._getPositionAndSize(this._startCell),c.hourIndex<this.selectableMin||c.hourIndex>this.selectableMax||(f=this.selectionBox,b.gridY>this.focusY?(g=this._startCell,h=c,f.css({height:d.top+d.height-e.top+"px"}),this._selectDirection="down",this._autoScrollY(d.top+d.height,this._selectDirection)):(g=c,h=this._startCell,f.css({top:d.top+"px",height:e.top+e.height-d.top+"px"}),this._selectDirection="up",this._autoScrollY(d.top,this._selectDirection)),this._beginTime=this.view.calendar.indexToTime(g.hourIndex),this._endTime=this.view.calendar.indexToTime(h.hourIndex+1),f.boxTextSpan.text(this._beginTime+" - "+this._endTime))},onMouseUp:function(a){this._clickInGrid&&(this.selectAnimator.isStarted?this._isNotCompletedYet=!0:this.onSelectCompleted())},onSelectCompleted:function(){var a,b,c,d,e,f,g;arguments.length>0&&arguments[0]?arguments[0]:this.selectionBox,a=this.getDateByIndex(this._startCell.weekIndex),b=this._beginTime.split(":"),c=parseInt(b[0],10),d=parseInt(b[1],10),b=this._endTime.split(":"),e=parseInt(b[0],10),f=parseInt(b[1],10),this._startCell=null,this._beginTime=null,this._endTime=null,g=this,setTimeout(function(){var b,h={view:g.view,beginTime:new Date(a.getFullYear(),a.getMonth(),a.getDate(),c,d,0),endTime:new Date(a.getFullYear(),a.getMonth(),a.getDate(),e,f,0),originElement:null};b=g.getSelectorInfo(),h.element=b.element,h.top=b.top,h.left=b.left,h.parentWidth=b.parentWidth,h.parentHeight=b.parentHeight,g.view.calendar.fire("selected",h)},50)},checkSelectable:function(a){var b,c,d,e,f,g;if(b=this.view.calendar._getTimeCellCount(),this.selectableMin=0,this.selectableMax=24*b-1,this.view.singleSelect){if(c=this.view._getScheduleInfo(a.weekIndex),d=-1,e=24*b,c)for(g=0;g<c.length;g++)f=c[g],f.beginRowIndex<a.hourIndex?f.beginRowIndex>d&&(d=f.beginRowIndex):f.beginRowIndex<e&&(e=f.beginRowIndex),f.endRowIndex<a.hourIndex?f.endRowIndex>d&&(d=f.endRowIndex):f.endRowIndex<e&&(e=f.endRowIndex);this.selectableMin=d+1,this.selectableMax=e-1}},getSelectorInfo:function(){var a=this.selectionBox,b=this.view.hourTable.getBoundingClientRect();return{element:a,top:parseFloat(a.css("top")),left:parseFloat(a.css("left")),parentWidth:this.view.viewPanel.width()-80,parentHeight:b.height}},getSelection:function(){var a,b,c,d,e,f;if(b=this._getSelectedCells(),0===b.length)return null;for(a={weekIndex:null,timeArray:[]},c=this.view.calendar._getTimeCellCount(),d=function(a){var b,d;return b=Math.floor(a/c),d=60*(a/c-b),{hours:b,minutes:d,seconds:0}},a.weekIndex=b[0].weekIndex,a.timeArray.push(d(b[0].hourIndex)),e=0,f=b.length;e<f;e++)a.timeArray.push(d(b[e].hourIndex+1));return a},setSelectionByTime:function(a,b,c){var d,e,f,g,h;return d=(a+1)*this.cellWidth-1,e=(this.view.calendar.timeToIndex(b)+1)*this.cellHeight-1,f=this.view.calendar.timeToIndex(c)*this.cellHeight-1,g=this._getCellByPoint(d,e),h=this._getCellByPoint(d,f),this.focusX=d,this.focusY=e,this.view.setBeginTime(b),this._startCell=g,this._selectCell(g,h)},cancelSelection:function(){var a=this.selectionBox;a.css("display","none"),this._startCell=null,this.focusX=0,this.focusY=0,this.view.calendar.fire("deselected",{view:this.view,element:a})},active:function(a){a||this.selectionBox.css("display","none"),b(document).on("mousedown",this.mouseLeftButtonDownHandler)},dormant:function(a){a||this.cancelSelection(),b(document).off("mousedown",this.mouseLeftButtonDownHandler)}},q={YEARVIEW:k,MONTHVIEW:l,WEEKVIEW:m,DAYVIEW:n},a.ctrls.define("ui.ctrls.CalendarView",{_defineOption:function(){return{views:["YearView","MonthView","WeekView","DayView"],defaultView:"WeekView",unitTime:30,sundayFirst:!1,startDate:null,yearMultipleSelect:!1,monthMultipleSelect:!1,weekSingleSelect:!1,daySingleSelect:!1,formatWeekDayHead:null,formatDayHead:null}},_defineEvents:function(){return["viewChanging","viewChanged","changing","changed","selecting","selected","deselected","weekTitleClick","cancel"]},_create:function(){var b;a.core.isNumber(this.option.unitTime)?(b=60/this.option.unitTime)%2&&(b-=1,this.option.unitTime=60/b):this.option.unitTime=30,this.views={},a.core.isString(this.option.defaultView)&&0!==this.option.defaultView.length||(this.option.defaultView="WeekView"),this.option.startDate instanceof Date?this.currentDate=this.option.startDate:this.currentDate=new Date,this.viewChangeAnimator=a.animator({ease:a.AnimationStyle.easeTo,onChange:function(a,b){b.css("left",a+"px")}}),this.viewChangeAnimator.add({ease:a.AnimationStyle.easeFrom,onChange:function(a,b){b.css("opacity",a/100)}}),this.viewChangeAnimator.duration=500},_render:function(){var b,c,d,e;for(this.element.addClass("ui-calendar-view").css("position","relative"),b=0,c=this.option.views.length;b<c;b++)d=this.option.views[b],a.core.isString(d)&&(d=d.toUpperCase(),q.hasOwnProperty(d)&&(this.views[d]=q[d](this)));if(!this.hasView(this.option.defaultView))for(b in this.views)if(this.views.hasOwnProperty(b)){this.option.defaultView=b;break}e=this,setTimeout(function(){e.changeView(e.option.defaultView,!1)})},_getTimeCellCount:function(){return Math.floor(60/this.option.unitTime)||1},_timeToCellNumber:function(a){var b,c,d,e;return b=a.split(":"),c=this._getTimeCellCount(),d=parseInt(b[0],10),e=parseInt(b[1],10),parseInt(b[2],10),(d+e/60)*c},_doChange:function(a){!1!==this.fire("changing",this.currentView,a)&&(this.currentView[a].call(this.currentView),this.fire("changed",this.currentView,a))},isSundayFirst:function(){return!!this.option.sundayFirst},getWeek:function(a){var b,c,d,e,f=null;if(a instanceof Date)for(a=new Date(a.getTime()),f=[],e=7,this.isSundayFirst()?(b=a.getDay(),a.setDate(a.getDate()-b)):(b=a.getDay()||e,a.setDate(a.getDate()-b+1)),c=new Date(a.getTime()),f.push(c),d=1;d<e;d++)f.push(new Date(a.setDate(a.getDate()+1)));return f},getWeekStartEnd:function(a){var b,c=null;a instanceof Date&&(a=new Date(a.getTime()),c={year:a.getFullYear(),month:a.getMonth()+1},this.isSundayFirst()?(b=a.getDay(),a.setDate(a.getDate()-b)):(b=a.getDay()||7,a.setDate(a.getDate()-b+1)),c.weekStartDate=new Date(a.getTime()),c.weekStartDay=c.weekStartDate.getDate(),c.weekEndDate=new Date(a.setDate(a.getDate()+6)),c.weekEndDay=c.weekEndDate.getDate())},getWeekIndexOf:function(a){var b=null;return a instanceof Date&&(b=a.getDay(),this.isSundayFirst()||(0===b?b=6:b--)),b},getWeekendIndexes:function(){var a={saturday:6,sunday:0};return this.isSundayFirst()||(a.saturday=5,a.sunday=6),a},isWeekend:function(a){return this.isSundayFirst()?6===a||0===a:5===a||6===a},getTableIndexOf:function(a){var b,c,d,e=null;return a instanceof Date&&(b=new Date(a.getFullYear(),a.getMonth(),1),c=this.getWeekIndexOf(b),d=a.getDate()+c-1,e={rowIndex:Math.floor(d/7),cellIndex:0},e.cellIndex=d-7*e.rowIndex),e},getWeekNames:function(){return this.isSundayFirst()?r.sundayFirstWeek:r.mondayFirstWeek},indexToTime:function(a){var b,c,e,f;return b=this._getTimeCellCount(),c=d(a/b),e=c.split("."),f=e[0]+":",e.length>1?f+=d(60*parseFloat("0."+e[1])):f+="00",f},timeToIndex:function(a){return a||(a="00:00"),Math.ceil(this._timeToCellNumber(a))},timeToPosition:function(a,b){return a||(a="00:00"),this._timeToCellNumber(a)*b},showTimeLine:function(a,c){var d,f,g;this.currentTimeElement?this.currentTimeElement.css("display","block"):(this.currentTimeElement=b("<div class='ui-current-time border-highlight font-highlight' />"),this.currentTimeElement.css("width","80px"),this.element.append(this.currentTimeElement)),this._timeoutHandler&&(clearTimeout(this._timeoutHandler),this._timeoutHandler=null),a.append(this.currentTimeElement),d=3e4,g=this,f=function(){var a,b,h,i;a=e(new Date),b=g.timeToIndex(a),h=g.timeToPosition(a,c),i=g.currentTimeElement,i.html("<span class='ui-current-time-text'>"+a.substring(0,5)+"</span>"),b<=1?i.addClass("ui-current-time-top").css("top",h+"px"):i.removeClass("ui-current-time-top").css("top",h-17+"px"),g._timeoutHandler=setTimeout(f,d)},this._timeoutHandler=setTimeout(f)},hideTimeLine:function(){this._timeoutHandler&&clearTimeout(this._timeoutHandler),this.currentTimeElement&&this.currentTimeElement.css("display","none")},previous:function(){this._doChange("previous")},next:function(){this._doChange("next")},today:function(){this._doChange("today")},hasView:function(a){return this.views.hasOwnProperty((a+"").toUpperCase())},isView:function(a,b){return!!a&&(b=(b+"").toUpperCase(),-1!==a.toString().toUpperCase().lastIndexOf(b))},getView:function(a){return a=(a+"").toUpperCase(),this.views.hasOwnProperty(a)?this.views[a]:null},changeView:function(b,c){var d,e,f,g,h,i,j;if(!(d=this.views[(b+"").toUpperCase()]))throw new Error(a.str.format("没有注册名为{0}的视图",b));if(!1!==this.fire("viewChanging",this.currentView,d)){if(this.currentView&&(this.viewChangeAnimator.stop(),this.currentView.viewPanel.css({display:"none",opacity:0}),this.currentView.dormant(),this.currentView=null),this.currentView=d,g=this.element.width(),this.currentView.viewPanel.css({display:"block",left:g/3+"px"}),e=!1,d.initialled||(d.render(),e=!0),f=d.checkChange(),d.setSize(this.element.width(),this.element.height()),h=this,j=function(){h.currentView.active(),h.fire("viewChanged",h.currentView),(e||f)&&h.fire("changed",h.currentView)},!1===c)return this.currentView.viewPanel.css({display:"block",left:"0",opacity:1}),void j();i=this.viewChangeAnimator[0],i.target=this.currentView.viewPanel,i.begin=g/3,i.end=0,i=this.viewChangeAnimator[1],i.target=this.currentView.viewPanel,i.begin=0,i.end=100,this.viewChangeAnimator.onEnd=j,this.viewChangeAnimator.start()}},setSize:function(a,b){this.element.css("height",b+"px"),this.currentView&&this.currentView.setSize(a,b)},getTitle:function(){return this.currentView?this.currentView.getTitle():""}}),b.fn.calendarView=function(b){return 0===this.length?null:(t||p(),a.ctrls.CalendarView(b,this))};var s,t=!1;a.page.hlchanged(function(a,b){p(b)})}(ui,ui.$),function(a,b){function c(){}function d(b){return b?a.str.htmlEncode(b):b}function e(b){var d;if("string"===(d=a.core.type(b)))this.option.group={groupField:b,itemsField:"_items",groupListHandler:f,headFormatter:g,headRearrangeHandler:h};else if("object"===d){if(a.core.isFunction(b.groupListHandler)||(b.groupListHandler=f),!b.groupField)throw new TypeError("the groupField can not be null or empty.");b.itemsField||(b.itemsField="_items"),a.core.isFunction(b.headFormatter)||(b.headFormatter=g),a.core.isFunction(b.headRearrangeHandler)||(b.headRearrangeHandler=c)}else this.option.group=!1}function f(b,c,d){return a.trans.listToGroup(b,c,null,d)}function g(b,c){return a.str.format("<span style='margin-left:{0}px;margin-right:{0}px' class='item-head-title font-highlight'>{1}</span>",c,d(b[this.option.group.groupField]))}function h(a,b,c,d){a.children(".item-head-title").css({"margin-left":d+"px","margin-right":d+"px"}),0===b&&a.css("margin-top",d+"px")}function i(b){b.showPageInfo&&(b.pageInfoFormatter||(b.pageInfoFormatter={currentRowNum:function(a){return"<span>本页"+a+"项</span>"},rowCount:function(a){return"<span class='font-highlight'>共"+a+"项</span>"},pageCount:function(a){return"<span>"+a+"页</span>"}})),this.pager=a.ctrls.Pager(b),this.pageIndex=this.pager.pageIndex,this.pageSize=this.pager.pageSize}function j(a){for(var c=b(a.target);!c.hasClass("view-item");){if(c.hasClass("ui-card-view-body"))return;c=c.parent()}c[0]!==a.target&&(c.context=a.target),this._selectItem(c)}var k="ui-card-view-selection";a.ctrls.define("ui.ctrls.CardView",{_defineOption:function(){return{viewData:null,promptText:"没有数据",group:!1,width:!1,height:!1,itemWidth:200,itemHeight:200,renderItemFormatter:null,pager:{pageIndex:1,pageSize:30,pageButtonCount:10,showPageInfo:!1,pageInfoFormatter:null},selection:{multiple:!1}}},_defineEvents:function(){var a=["selecting","selected","deselected","rebind","cancel"];return this.option.pager&&a.push("pagechanging"),a},_create:function(){this._itemBodyList=[],this._selectList=[],this._hasPrompt=!!this.option.promptText,this._currentMarginInfo=null,this.viewBody=null,this.pagerHeight=30,this.option.group&&e.call(this,this.option.group),this.option.pager&&i.call(this,this.option.pager),(!a.core.isNumber(this.option.width)||this.option.width<=0)&&(this.option.width=!1),(!a.core.isNumber(this.option.height)||this.option.height<=0)&&(this.option.height=!1),this.onBodyClickHandler=j.bind(this)},_render:function(){this.element.hasClass("ui-card-view")||this.element.addClass("ui-card-view"),this._initBorderWidth(),this.viewBody=b("<div class='ui-card-view-body' />"),this._initDataPrompt(),this.element.append(this.viewBody),this.option.selection&&this.viewBody.on("click",this.onBodyClickHandler),this._initPagerPanel(),this.setSize(this.option.width,this.option.height),this.option.selection?"disabled"===this.option.selection.type&&(this.option.selection=!1):this.option.selection=!1,Array.isArray(this.option.viewData)&&this.fill(this.option.viewData,this.option.viewData.length)},_initBorderWidth:function(){var a=function(a){return parseInt(this.element.css(a),10)||0};this.borderWidth=0,this.borderHeight=0,this.borderWidth+=a.call(this,"border-left-width"),this.borderWidth+=a.call(this,"border-right-width"),this.borderHeight+=a.call(this,"border-top-width"),this.borderHeight+=a.call(this,"border-bottom-width")},_initDataPrompt:function(){var c;this._hasPrompt&&(this._dataPrompt=b("<div class='data-prompt' />"),c=this.option.promptText,a.core.isString(c)&&c.length>0?this._dataPrompt.html("<span class='font-highlight'>"+d(c)+"</span>"):a.core.isFunction(c)&&(c=c(),this._dataPrompt.append(c)),this.viewBody.append(this._dataPrompt))},_initPagerPanel:function(){this.pager&&(this.gridFoot=b("<div class='ui-card-view-foot clear' />"),this.element.append(this.gridFoot),this.pager.pageNumPanel=b("<div class='page-panel' />"),this.option.pager.showPageInfo?(this.pager.pageInfoPanel=b("<div class='data-info' />"),this.gridFoot.append(this.pager.pageInfoPanel)):this.pager.pageNumPanel.css("width","100%"),this.gridFoot.append(this.pager.pageNumPanel),this.pager.pageChanged(function(a,b){this.pageIndex=a,this.pageSize=b,this.fire("pagechanging",a,b)},this))},_rasterizeItems:function(b,c){var d,e,f,g,h,i,j,k;e=this.getViewData(),0!==e.length&&(f=this.isGroup(),f&&(this._groupData||(g=this.option.group,this._groupData=g.groupListHandler.call(this,e,g.groupField,g.itemsField)),e=this._groupData),d=this._getMargin(e),this._currentMarginInfo=d,0!==d.count&&(k=a.core.isFunction(c),j=[],h=this,this._viewDataIndex=-1,f?e.forEach(function(a,b){i=h._getItemBody(b,f,j,d.margin),h._fillItemBody(a[h.option.group.itemsField],b,i,d,k,c)}):(i=this._getItemBody(0,f,j,d.margin),this._fillItemBody(e,0,i,d,k,c)),delete this._viewDataIndex,j.length>0&&h.viewBody.append(j)))},_getItemBody:function(a,c,d,e){var f,g;return f=this._itemBodyList[a],f?c&&(g=f.prev(),this.option.group.headRearrangeHandler.call(this,g,a,this._groupData[a],e)):(c&&(g=b("<div class='item-head' />"),g.append(this.option.group.headFormatter.call(this,this._groupData[a],e)),0===d.length&&g.css("margin-top",e+"px"),d.push(g)),f=b("<div class='item-body' />"),d.push(f),this._itemBodyList.push(f)),f},_fillItemBody:function(a,b,c,d,e,f){var g,h,i,j,k,l,m;for(g=Math.floor((a.length+d.count-1)/d.count),c.css("height",g*(this.option.itemHeight+d.margin)+d.margin+"px"),h=0;h<g;h++)for(i=0;i<d.count;i++){if((j=h*d.count+i)>=a.length)return;this._viewDataIndex++,k=(h+1)*d.margin+h*this.option.itemHeight,l=(i+1)*d.margin+i*this.option.itemWidth,m=a[j],m._group={index:b,itemIndex:j},e&&f.call(this,c,m,this._viewDataIndex,k,l)}},_getMargin:function(b,c){var d,e,f,g,h,i,j;return d=this.viewBody.width(),e=this.viewBody.height(),i=this.isGroup(),j=function(a,b){var c,d,f;if(0===b.count)return b;if(i)for(c=b.margin,d=0,f=a.length;d<f;d++)c+=30,c+=Math.floor((a[d][this.option.group.itemsField].length+b.count-1)/b.count)*(b.margin+this.option.itemHeight)+b.margin;else c=Math.floor((a.length+b.count-1)/b.count)*(b.margin+this.option.itemHeight)+b.margin;return c>e?this._getMargin(f,c):b},c&&(h=!0,c>e&&(d-=a.scrollbarWidth)),f={count:Math.floor(d/this.option.itemWidth),margin:0},g=d-f.count*this.option.itemWidth,f.margin=Math.floor(g/(f.count+1)),f.margin>=4?h?f:j.call(this,b,f):(f.margin=4,f.count=Math.floor((d-(f.count+1)*f.margin)/this.option.itemWidth),g=d-f.count*this.option.itemWidth,f.margin=Math.floor(g/(f.count+1)),h?f:j.call(this,b,f))},_createItem:function(a,c){var d=b("<div class='view-item' />");return d.css({width:this.option.itemWidth+"px",height:this.option.itemHeight+"px"}),d.attr("data-index",c),d},_renderItem:function(c,d,e){var f,g,h;h=this.option.renderItemFormatter,a.core.isFunction(h)&&(f=h.call(this,d,e))&&c.append(f),g=b("<div class='frame-panel border-highlight'/>"),g.css({width:this.option.itemWidth-8+"px",height:this.option.itemHeight-8+"px"}),c.append(g),c.append("<i class='check-marker border-highlight'></i>"),c.append("<i class='check-icon far fa-check'></i>")},_renderPageList:function(a){this.pager&&(this.pager.data=this.option.viewData,this.pager.pageIndex=this.pageIndex,this.pager.pageSize=this.pageSize,this.pager.renderPageList(a))},_rearrangeItems:function(){var a,c,d;if(0!==this._itemBodyList.length){for(d=[],a=0,c=this._itemBodyList.length;a<c;a++)d.push(this._itemBodyList[a].children());this._rasterizeItems(!1,function(a,c,e,f,g){var h,i;i=c._group,h=d[i.index][i.itemIndex],b(h).css({top:f+"px",left:g+"px"})})}},_getSelectionData:function(a){var b,c,d;return b=parseInt(a.attr("data-index"),10),d=this.getViewData(),c={itemIndex:b,itemData:d[b]},this.isGroup()&&(c.group={index:c.itemData._group.index,itemIndex:c.itemData._group.itemIndex}),c},_selectItem:function(a){var c,d,e;if(c=this._getSelectionData(a),c.element=a,c.originElement=a.context?b(a.context):null,!1!==this.fire("selecting",c))if(this.isMultiple())if(a.hasClass(k)){for(d=0,e=this._selectList.length;d<e;d++)if(this._selectList[d]===a[0]){this._selectList.splice(d,1);break}a.removeClass(k),this.fire("deselected",c)}else this._selectList.push(a[0]),a.addClass(k),this.fire("selected",c);else if(this._current){if(this._current.removeClass(k),this_current[0]===a[0])return this._current=null,void this.fire("deselected",c);this._current=a,a.addClass(k),this.fire("selected",c)}},_getItemElement:function(a){var c,d,e,f,g;return d=this.getViewData(),0===d.length?null:(g=d[a],c=g._group,(e=this._itemBodyList[c.index])?(f=e.children(),g=f[c.itemIndex],g?b(g):null):null)},_updateIndexes:function(a,c,d){var e,f,g,h,i,j;for(f=this.getViewData(),i=a;i<this._itemBodyList.length;i++){for(e=this._itemBodyList[i],g=e.children(),j=c;j<g.length;j++)b(g[j]).attr("data-index",d),h=f[d],h._group={index:i,itemIndex:j},d++;c=0}},_removeGroup:function(a){var b;b=a.prev(),b.length>0&&b.hasClass("item-head")&&b.remove(),a.remove()},_promptIsShow:function(){return this._hasPrompt&&"block"===this._dataPrompt.css("display")},_setPromptLocation:function(){var a=this._dataPrompt.height();this._dataPrompt.css("margin-top",-a/2+"px")},_showDataPrompt:function(){this._hasPrompt&&(this._dataPrompt.css("display","block"),this._setPromptLocation())},_hideDataPrompt:function(){this._hasPrompt&&this._dataPrompt.css("display","none")},fill:function(a,c){var d;d=!1,this._itemBodyList.length>0&&(d=!0,this.viewBody.scrollTop(0),this.clear(!1)),Array.isArray(a)||(a=[]),this.option.viewData=a,0===a.length?this._showDataPrompt():(this._hideDataPrompt(),this._rasterizeItems(!0,function(a,b,c,d,e){var f=this._createItem(b,c);f.css({top:d+"px",left:e+"px"}),this._renderItem(f,b,c),a.append(f)})),b.isNumeric(c)&&this._renderPageList(c),d&&this.fire("rebind")},getSelection:function(){var a,c,d;if(!this.isSelectable())return null;if(this.isMultiple())for(a=[],c=0,d=this._selectList.length;c<d;c++)a.push(this._getSelectionData(b(this._selectList[c])));else a=null,this._current&&(a=this._getSelectionData(this._current));return a},cancelSelection:function(){var a,c,d;if(this.isSelectable()){if(this.isMultiple()){if(0===this._selectList.length)return;for(a=0,c=this._selectList.length;a<c;a++)d=b(this._selectList[a]),fn.call(this,d);this._selectList=[]}else{if(!this._current)return;fn.call(this,this._current),this._current=null}this.fire("cancel")}},removeAt:function(){var b,c,d,e,f,g,h,i;if(c=this.getViewData(),0!==c.length&&0!==(g=arguments.length)){for(e=[],
f=0;f<g;f++)d=arguments[f],a.core.isNumber(d)&&d>=0&&d<c.length&&e.push(d);if((g=e.length)>0){for(e.sort(function(a,b){return b-a}),f=0;f<g;f++)if(d=e[f],(b=this._getItemElement(d))&&(i=c[d]._group,this.option.viewData.splice(d,1),this.isGroup()?1===this._groupData[i.index][this.option.group.itemsField].length?(this._groupData.splice(i.index,1),this._itemBodyList.splice(i.index,1),this._removeGroup(b.parent())):(this._groupData[i.index][this.option.group.itemsField].splice(i.index,1),b.remove()):b.remove(),this.isSelectable()))if(this.isMultiple()){for(h=0;h<this._selectList.length;h++)if(this._selectList[h]===b[0]){this._selectList.splice(h,1);break}}else this._current&&this._current[0]===b[0]&&(this._current=null);this._updateIndexes(i.index,i.itemIndex,d),this._rearrangeItems()}}},updateItem:function(b,c){var d;!a.core.isNumber(b)||b<0||b>=this.count()||(d=this._getItemElement(b))&&(d.empty(),this.option.viewData[b]=c,this._renderItem(d,c,b))},addItem:function(a){var b,c,d,e,f,g,h,i,j,k;if(a){if(b=this.option.viewData,!Array.isArray(b)||0===b.length)return this.bodyPanel&&(this.bodyPanel.remove(),this.bodyPanel=null),void this.fill([a]);if(h={},this.isGroup()){for(e=a[this.option.group.groupField]+"",d=-1,j=0,k=this._groupData.length;j<k;j++)if(this._groupData[j][this.option.group.groupField]===e){d=j;break}-1===d?(h.index=this._groupData.length,h.itemIndex=0,g={},g[this.option.group.groupField]=e,g[this.option.group.itemsField]=[a],this._groupData.push(g),i=[],f=this._getItemBody(h.index,!0,i,this._currentMarginInfo.margin),this.viewBody.append(i)):(f=this._itemBodyList[d],h.index=d,h.itemIndex=this._groupData[d][this.option.group.itemsField].length,this._groupData[d][this.option.group.itemsField].push(a))}else h.index=0,h.itemIndex=b.length,f=this._itemBodyList[h.index];a._group=h,c=this._createItem(a,b.length),this._renderItem(c,a,b.length),b.push(a),f.append(c),this._rearrangeItems()}},insertItem:function(a,b){var c,d,e,f;if(b){if(f=this.option.viewData,!Array.isArray(f)||0===f.length)return void this.addItem(b);if(a<0&&(a=0),a>=0&&a<f.length){if(d={},this.isGroup()){if(e=f[a],e[this.option.group.groupField]!==b[this.option.group.groupField])throw new Error("the data not belong to the destination group.");d.index=e._group.index,d.itemIndex=e._group.itemIndex,this._groupData[d.index][this.option.group.itemsField].splice(d.itemIndex,0,b)}else d.index=0,d.itemIndex=a;b._group=d,c=this._createItem(b,a),this._renderItem(c,b,a),this._getItemElement(a).before(c),f.splice(a,0,b),this._updateIndexes(d.index,d.itemIndex,a),this._rearrangeItems()}else this.addItem(b)}},getViewData:function(){return Array.isArray(this.option.viewData)?this.option.viewData:[]},getColumnCount:function(){return this._currentMarginInfo?this._currentMarginInfo.count:0},getItemMargin:function(){return this._currentMarginInfo?this._currentMarginInfo.margin:0},count:function(){return Array.isArray(this.option.viewData)?this.option.viewData.length:0},isSelectable:function(){return!!this.option.selection},isMultiple:function(){return!0===this.option.selection.multiple},isGroup:function(){return!!this.option.group},clear:function(){var a;this._itemBodyList.length>0&&(a=this,this._itemBodyList.forEach(function(b){a._removeGroup(b)}),this.isGroup()&&(this._groupData=null),this._itemBodyList=[],this.option.viewData=[],this._selectList=[],this._current=null),this.pager&&this.pager.empty(),!1!==arguments[0]&&this._showDataPrompt()},setSize:function(b,c){var d=!1;1===arguments.length&&(c=b,b=null),a.core.isNumber(c)&&(c-=this.borderHeight,this.pager&&(c-=this.pagerHeight),this.viewBody.css("height",c+"px"),d=!0),a.core.isNumber(b)&&(b-=this.borderWidth,this.element.css("width",b+"px"),d=!0),d&&this._rearrangeItems(),this._promptIsShow()&&this._setPromptLocation()}}),b.fn.cardView=function(b){if(0!==this.length)return a.ctrls.CardView(b,this)}}(ui,ui.$),function(a,b){function c(a){var c,d,e;for(c=b(a.target);"DT"!==c.nodeName()||!c.hasClass("ui-fold-view-title");){if(c.hasClass("ui-fold-view"))return;c=c.parent()}e=c.children(".ui-fold-view-icon"),d=c.next(),"none"===d.css("display")?(e.removeClass("background-highlight").addClass("font-highlight").html("<i class='far fa-angle-up' />"),d.css("display","block")):(e.removeClass("font-highlight").addClass("background-highlight").html("<i class='far fa-angle-down' />"),d.css("display","none"))}function d(a){if(!(this instanceof d))return new d(a);this.initialize(a)}d.prototype={constructor:d,initialize:function(a){this.element=a,this.onFoldTitleClickHandler=c.bind(this)},_render:function(){var a,c,d,e,f,g;for(a=this.element.children("dt"),g=a.length,g>0&&this.element.on("click",this.onFoldTitleClickHandler),f=0;f<g;f++)c=b(a[f]),e=c.text(),c.addClass("ui-fold-view-title"),d=b("<div class='ui-fold-view-icon border-highlight' />"),"none"===c.next().css("display")?d.addClass("background-highlight").html("<i class='far fa-angle-down' />"):d.addClass("font-highlight").html("<i class='far fa-angle-up' />"),c.empty(),c.append(d).append("<span class='font-highlight'>"+e+"</span>")}},b.fn.foldView=function(){var a,c,e;if(0!==this.length)for(a=0;a<this.length;a++)c=b(this[a]),c.isNodeName("dl")&&c.hasClass("ui-fold-view")&&(e=d(c),e._render(),c[0].foldView=e)}}(ui,ui.$),function(a,b){function c(a){return{groupText:a}}function d(){return"array"===a.core.type(this.itemIndexes)}function e(a,b,c,d){return d.isFinale=!0,d.attr("colspan",this.option.columns.length),d.addClass("group-cell"),this.group._last_group_index_=a.groupIndex,this.group.groupItemFormatter.apply(this,arguments)}function f(a,c){var d,e,f;e=c,d=this.gridview.getViewData(),f=d[e.parent()[0].rowIndex],e.hasClass("group-fold")?(e.removeClass("group-fold"),this._operateChildren(f.itemIndexes,function(a,c){b(c).css("display","table-row")})):(e.addClass("group-fold"),this._operateChildren(f.itemIndexes,function(a,c){b(c).css("display","none")}))}function g(){if(!(this instanceof g))return new g;this.initialize()}g.prototype={constructor:g,initialize:function(){this.gridview=null},_operateChildren:function(a,b){var c,d,e,f,g,h;for(c=this.gridview.getViewData(),e=this.gridview.bodyTable[0].rows,g=0,h=a.length;g<h;g++)d=a[g],f=c[d],b.call(this,f,e[d])},setGridView:function(b){var c;if(b instanceof a.ctrls.GridView&&(this.gridview=b,this.gridview.group=this,b.clickHandlers)){if(b.clickHandlers.has("group-cell"))return;c=b.clickHandlers.classEventMap.get("ui-table-body-cell"),b.clickHandlers.remove("ui-table-body-cell"),b.clickHandlers.add("group-cell",f.bind(this)),b.clickHandlers.add("ui-table-body-cell",c)}},listGroup:function(a,d,e){var f=[],g={};if(!Array.isArray(a)||0===a.length)return f;e=b.isFunction(e)?e:c;for(var h,i,j,k=0,l=a.length;k<l;k++)h=a[k],i=h[d],g.hasOwnProperty(i)?g[i].itemIndexes.push(k):(j=e.call(h,i),j.itemIndexes=[k],g[i]=j);for(i in g)for(j=g[i],f.push(j),j.groupIndex=f.length-1,k=0,l=j.itemIndexes.length;k<l;k++)f.push(a[j.itemIndexes[k]]),j.itemIndexes[k]=f.length-1;return f},rowNumber:function(a,b,c,f){var g,h;return g=this.getViewData(),h=g[c],d.call(h)?e.call(this,h,b,c,f):"<span>"+(c-this.group._last_group_index_)+"</span>"},formatText:function(b,c,f,g){var h,i;return h=this.getViewData(),i=h[f],d.call(i)?e.call(this,i,c,f,g):a.ColumnStyle.cfn.defaultText.apply(this,arguments)},groupItemFormatter:function(a,b,c,d){return null}},a.ctrls.GridViewGroup=g}(ui,ui.$),function(a,b){function c(a){return this[a]}function d(a){return!!a[g]}function e(a,b){var c,d,e;c=b,d=c.parent().parent()[0].rowIndex,e=this.gridview.getRowData(d),c.hasClass("unfold")?(e._isFolded=!0,c.removeClass("unfold").removeClass("fa-angle-down").addClass("fa-angle-right"),this._hideChildren(e,d)):(e._isFolded=!1,c.addClass("unfold").removeClass("fa-angle-right").addClass("fa-angle-down"),this._showChildren(e,d))}function f(){if(!(this instanceof f))return new f;this.initialize()}var g="_children";f.prototype={constructor:f,initialize:function(){this.lazy=!1,this.loadChildrenHandler=null,this.gridview=null,this.isTreeNode=d},_fixParentIndexes:function(a,b,c){var d=a._parent;if(d){for(var e=d[g],f=e.length,h=0;h<f;h++)e[h]>b&&(e[h]=e[h]+c);b=e[0]-1,b>=0&&this._fixParentIndexes(d,b,c)}},_fixTreeIndexes:function(a,b,c,d){for(var e,f,h,i=a,j=b;i<j;i++)if(e=c[i],this.isTreeNode(e)){if(!(f=e[g]))continue;for(h=0;h<f.length;h++)f[h]=f[h]+d}},_showChildren:function(a,c){a[g]?this._operateChildren(a[g],function(a,c){if(b(c).css("display","table-row"),!0===a._isFolded)return!1}):this.lazy&&b.isFunction(this.loadChildrenHandler)&&this.loadChildrenHandler(a,c)},_hideChildren:function(a){a[g]&&this._operateChildren(a[g],function(a,c){b(c).css("display","none")})},_operateChildren:function(a,b){var c,d,e,f,h,i;if(a)for(c=this.gridview.getViewData(),e=this.gridview.bodyTable[0].rows,h=0,i=a.length;h<i;h++)d=a[h],f=c[d],!1!==b.call(this,f,e[d])&&f[g]&&this._operateChildren(f[g],b)},_changeLevel:function(a,c,d,e){var f=d._level+e;f<0&&(f=0),d._level=f;var g=this.gridview.option.columns[c],h=b(this.gridview.bodyTable.get(0).rows[a].cells[c]);h.empty(),h.append(g.handler.call(this.gridview,this.gridview.prepareValue(d,g),g,a,h))},_sortListTree:function(a,b,c,d){for(var e,f=0,h=a.length;f<h;f++)e=a[f],delete e._fromList,e._level=d,e._parent=c,b.push(e),a[f]=b.length-1,e[g].length>0?this._sortListTree(e[g],b,e,d+1):delete e[g]},setGridView:function(b){if(b instanceof a.ctrls.GridView&&(this.gridview=b,this.gridview.tree=this,b.clickHandlers)){if(b.clickHandlers.has("fold"))return;b.clickHandlers.add("fold",e.bind(this))}},listTree:function(a,d,e){var f=[],h=c,i=c;if(!Array.isArray(a)||0===a.length)return f;b.isFunction(d)&&(h=d),b.isFunction(e)&&(i=e);var j,k,l,m,n,o,p={};for(m=0;m<a.length;m++)l=a[m],o=h.call(l,d)+""||"__",p.hasOwnProperty(o)?(j=p[o],j[g].push(l)):(j={},j[g]=[],j[g].push(l),p[o]=j),n=i.call(l,e)+"",p.hasOwnProperty(n)?(j=p[n],l[g]=j[g],p[n]=l,l._fromList=!0):(l[g]=[],l._fromList=!0,p[n]=l);for(var q in p)if(p.hasOwnProperty(q)&&(j=p[q],!j.hasOwnProperty("_fromList"))){k=j;break}return this._sortListTree(k[g],f,null,0),f},listTreeByLevel:function(a,b,d){var e=[],f=c;if(!Array.isArray(a)||0===a.length)return e;var h,i,j,k,l=[],m=[];for(h=0;h<a.length;h++)i=a[h],i[g]=[],i[b]=null,h>0?i._level-a[h-1]._level>1&&(i._level=a[h-1]._level+1):i._level=0,k=i._level,l[k]=i,0!==k?(j=l[k-1],j[g].push(i),i[b]=f.call(j,d)):m.push(i);return this._sortListTree(m,e,null,0),e},treeNode:function(a,c,d,e){var f,g,h,i;return a?(f=this.getViewData(),g=f[d],b.isNumeric(g._level)||(g._level=0),h=b("<span />").text(a),this.tree.isTreeNode(g)?(g._isFolded=!1,h=[null,h[0]],i=b(this.tree.lazy?"<i class='fold font-highlight-hover far fa-angle-right' />":"<i class='fold unfold font-highlight-hover far fa-angle-down' />"),i.css("margin-left",17*g._level+5+"px"),h[0]=i[0]):h.css("margin-left",17*(g._level+1)+5+"px"),h):null},levelNode:function(c,d,e,f){var g,h,i;return c?(g=this.getViewData(),h=g[e],a.type.isNumber(h._level)||(h._level=0),i=b("<span />").text(c),i.css("margin-left",17*(h._level+1)+5+"px"),i):null},addChildren:function(a,c,d){var e,f,h,i,j,k=c+1;for(a[g]=[],e=this.gridview.getViewData(),i=0,j=d.length;i<j;i++)f=d[i],f._level=a._level+1,f._parent=a,a[g].push(k),h=b("<tr />"),e.splice(k,0,f),this.gridview._createRowCells(h,f,k),k<e.length-1?b(this.gridview.bodyTable[0].rows[k]).before(h):this.gridview.bodyTable.append(h),k++;this.gridview._updateScrollState(),this.gridview._refreshRowNumber(k-1),this._fixParentIndexes(a,c,j),this._fixTreeIndexes(c+1+j,e.length,e,j)},changeLevel:function(b,c,d,e){var f,g,h,i;if(g=this.gridview.getViewData(),!("number"!==a.core.type(b)||b<0||b>=g.length)&&(f=g[b],e=!!e,h=f._level,this._changeLevel(b,c,f,d),e))for(i=b+1;i<g.length;){if(f=g[i],f._level<=h)return;this._changeLevel(i,c,f,d),i++}}},a.ctrls.GridViewTree=f}(ui,ui.$),function(a,b){function c(b){return b?a.str.htmlEncode(b):b}function d(b){b.showPageInfo&&(b.pageInfoFormatter||(b.pageInfoFormatter={currentRowNum:function(a){return"<span>本页"+a+"行</span>"},rowCount:function(a){return"<span class='font-highlight'>共"+a+"行</span>"},pageCount:function(a){return"<span>"+a+"页</span>"}})),this.pager=a.ctrls.Pager(b),this.pageIndex=this.pager.pageIndex,this.pageSize=this.pager.pageSize}function e(b){this.view=b,this.currentSortColumn=null,this.sorter=new a.Introsort,this.sortAfterFn=null,this._resetSortColumnStateHandler=function(){this.resetSortColumnState()}.bind(this)}function f(a){this.handlers=[],this.view=a}function g(a,b){b?a.removeClass("fa-square").addClass("fa-check-square").addClass("font-highlight"):a.removeClass("fa-check-square").removeClass("font-highlight").addClass("fa-square")}function h(a){var c,d,e=!a.hasClass("fa-check-square");if(g(a,e),!this._gridCheckboxAll){if(c=this._getColumnIndexByFormatter(s,"text"),-1===c.columnIndex)return;d=c.headTable[0].tHead.rows,this._gridCheckboxAll=b(d[d.length-1].cells[c.columnIndex]).find("."+o)}e?this._checkedCount++:this._checkedCount--,this._checkedCount===this.count()?g(this._gridCheckboxAll,!0):g(this._gridCheckboxAll,!1)}function i(a,b){var c,d,e;c=this.getViewData(),0!==c.length&&(d=b[0].cellIndex,e=this._getColumn(d),this.sorter.sort(c,b,e))}function j(c,d){var e,f,g,i;if(this.isSelectable()&&(e=b(c.target),!(g=this.option.selection.exclude)||(i=!0,a.core.isString(g)?i=this._excludeElement(e,g):a.core.isFunction(g)&&(i=g.call(this,e)),!1!==i))){if(e.hasClass(n)&&!this.option.selection.isRelateCheckbox)return void h.call(this,e);"row"===this.option.selection.type&&(d=d.parent()),f="cell"===this.option.selection.type?"cell-selected":"row-selected",d.context=c.target,this._selectItem(d,f)}}function k(c){var d,e,f,h,i,j,k,l,m,o,p;if(c.stopPropagation(),0!==this.count()&&(d=b(c.target),-1!==(i=d.parent().prop("cellIndex")))){if(h=!d.hasClass("fa-check-square"),g.call(this,d,h),!0===this.option.selection.isRelateCheckbox&&this.isMultiple())if(k="cell"===this.option.selection.type?"cell-selected":"row-selected",h)l=function(a,b){var c;c="cell"===this.option.selection.type?a:a.parent(),c.context=b[0],this._selectItem(c,k,h)};else{for(m=0,o=this._selectList.length;m<o;m++)b(this._selectList[m]).removeClass(k).removeClass("background-highlight");this._selectList=[]}for(p=d.parent();;){if(p.hasClass("ui-grid-view"))return;if(p.hasClass("ui-grid-head")){p=p.next(),p=p.find("table"),j=0===p.length?[]:p[0].tBodies[0].rows;break}p=p.parent()}for(m=0,o=j.length;m<o;m++)f=b(j[m].cells[i]),e=f.find("."+n),e.length>0&&(a.core.isFunction(l)?l.call(this,f,e):g.call(this,e,h));this._checkedCount=h?this.count():0}}function l(a){var b=this.head[0],c=this.body[0];b.scrollLeft=c.scrollLeft}function m(a,c){this.view=a,this.enabled=!0,c||(this.enabled=!1),this.element=b("<div class='data-prompt' />"),this.setText(c),this.view.body.append(this.element)}var n="grid-checkbox",o="grid-checkbox-all",p="fa-sort-up",q=/^((?:[\w\u00c0-\uFFFF\*_-]|\\.)+)/,r=/\[\s*((?:[\w\u00c0-\uFFFF_-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,s=a.ColumnStyle.cnfn.checkAll,t=a.ColumnStyle.cfn.check,u=a.ColumnStyle.cnfn.columnText,v=a.ColumnStyle.cfn.text,w=a.ColumnStyle.cfn.rowNumber;e.prototype={constructor:e,prepareHead:function(){this.sortCells=[],this._isAddedResetSortColumnState=!1,this.view.columnResetter.remove(this._resetSortColumnStateHandler)},setSortColumn:function(b,c,d){(!0===c.sort||a.core.isFunction(c.sort))&&(b.addClass("sort-column"),b.append("<i class='fa fa-sort' />"),this.sortCells.push(b),this._isAddedResetSortColumnState||(this.view.columnResetter.add(this._resetSortColumnStateHandler),this._isAddedResetSortColumnState=!0))},resetSortColumnState:function(){var a,b,c;if(this.sortCells)for(b=0,c=this.sortCells.length;b<c;b++)if(a=this.sortCells[b].find("i"),!a.hasClass("fa-sort"))return void a.attr("class","fa fa-sort")},sort:function(b,c,d){var e,f,g,h,i,j,k,l;if(e=this.view,0!==b.length){if(this.currentSortColumn!==d&&this.resetSortColumnState(),f=this.currentSortColumn===d,this.currentSortColumn=d,i=e.bodyTable.children("tbody"),j=i.children().get(),a.core.isFunction(this.sortAfterFn)&&(k=j.slice(0)),!Array.isArray(j)||j.length!==b.length)throw new Error("data row error");l=c.find("i"),l.hasClass(p)?(this.reverse(b,j),l.removeClass("fa-sort").removeClass(p).addClass("fa-sort-down")):(f?this.reverse(b,j):(h=d.sort,a.core.isFunction(h)||(h=function(a,b){return this.defaultComparer(a,b)}.bind(this)),g=function(a,b){return a=e._prepareValue(a,d),b=e._prepareValue(b,d),h(a,b)},this.sorter.items=j,this.sorter.sort(b,g)),l.removeClass("fa-sort").removeClass("fa-sort-down").addClass(p)),i.append(j),k&&this.sortAfterFn(k),e._refreshRowNumber()}},defaultComparer:function(a,b){var c,d,e;if(Array.isArray(a)){for(c=0,d=0,e=a.length;d<e;d++)if(0!==(c=this.sorting(a[d],b[d])))return c;return c}return this.sorting(a,b)},sorting:function(a,b){return"string"==typeof a?a.localeCompare(b):a<b?-1:a>b?1:0},reverse:function(a,b){var c,d,e,f;for(d=0,e=a.length-1,f=a.length/2;d<f;d++,e--)c=a[d],a[d]=a[e],a[e]=c,c=b[d],b[d]=b[e],b[e]=c},reset:function(){this.currentSortColumn=null,this.sorter.keys=null,this.sorter.items=null}},f.prototype={constructor:f,add:function(b){a.core.isFunction(b)&&this.handlers.push(b)},remove:function(a){var b;for(b=this.handlers.length-1;b>=0;b--)if(this.handlers[b]===a){this.handlers.splice(b,1);break}},reset:function(){var a=this.view;this.handlers.forEach(function(b){try{b.call(a)}catch(a){}})}},m.prototype={constructor:m,isShow:function(){return this.enabled&&"block"===this.element.css("display")},show:function(){this.enabled&&this.element.css("display","block")},hide:function(){this.enabled&&this.element.css("display","none")},setText:function(b){this.enabled&&(a.core.isString(b)&&b.length>0?this.element.html("<span class='font-highlight'>"+c(b)+"</span>"):a.core.isFunction(b)&&(b=b(),this.element.append(b)))}},a.ctrls.define("ui.ctrls.GridView",{_defineOption:function(){return{columns:[],viewData:null,prompt:"没有数据",height:!1,width:!1,textFormatter:null,mouseHoverReaction:!0,pager:{pageIndex:1,pageSize:100,pageButtonCount:10,showPageInfo:!1,pageInfoFormatter:null},selection:{type:"row",exclude:!1,multiple:!1,isRelateCheckbox:!0}}},_defineEvents:function(){var a=["selecting","selected","deselected","rebind","cancel"];return this.option.pager&&a.push("pagechanging"),a},_create:function(){this._selectList=[],this.columnResetter=new f(this),this.sorter=new e(this),this.head=null,this.body=null,this.foot=null,this.rowHeight=30,this.headHeight=this.rowHeight,this.bodyHeight=0,this.footHeight=30,this._checkedCount=0,this.option.pager?d.call(this,this.option.pager):(this.pageIndex=1,this.pageSize=100),this.option.selection?(a.core.isString(this.option.selection.type)?this.option.selection.type=this.option.selection.type.toLowerCase():this.option.selection.type="disabled",this.option.selection.multiple||(this.option.selection.isRelateCheckbox=!1)):this.option.selection={type:"disabled"},(!a.core.isNumber(this.option.width)||this.option.width<=0)&&(this.option.width=!1),(!a.core.isNumber(this.option.height)||this.option.height<=0)&&(this.option.height=!1),this.clickHandlers=this.createClassEventDelegate("click"),this.clickHandlers.add("sort-column",i.bind(this)),this.clickHandlers.add(o,k.bind(this)),this.clickHandlers.add("ui-table-body-cell",j.bind(this)),this.onScrollingHandler=l.bind(this)},_render:function(){if(!this.element)throw new Error("the element is null.");this.element.hasClass("ui-grid-view")||this.element.addClass("ui-grid-view"),this.element.on("click",this.clickHandlers.getDelegateHandler(function(a){return a.hasClass("ui-grid-view")}).bind(this)),this._initBorderWidth(),this.head=b("<div class='ui-grid-head' />"),this.element.append(this.head),this.body=b("<div class='ui-grid-body' />"),this.body.on("scroll",this.onScrollingHandler),this.element.append(this.body),this.prompt=new m(this,this.option.prompt),this._initPagerPanel(),this.createHead(this.option.columns),Array.isArray(this.option.viewData)?this.createBody(this.option.viewData,this.option.viewData.length):this.option.viewData=[],this.setSize(this.option.width,this.option.height)},_initBorderWidth:function(){var a=function(a){return parseInt(this.element.css(a),10)||0};this.borderWidth=0,this.borderHeight=0,this.borderWidth+=a.call(this,"border-left-width"),this.borderWidth+=a.call(this,"border-right-width"),this.borderHeight+=a.call(this,"border-top-width"),this.borderHeight+=a.call(this,"border-bottom-width")},_initPagerPanel:function(){this.pager&&(this.foot=b("<div class='ui-grid-foot clear' />"),this.element.append(this.foot),this.pager.pageNumPanel=b("<div class='page-panel' />"),this.option.pager.showPageInfo?(this.pager.pageInfoPanel=b("<div class='data-info' />"),this.foot.append(this.pager.pageInfoPanel)):this.pager.pageNumPanel.css("width","100%"),this.foot.append(this.pager.pageNumPanel),this.pager.pageChanged(function(a,b){this.pageIndex=a,this.pageSize=b,this.fire("pagechanging",a,b)},this))},_createRowCells:function(b,c,d,e,f){var g,h,i,j,k,l,m,n,o;for(o="cell"!==this.option.selection.type,!this._noBodyHover&&o&&b.addClass("table-body-row-hover"),a.core.isFunction(e)&&(e=null,f=e),Array.isArray(e)||(e=this.option.columns),n=a.core.isFunction(f),g=0,h=e.length;g<h;g++)if(i=e[g],m=i.formatter,a.core.isFunction(i.formatter)||(m=this.option.textFormatter),a.core.isFunction(m)||(m=v),j=this._prepareValue(c,i),k=this._createCell("td",i),k.addClass("ui-table-body-cell"),this._noBodyHover||o||k.addClass("table-body-cell-hover"),l=m.call(this,j,i,d,k),!k.isAnnulment&&(n&&(l=f.call(this,l,i,c)),l&&k.append(l),g===h-1&&k.addClass("last-cell"),b.append(k),k.isFinale)){k.addClass("last-cell");break}},_createCol:function(c){var d=b("<col />");return a.core.isNumber(c.len)&&d.css("width",c.len+"px"),d},_createCell:function(a,c){var d=b("<"+a+" />"),e={};return c.align&&(e["text-align"]=c.align),d.css(e),d},_prepareValue:function(a,b){var c,d,e;if(Array.isArray(b.column))for(c={},d=0,e=b.column.length;d<e;d++)c[d]=c[b.column[d]]=this._getValue(a,b.column[d],b);else c=this._getValue(a,b.column,b);return c},_getValue:function(b,c,d){var e,f,g=0;if(!a.core.isString(c))return null;for(d._columnKeys.hasOwnProperty(c)||(d._columnKeys[c]=c.split(".")),e=d._columnKeys[c],f=b[e[g]],g=1;g<e.length;g++)if(void 0===(f=f[e[g]])||null===f)return f;return f},_getColumn:function(a){return this.option.columns[a]},_renderPageList:function(a){this.pager&&(this.pager.data=this.getViewData(),this.pager.pageIndex=this.pageIndex,this.pager.pageSize=this.pageSize,this.pager.renderPageList(a))},_updateScrollState:function(){var b=this.body[0].scrollHeight,c=this.body.height();this.headTable&&(b-c>1?this._headScrollCol.css("width",a.scrollbarWidth+.1+"px"):this._headScrollCol.css("width","0"))},_refreshRowNumber:function(c,d){var e,f,g,h,i,j,k,l;if(e=this.getViewData(),0!==e.length&&(g=w,f=this._getColumnIndexByFormatter(g),-1!=f.columnIndex))for(a.core.isNumber(c)||(c=0),h=f.bodyTable[0].rows,j=f.columns[f.columnIndex],l=a.core.isNumber(d)?d+1:h.length,k=c;k<l;k++)i=b(h[k].cells[f.columnIndex]),i.html(""),i.append(g.call(this,null,j,k))},_getColumnIndexByFormatter:function(a,b){var c,d,e;for(c={columnIndex:-1,columns:this.option.columns,headTable:this.headTable,bodyTable:this.bodyTable},b||(b="formatter"),d=0,e=c.columns.length;d<e;d++)if(c.columns[d][b]===a)return c.columnIndex=d,c;return c},_getSelectionData:function(a){var b={},c=this.getViewData();return"cell"===this.option.selection.type?(b.rowIndex=a.parent().prop("rowIndex"),b.cellIndex=a.prop("cellIndex"),b.rowData=c[b.rowIndex],b.column=this._getColumn(b.cellIndex).column):(b.rowIndex=a.prop("rowIndex"),b.rowData=c[b.rowIndex]),b},_excludeElement:function(b,c){var d,e,f,g,h=b.nodeName().toLowerCase(),i=c.split(",");for(f=0,g=i.length;f<g;f++)if(d=a.str.trim(i[f]),e=d.match(r)){if((d=d.match(q)[1])===h)return b.attr(e[1])!==e[4]}else if(d.toLowerCase()===h)return!1},_addSelectedState:function(a,b,c){a.addClass(b).addClass("background-highlight"),c&&this.fire("selected",c)},_removeSelectedState:function(a,b,c){a.removeClass(b).removeClass("background-highlight"),c&&this.fire("deselected",c)},_selectItem:function(a,c,d){var e,f,h,i,j,k;if(e=this._getSelectionData(a),e.element=a,e.originElement=a.context?b(a.context):null,!1!==this.fire("selecting",e))if(this.isMultiple()){if(a.hasClass(c)){if(!0===d)return;for(d=!1,i=0,j=this._selectList.length;i<j;i++)if(this._selectList[i]===a[0]){this._selectList.splice(i,1);break}this._removeSelectedState(a,c,e)}else{if(!1===d)return;d=!0,this._selectList.push(a[0]),this._addSelectedState(a,c,e)}this.option.selection.isRelateCheckbox&&(e.originElement&&e.originElement.hasClass(n)&&(h=e.originElement),h||(f=this._getColumnIndexByFormatter(t),f.columnIndex>-1&&(h=b("cell"===this.option.selection.type?a.parent()[0].cells[f.columnIndex]:a[0].cells[f.columnIndex]),h=h.find("."+n))),h&&h.length>0&&g.call(this,h,d))}else{if(this._current&&(k=this._current[0]===a[0],this._removeSelectedState(this._current,c,k?e:null),k))return void(this._current=null);this._current=a,this._addSelectedState(a,c,e)}},createHead:function(c){var d,e,f,g,h,i;for(Array.isArray(c)&&(this.option.columns=c),this.sorter.prepareHead(),this.headTable?this.headTable.html(""):(this.headTable=b("<table class='ui-table-head' cellspacing='0' cellpadding='0' />"),this.head.append(this.headTable)),d=b("<colgroup />"),e=b("<thead />"),f=b("<tr />"),i=0;i<c.length;i++)h=c[i],h._columnKeys||(h._columnKeys={}),d.append(this._createCol(h)),g=this._createCell("th",h),g.addClass("ui-table-head-cell"),a.core.isFunction(h.text)?g.append(h.text.call(this,h,g)):h.text&&g.append(u.call(this,h,g)),this.sorter.setSortColumn(g,h,i),i==c.length-1&&g.addClass("last-cell"),f.append(g);this._headScrollCol=this._createCol({len:0}),d.append(this._headScrollCol),f.append(b("<th class='ui-table-head-cell scroll-cell' />")),e.append(f),this.headTable.append(d),this.headTable.append(e)},createBody:function(c,d){var e,f,g,h,i,j,k,l,m=!1;if(this.bodyTable?(this.body.scrollTop(0),this.clear(!1),m=!0):(this.bodyTable=b("<table class='ui-table-body' cellspacing='0' cellpadding='0' />"),this.body.append(this.bodyTable)),k=this.option.columns,Array.isArray(c)||(c=[]),this.option.viewData=c,0===c.length)this.prompt.show();else{for(this.prompt.hide(),e=b("<colgroup />"),f=b("<tbody />"),this.bodyTable.append(e),i=0,j=k.length;i<j;i++)l=k[i],e.append(this._createCol(l));for(h=0,j=c.length;h<j;h++)g=b("<tr />"),this._createRowCells(g,c[h],h,k),f.append(g);this.bodyTable.append(f),this._updateScrollState()}a.core.isNumber(d)&&this._renderPageList(d),m&&this.fire("rebind")},getCheckedValues:function(){var a,d,e,f,g,h="."+n,i=[];if(a=this._getColumnIndexByFormatter(t),-1===a.columnIndex)return i;for(d=a.bodyTable[0].tBodies[0].rows,f=0,g=d.length;f<g;f++)e=b(d[f].cells[a.columnIndex]).find(h),e.length>0&&i.push(c(e.attr("data-value")));return i},getSelection:function(){var a,c,d;if(!this.isSelectable())return null;if(this.isMultiple())for(a=[],c=0,d=this._selectList.length;c<d;c++)a.push(this._getSelectionData(b(this._selectList[c])));else a=null,this._current&&(a=this._getSelectionData(this._current));return a},cancelSelection:function(){var a,c,d,e,f,h,i;if(this.isSelectable()){if(a="cell"===this.option.selection.type?"cell-selected":"row-selected",this.option.selection.isRelateCheckbox?(e="."+n,d=this._getColumnIndexByFormatter(t),f=function(c){var f,h;-1!==d.columnIndex&&(h=b("cell"===this.option.selection.type?c.parent()[0].cells[d.columnIndex]:c[0].cells[d.columnIndex]),f=h.find(e),g(f,!1)),this._removeSelectedState(c,a)}):f=function(b){this._removeSelectedState(b,a)},this.isMultiple()){if(0===this._selectList.length)return;for(h=0,i=this._selectList.length;h<i;h++)c=b(this._selectList[h]),f.call(this,c);this._selectList=[]}else{if(!this._current)return;f.call(this,this._current),this._current=null}this.fire("cancel")}},removeRowAt:function(){var c,d,e,f,g,h,i,j,k;if(e=this.getViewData(),0!==e.length&&0!==(h=arguments.length)){for(d=[],g=0;g<h;g++)c=arguments[g],a.core.isNumber(c)&&c>=0&&c<e.length&&d.push(c);if((h=d.length)>0){for(d.sort(function(a,b){return b-a}),j=this.option.selection.type,i=this.isMultiple(),"row"===j?k=function(a){var b,c,d;if(i){for(b=0,c=this._selectList.length;b<c;b++)if(d=this._selectList[b],a===d.rowIndex)return void this._selectList.splice(b,1)}else this._current&&this._current[0].rowIndex===a&&(this._current=null)}:"cell"===j&&(k=function(a){var b,c,d;if(i){for(b=0,c=this._selectList.length;b<c;b++)if(d=this._selectList[b],d=d.parentNode,a===d.rowIndex)return void this._selectList.splice(b,1)}else this._current&&(d=this._current.parent(),d[0].rowIndex===a&&(this._current=null))}),g=0;g<h;g++)c=d[g],f=b(this.bodyTable[0].rows[c]),f.remove(),e.splice(c,1),k&&k.call(this,c);this._updateScrollState(),this._refreshRowNumber(c)}}},updateRow:function(a,c){var d,e,f=arguments[2],g=arguments[3];d=this.getViewData(),0!==d.length&&(a<0||a>d.length||(e=b(this.bodyTable[0].rows[a]),0!==e.length&&(e.empty(),d[a]=c,this._createRowCells(e,c,a,f,g))))},addRow:function(a){var c,d,e,f=arguments[1],g=arguments[2];if(a){if(c=this.getViewData(),0===(e=c.length))return this.bodyTable&&(this.bodyTable.remove(),this.bodyTable=null),void this.createBody([a]);d=b("<tr />"),this._createRowCells(d,a,e,f,g),b(this.bodyTable[0].tBodies[0]).append(d),c.push(a),this._updateScrollState()}},insertRow:function(a,c){var d,e,f=arguments[2],g=arguments[3];if(c){if(d=this.getViewData(),0===d.length)return void this.addRow(c);a<0&&(a=0),a<d.length?(e=b("<tr />"),this._createRowCells(e,c,a,f,g),b(this.bodyTable[0].rows[a]).before(e),d.splice(a,0,c),this._updateScrollState(),this._refreshRowNumber()):this.addRow(c)}},currentRowUp:function(){var a;if(this.isMultiple())throw new Error("The currentRowUp can not support for multiple selection");if("cell"===this.option.selection.type)throw new Error("The currentRowUp can not support for cell selection");(a=this.getSelection())&&0!==a.rowIndex&&this.moveRow(a.rowIndex,a.rowIndex-1)},currentRowDown:function(){var a;if(this.isMultiple())throw new Error("The currentRowDown can not support for multiple selection");if("cell"===this.option.selection.type)throw new Error("The currentRowDown can not support for cell selection");!(a=this.getSelection())||a.rowIndex>=this.count()||this.moveRow(a.rowIndex,a.rowIndex+1)},moveRow:function(a,c){var d,e,f,g;d=this.getViewData(),0!==d.length&&(c<0?c=0:c>=d.length&&(c=d.length-1),a!==c&&(e=this.bodyTable[0].tBodies[0].rows,f=b(e[c]),c>a?(f.after(b(e[a])),this._refreshRowNumber(a,c)):(f.before(b(e[a])),this._refreshRowNumber(c,a)),g=d[a],d.splice(a,1),d.splice(c,0,g)))},getRowData:function(b){var c=this.getViewData();return 0===c.length?null:!a.core.isNumber(b)||b<0||b>=c.length?null:c[b]},getViewData:function(){return Array.isArray(this.option.viewData)?this.option.viewData:[]},count:function(){return this.getViewData().length},isSelectable:function(){var a=this.option.selection.type;return"row"===a||"cell"===a},isMultiple:function(){return!0===this.option.selection.multiple},clear:function(){this.option.viewData=null,this._selectList=[],this._current=null,this._checkedCount=0,this.bodyTable&&this.bodyTable.html(""),this.headTable&&this.columnResetter.reset(),this.pager&&this.pager.empty(),this.sorter.reset(),!1!==arguments[0]&&this.prompt.show()},setSize:function(b,c){1===arguments.length&&(c=b,b=null),a.core.isNumber(c)?(this.height=c,this.innerHeight=c-this.borderHeight,c=this.innerHeight-this.headHeight,this.pager&&(c-=this.footHeight),this.bodyHeight=c,this.body.css("height",this.bodyHeight+"px")):(this.innerHeight=this.element.height(),this.height=this.innerHeight+this.borderHeight),a.core.isNumber(b)?(this.width=b,this.innerWidth=b-this.borderWidth,this.bodyWidth=this.innerWidth,this.element.css("width",this.innerWidth+"px")):(this.innerWidth=this.element.width(),this.width=this.innerWidth+this.borderWidth),this._updateScrollState()}}),b.fn.gridView=function(b){
if(0!==this.length)return a.ctrls.GridView(b,this)}}(ui,ui.$),function(a,b){function c(b){return b?a.str.htmlEncode(b):b}function d(a,b){return"<span class='ui-list-view-item-text'>"+c(a)+"</span>"}function e(a,b){var c=d(a),e=d(b);return c.localeCompare(e)}function f(a){var c,d,e;for(c=b(a.target),d=c.hasClass("ui-item-view-remove");!c.isNodeName("li");){if(c.hasClass("ui-list-view-ul"))return;c=c.parent()}c[0]!==a.target&&(c.context=a.target),e=this._getItemIndex(c[0]),this.option.hasRemoveButton&&d?this._removeItem(c,e):this._selectItem(c,e)}var g="ui-list-view-selection";a.ctrls.define("ui.ctrls.ListView",{_defineOption:function(){return{multiple:!1,viewData:null,itemFormatter:!1,hasRemoveButton:!1,animatable:!0,pager:!1}},_defineEvents:function(){var a=["selecting","selected","deselected","cancel","removing","removed"];return this.option.pager&&a.push("pageChanging"),a},_create:function(){this._selectList=[],this.sorter=new a.Introsort,a.core.isFunction(this.option.itemFormatter)||(this.option.itemFormatter=d),this.option.hasRemoveButton=!!this.option.hasRemoveButton,this.onListItemClickHandler=f.bind(this)},_render:function(){this.element.addClass("ui-list-view"),this.listPanel=b("<ul class='ui-list-view-ul' />"),this.listPanel.on("click",this.onListItemClickHandler),this.element.append(this.listPanel),this.option.pager&&this._initPager(this.option.pager),this._initAnimator(),this.setViewData(this.option.viewData)},_initPager:function(c){this.pagerPanel=b("<div class='ui-list-view-pager clear' />"),this.element.append(this.pagerPanel),this.listPanel.addClass("ui-list-view-pagelist"),this.pager=a.ctrls.Pager(c),this.pageIndex=this.pager.Index,this.pageSize=this.pager.pageSize,this.pager.pageNumPanel=this.pagerPanel,this.pager.pageChanged(function(a,b){this.pageIndex=a,this.pageSize=b,this.fire("pagechanging",a,b)},this)},_initAnimator:function(){this.removeFirstAnimator=a.animator({ease:a.AnimationStyle.easeFromTo,onChange:function(a){this.target.css("margin-left",a+"px")}}),this.removeFirstAnimator.duration=300,this.removeSecondAnimator=a.animator({ease:a.AnimationStyle.easeFromTo,onChange:function(a){this.target.css("height",a+"px")}}),this.removeSecondAnimator.duration=300},_fill:function(a){var b,c,d,e=[];for(this.listPanel.empty(),this.option.viewData=[],b=0,c=a.length;b<c;b++)null!==(d=a[b])&&void 0!==d&&(this._createItemHtml(e,d,b),this.option.viewData.push(d));this.listPanel.html(e.join(""))},_createItemHtml:function(b,c,d){var e,f,g;if(b.push("<li ","data-index","='",d,"' class='ui-list-view-item'>"),e=this.option.itemFormatter.call(this,c,d),a.core.isString(e))b.push("<div class='ui-list-view-container'>"),b.push(e),b.push("</div>");else if(a.core.isPlainObject(e)){if(g=b[b.length-1],f=g.lastIndexOf("'"),b[b.length-1]=g.substring(0,f),a.core.isString(e.class)?b.push(" ",e.class):Array.isArray(e.class)&&b.push(" ",e.class.join(" ")),b.push("'"),e.style&&!a.core.isEmptyObject(e.style)){b.push(" style='");for(g in e.style)e.style.hasOwnProperty(g)&&b.push(g,":",e.style[g],";");b.push("'")}b.push(">"),b.push("<div class='ui-list-view-container'>"),e.html&&b.push(e.html),b.push("</div>")}this._appendOperateElements(b),b.push("</li>")},_createItem:function(c,d){var e=[],f=b("<li class='ui-list-view-item' />"),g=b("<div class='ui-list-view-container' />"),h=this.option.itemFormatter.call(this,c,d);return f.attr("data-index",d),a.core.isString(h)?g.append(h):a.core.isPlainObject(h)&&(a.core.isString(h.class)?f.addClass(h.class):Array.isArray(h.class)&&f.addClass(h.class.join(" ")),h.style&&!a.core.isEmptyObject(h.style)&&f.css(h.style),h.html&&g.html(h.html)),f.append(g),this._appendOperateElements(e),f.append(e.join("")),f},_appendOperateElements:function(a){a.push("<b class='ui-list-view-b background-highlight'></b>"),this.option.hasRemoveButton&&a.push("<a href='javascript:void(0)' class='closable-button ui-item-view-remove'>×</a>")},_indexOf:function(a){var b,c,d=this.getViewData();for(b=0,c=d.length;b<c;b++)if(a===d[b])return b;return-1},_getItemIndex:function(a){return parseInt(a.getAttribute("data-index"),10)},_itemIndexAdd:function(a,b){this._itemIndexSet(a,this._getItemIndex(a)+b)},_itemIndexSet:function(a,b){a.setAttribute("data-index",b)},_getSelectionData:function(a){var b=this._getItemIndex(a),c={},d=this.getViewData();return c.itemData=d[b],c.itemIndex=b,c},_removeItem:function(a,c){var d,e,f,g,h=this;if(g=this.getViewData(),e=this._getSelectionData(a[0]),e.element=a,e.originElement=a.context?b(a.context):null,!1!==this.fire("removing",e)){if(1===arguments.length&&(c=this._getItemIndex(a[0])),d=function(){for(var b,d=a.next();d.length>0;)this._itemIndexAdd(d[0],-1),d=d.next();if(this.isMultiple()){for(b=0;b<this._selectList.length;b++)if(a[0]===this._selectList[b]){this._selectList.splice(b,1);break}}else this._current&&this._current[0]===a[0]&&(this._current=null);this.fire("removed",e),a.remove(),g.splice(c,1)},!1===this.option.animatable)return void d.call(this);f=this.removeFirstAnimator[0],f.target=a,f.begin=0,f.end=-f.target.width(),f=this.removeSecondAnimator[0],f.target=a,f.begin=f.target.height(),f.end=0,f.target.css({height:f.begin+"px",overflow:"hidden"}),this.removeFirstAnimator.start().then(function(){return h.removeSecondAnimator.start()}).then(function(){d.call(h)})}},_selectItem:function(a,c,d,e){var f,h;if(f=this._getSelectionData(a[0]),f.element=a,f.originElement=a.context?b(a.context):null,!1!==this.fire("selecting",f)){if(d=2===arguments.length?!a.hasClass(g):!!d,this.isMultiple())if(d)this._selectList.push(a[0]),a.addClass(g);else{for(h=0;h<this._selectList.length;h++)if(this._selectList[h]===a[0]){this._selectList.splice(h,1);break}a.removeClass(g)}else d?(this._current&&this._current.removeClass(g),this._current=a,this._current.addClass(g)):(a.removeClass(g),this._current=null);!1!==e&&(d?this.fire("selected",f):this.fire("deselected",f))}},add:function(a){var b;a&&(b=this._createItem(a,this.option.viewData.length),this.listPanel.append(b),this.option.viewData.push(a))},remove:function(b){var c=a.core.type(b);"undefined"===c&&"null"===c||this.removeAt(this._indexOf(b))},removeAt:function(a){var c;a<0||a>=this.count()||(c=b(this.listPanel.children()[a]),this._removeItem(c))},insert:function(a,c){var d,e,f,g;if(c<0&&(c=0),c>=this.option.viewData.length)return void this.add(a);for(f=this._createItem(a,c),e=this.listPanel.children(),d=b(e[c]),g=c;g<e.length;g++)this._itemIndexAdd(e[g],1);f.insertBefore(d),this.option.viewData.splice(c,0,a)},currentUp:function(){var a;if(this.isMultiple())throw new Error("The currentUp can not support for multiple selection");this._current&&(a=this._getItemIndex(this._current[0]))>0&&this.moveTo(a,a-1)},currentDown:function(){var a;if(this.isMultiple())throw new Error("The currentDown can not support for multiple selection");this._current&&(a=this._getItemIndex(this._current[0]))<this.count()-1&&this.moveTo(a,a+1)},moveTo:function(a,c){var d,e,f,g,h,i,j;if(g=this.getViewData(),0!==(h=this.count())&&!(a<0||a>=h||c<0||c>=h||a===c)){if(d=this.listPanel.children(),e=b(d[a]),f=b(d[c]),a<c){for(j=c;j>a;j--)this._itemIndexAdd(d[j],-1);this._itemIndexSet(e[0],c),f.after(e)}else{for(j=c;j<a;j++)this._itemIndexAdd(d[j],1);this._itemIndexSet(e[0],c),f.before(e)}i=g[a],g.splice(a,1),g.splice(c,0,i)}},getSelection:function(){var a,b=null;if(this.isMultiple())for(b=[],a=0;a<this._selectList.length;a++)b.push(this._getSelectionData(this._selectList[a]));else this._current&&(b=this._getSelectionData(this._current[0]));return b},setSelection:function(a){var c,d,e,f,g;for(this.cancelSelection(),this.isMultiple()?Array.isArray(a)||(a=[a]):a=Array.isArray(a)?[a[0]]:[a],f=this.listPanel.children(),c=0,d=a.length;c<d;c++)e=a[c],(g=f[e])&&this._selectItem(b(g),e,!0,c>=d-1)},cancelSelection:function(){var a,c,d;if(this.isMultiple()){for(c=0,d=this._selectList.length;c<d;c++)a=b(this._selectList[c]),a.removeClass(g);this._selectList=[]}else this._current&&(this._current.removeClass(g),this._current=null);this.fire("cancel")},sort:function(b){var c,d,f,g;if(0!==this.count()){for(a.core.isFunction(b)||(b=e),c=this.listPanel.children(),this.sorter.items=c,this.sorter.sort(this.option.viewData,b),d=document.createDocumentFragment(),f=0,g=c.length;f<g;f++)this._itemIndexSet(c[f],f),d.appendChild(c[f]);this.listPanel.empty(),this.listPanel[0].appendChild(d)}},setViewData:function(a){Array.isArray(a)&&this._fill(a)},getViewData:function(){return Array.isArray(this.option.viewData)?this.option.viewData:[]},count:function(){return this.option.viewData.length},isMultiple:function(){return!0===this.option.multiple},clear:function(){this.option.viewData=[],this.listPanel.empty(),this._current=null,this._selectList=[]}}),b.fn.listView=function(b){return 0===this.length?null:a.ctrls.ListView(b,this)}}(ui,ui.$),function(a,b){function c(a,c,d){this.view=a,this.parent=c,this.panel=b("<div class='ui-report-fixed' />"),d&&this.panel.css(d),this.head=b("<div class='ui-grid-head ui-report-fixed-head' />"),this.head.css("height",this.view.headHeight+"px"),this.body=b("<div class='ui-grid-body ui-report-fixed-body' />"),this.body.css("height",this.view.bodyHeight+"px"),this.width=0,this.height=0,this.offsetCellIndex=0,this.panel.append(this.head).append(this.body),this.parent.append(this.panel)}function d(a){this.view=a,this.left=null,this.right=null}function e(a,b){var c,d,e;c=this.getViewData(),0!==c.length&&(d=parseInt(b.attr("data-columnIndex"),10)||b[0].cellIndex,e=this._getColumn(d),this.sorter.sort(c,b,e))}function f(a){var b=this.reportDataBody[0],c=this.reportDataHead[0],d=b.scrollTop,e=b.scrollLeft;c.scrollLeft=e,this.fixed.syncScroll(d,e,b.scrollWidth)}var g="border-highlight",h=a.ColumnStyle.cnfn.columnText,i=(a.ColumnStyle.cfn.text,a.ColumnStyle);c.prototype={constructor:c,setHead:function(a){var c=0;this.columns=[],this.headTable=b("<table class='ui-table-head' cellspacing='0' cellpadding='0' style='left:0' />"),this.view._createHeadTable(this.headTable,this.columns,a,!0,function(a,b,d,e){a.len||(a.len=40),c+=a.len}),this.width=c,this.head.html("").append(this.headTable),this.head.css("width",this.width+"px")},setBody:function(a){this.bodyTable=b("<table class='ui-table-body' cellspacing='0' cellpadding='0' style='left:0' />"),this.view._createBodyTable(this.bodyTable,a,this.columns),this.body.scrollTop(0),this.body.html("").append(this.bodyTable),this.body.css("width",this.width+"px"),this.panel.removeClass("ui-report-fixed-empty")},clear:function(){this.bodyTable&&(this.bodyTable.remove(),delete this.bodyTable),this.panel.removeClass(g).addClass("ui-report-fixed-empty")},destroy:function(){this.panel.remove()},findColumnInfo:function(a,b){var c,d;for(c=0,d=this.columns.length;c<d;c++)if(this.columns[c][b]===a)return{columnIndex:c,columns:this.columns,headTable:this.headTable,bodyTable:this.bodyTable}},getElement:function(c,d){var e=b(this.bodyTable[0].tBodies[0].rows[c]);return a.core.isNumber(d)&&(d-=this.offsetCellIndex,e=d<0||d>=e[0].cells.length?null:b(e[0].cells[d])),e},updateRow:function(a,c){var d=b(this.bodyTable[0].rows[a]);0!==d.length&&(d.empty(),this.view._createRowCells(d,c,a,this.columns))},appendRow:function(a){var c=b("<tr />"),d=this.view.count();this.view._createRowCells(c,a,d,this.columns),b(this.bodyTable[0].tBodies[0]).append(c)},insertRow:function(a,c){var d=b("<tr />");this.view._createRowCells(d,c,a,this.columns),b(this.bodyTable[0].rows[a]).before(d)},moveRow:function(a,c){var d=this.bodyTable[0].tBodies[0].rows,e=b(d[a]),f=b(d[c]);c>a?f.after(e):f.before(e)}},d.prototype={constructor:d,clear:function(){this.left&&this.left.clear(),this.right&&this.right.clear()},setBodyHeight:function(a){this.left&&this.left.body.css("height",a+"px"),this.right&&this.right.body.css("height",a+"px")},reset:function(){this.left&&(this.left.destroy(),this.left=null),this.right&&(this.right.destroy(),this.right=null)},findColumnInfo:function(a,b){var c;return this.left&&null!=(c=this.left.findColumnInfo(a,b))?c:(this.right&&(c=this.right.findColumnInfo(a,b)),c)},syncScroll:function(a,b,c){this.left&&(this.left.body.scrollTop(a),b>0?this.left.panel.addClass(g):this.left.panel.removeClass(g)),this.right&&(this.right.body.scrollTop(a),Math.ceil(this.view.innerWidth+b)<c?this.right.panel.addClass(g):this.right.panel.removeClass(g))},syncSelectedState:function(a,b,c){var d,e,f,g;this.left&&this.right&&("row"===this.view.option.selection.type?d=a[0].rowIndex:(e=a[0].cellIndex,d=a.parent()[0].rowIndex),f=function(a,b){var c;a&&(c=a.getElement(d,e))&&b(c)},c?(g=function(a){a.addClass(b).addClass("background-highlight")},f(this.left,g),f(this.right,g)):(g=function(a){a.removeClass(b).removeClass("background-highlight")},f(this.left,g),f(this.right,g)))},sortSync:function(a){var b,c,d,e,f,g,h,i;if(this.left||this.right)for(this.left&&(f=this.left.bodyTable.children("tbody"),b=f[0].rows,d=new Array(b.length)),this.right&&(g=this.right.bodyTable.children("tbody"),c=g[0].rows,e=new Array(c.length)),h=0,i=a.length;h<i;h++)d&&(d[a[h].rowIndex]=b[h]),e&&(e[a[h].rowIndex]=c[h])}},a.ctrls.define("ui.ctrls.ReportView",a.ctrls.GridView,{_defineOption:function(){var a=this._super();return a.adjustable=!0,a},_create:function(){var c=this;this._super(),this._headScrollColumn={addScrollCol:function(a,c,d){var e,f,g;this.scrollCol=d._createCol({len:0}),c.append(this.scrollCol),e=a.parent().children(),f=e.length,g=b("<th class='ui-table-head-cell scroll-cell' />"),f>1&&g.attr("rowspan",f),b(e[0]).append(g)},addFixedScrollColumn:function(d){this.scrollBlock=b("<div class='ui-report-fixed-block' />"),this.scrollBlock.css({width:a.scrollbarWidth+"px",height:c.headHeight-2+"px"}),d.append(this.scrollBlock)},show:function(){this.scrollCol&&this.scrollCol.css("width",a.scrollbarWidth+.1+"px"),this.scrollBlock&&(this.scrollBlock.css("display","block"),c.fixed.right.panel.css("right",a.scrollbarWidth+1+"px"))},hide:function(){this.scrollCol&&this.scrollCol.css("width",0),this.scrollBlock&&(this.scrollBlock.css("display","none"),c.fixed.right.panel.css("right",0))}},this.fixed=new d(this),this.sorter.sortAfterFn=function(a){this.fixed.sortSync(a)}.bind(this),this.clickHandlers.add("sort-column",e.bind(this)),this.onScrollingHandler=f.bind(this)},_render:function(){this._super(),this.element.addClass("ui-report-view"),this.head.addClass("ui-report-head"),this.body.addClass("ui-report-body"),this._initAdjustColumn()},_initAdjustColumn:function(){this.option.adjustable&&(this._adjustLine=b("<hr class='adjust-line background-highlight' />"),this.element.append(this._adjustLine),this.dragger=a.MouseDragger({context:this,target:this._adjustLine,handle:this.head,onBeginDrag:function(a){var c,d,e,f,g,h;if(c=b(a.target),!c.isNodeName("b"))return!1;e=this.option,d=e.context,f=c.offset(),g=d.element.offset(),h=f.left-g.left+c.width(),e.th=c.parent(),e.beginLeft=h,e.endLeft=h,e.leftLimit=0,e.rightLimit=d.element.width(),e.target.css({left:h+"px",display:"block"})},onMoving:function(a){var b,c;b=this.option,b.context,c=parseFloat(b.target.css("left")),c+=a.x,c<b.leftLimit?c=b.leftLimit:c>b.rightLimit&&(c=b.rightLimit),b.endLeft=c,b.target.css("left",c+"px")},onEndDrag:function(a){var c,d,e,f,g,h;c=this.option,d=c.context,c.target.css("display","none"),e=parseInt(c.th.attr("data-columnIndex"),10),(f=d._getColumn(e))&&c.endLeft!==c.beginLeft&&(g=f.len+(c.endLeft-c.beginLeft),g<30&&(g=30),f.len=g,h=function(a){var c;a&&(c=a.children("colgroup").children()[e])&&(c=b(c),c.css("width",f.len+"px"))},h(d.headTable),h(d.bodyTable),d._updateScrollState())}}),this.dragger.on())},_createFixedHead:function(a){var b,d,e,f,g,h,j,k=[],l=[];for(b=0,d=a.length;b<d;b++){for(g=a[b],f=g.length,h=[],e=0;;){if(e>=f||!g[e].fixed)break;h.push(g[e]),e++}if(h.length>0&&(k.push(h),h.length<f)){for(j=[],e=f;e>=0&&!(--e<0);)if(!i.isEmpty(g[e])){if(!g[e].fixed)break;j.push(g[e])}j.length>0&&l.push(j)}}this._noBodyHover=!1,k.length>0&&(this._noBodyHover=!0,this.fixed.left||(this.fixed.left=new c(this,this.element,{"border-right-width":"1px","border-right-style":"solid",left:0})),this.fixed.left.setHead(k)),l.length>0&&(this._noBodyHover=!0,this.fixed.right||(this.fixed.right=new c(this,this.element,{"border-left-width":"1px","border-left-style":"solid",right:0}),this.fixed.right.offsetCellIndex=e+1,this._headScrollColumn.addFixedScrollColumn(this.head)),this.fixed.right.setHead(l))},_createDataHead:function(a,c){this.reportDataHead?this.reportDataHead.html(""):(this.reportDataHead=b("<div class='data-head'>"),this.head.append(this.reportDataHead)),this.headTable=b("<table class='ui-table-head' cellspacing='0' cellpadding='0' />"),this._createHeadTable(this.headTable,a,c,!1,null,function(a,b,c){this._headScrollColumn.addScrollCol(b,c,this)}),this.reportDataHead.append(this.headTable)},_createFixedBody:function(a){0!==a.length&&(this.fixed.left&&this.fixed.left.setBody(a),this.fixed.right&&this.fixed.right.setBody(a))},_createDataBody:function(c,d,e){var f=!1;this.reportDataBody?(this.reportDataBody.html(""),f=!0):(this.reportDataBody=b("<div class='data-body' />"),this.reportDataBody.on("scroll",this.onScrollingHandler),this.body.append(this.reportDataBody)),this.bodyTable=b("<table class='ui-table-body' cellspacing='0' cellpadding='0' />"),0===c.length?this.prompt.show():(this.prompt.hide(),this._createBodyTable(this.bodyTable,c,d,function(a,b){return b.fixed?null:a}),this.reportDataBody.append(this.bodyTable),this._updateScrollState(),a.setTask(function(){var a=this.reportDataBody[0],b=a.scrollLeft,c=a.scrollWidth;this.fixed.syncScroll(0,b,c)}.bind(this))),a.core.isNumber(e)&&this._renderPageList(e),f&&this.fire("rebind")},_createHeadTable:function(c,d,e,f,g,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w;if(j=a.core.isFunction(g),l=b("<thead />"),Array.isArray(e))for(u=e.length,q=0;q<u;q++){for(t=e[q],m=b("<tr />"),s=t.length,t&&0!==s||m.addClass("empty-row"),w=0,r=0;r<s;r++){if(o=t[r],o.rowspan>u&&(o.rowspan=u),n=this._createCell("th",o),n.addClass("ui-table-head-cell"),r===s-1&&n.addClass("last-cell"),o.rowspan+q===u||q===u-1){for(o._columnKeys||(o._columnKeys={});d[w];)w++;o.hasOwnProperty("columnIndex")?n.attr("data-columnIndex",o.columnIndex):(n.attr("data-columnIndex",w),o.columnIndex=w),o.cell=n,d[w]=o}o.fixed&&!f||(a.core.isFunction(o.text)?p=o.text.call(this,o,n):o.text&&(p=h.call(this,o,n)),p&&n.append(p),this.sorter.setSortColumn(n,o,r),this.option.adjustable&&!f&&n.append("<b class='adjust-column-handle'></b>")),m.append(n),w+=o.colspan||1}l.append(m)}for(k=b("<colgroup />"),q=0,s=d.length;q<s;q++)o=d[q],k.append(this._createCol(o)),v=[o,o.cell],delete o.cell,j&&(v.push(q),v.push(s),g.apply(this,v));a.core.isFunction(i)&&i.call(this,c,m,k),c.append(k),c.append(l)},_createBodyTable:function(c,d,e,f,g){var h,i,j,k,l,m,n,o,p;for(o=e.length,p=a.core.isFunction(g),h=b("<colgroup />"),n=0;n<o;n++)l=e[n],h.append(this._createCol(l));for(i=b("<tbody />"),m=0;m<d.length;m++)k=b("<tr />"),j=d[m],this._createRowCells(k,j,m,e,f),p&&!1===g.call(this,k,j)||i.append(k);c.append(h),c.append(i)},_createCell:function(b,c){var d=this._super(b,c);return a.core.isNumber(c.colspan)&&d.prop("colspan",c.colspan),a.core.isNumber(c.rowspan)&&(d.prop("rowspan",c.rowspan),c.rowspan>1&&d.css("height",c.rowspan*this.rowHeight-1)),d},_getColumn:function(a){return this.dataColumns[a]},_updateScrollState:function(){var b,c,d,e;this.reportDataBody&&this.headTable&&(b=this.reportDataBody.width(),c=this.reportDataBody.height(),d=this.reportDataBody[0].scrollWidth,e=this.reportDataBody[0].scrollHeight,e-c>1?this._headScrollColumn.show():this._headScrollColumn.hide(),d>b?this.fixed.setBodyHeight(this.bodyHeight-a.scrollbarWidth):this.fixed.setBodyHeight(this.bodyHeight))},_getColumnIndexByFormatter:function(a,b){var c,d,e;if(b||(b="formatter"),e=this.fixed.findColumnInfo(a,b))return e;if(this.dataColumns)for(c=0,d=this.dataColumns.length;c<d;c++)if(this.dataColumns[c][b]===a)return{columnIndex:c,columns:this.dataColumns,headTable:this.headTable,bodyTable:this.bodyTable};return{columnIndex:-1}},_addSelectedState:function(a,b,c){this.fixed.syncSelectedState(a,b,!0),this._super(a,b,c)},_removeSelectedState:function(a,b,c){this.fixed.syncSelectedState(a,b,!1),this._super(a,b,c)},_selectItem:function(a,c,d){for(var e,f,g=a;;){if(g.isNodeName("div"))break;g=g.parent()}g.hasClass("ui-report-fixed-body")&&("row"===this.option.selection.type?(e=a[0].rowIndex,a=b(this.bodyTable[0].tBodies[0].rows[e])):(e=a.parent()[0].rowIndex,f=a[0].cellIndex,g[0]===this.fixed.left.body[0]?f+=this.fixed.left.offsetCellIndex:g[0]===this.fixed.right.body[0]&&(f+=this.fixed.right.offsetCellIndex),a=b(this.bodyTable[0].tBodies[0].rows[e].cells[f]))),this._super(a,c,d)},createHead:function(a){Array.isArray(a)&&(this.dataColumns=[],Array.isArray(a[0])||(a=[a]),this.headHeight=this.rowHeight*a.length,this.fixed.reset(),this.sorter.prepareHead(),this._createDataHead(this.dataColumns,a),this._createFixedHead(a),this.dataColumns.forEach(function(a){delete a.rowspan,delete a.colspan}),this.head.css("height",this.headHeight+"px"))},createBody:function(a,b){Array.isArray(a)||(a=[]),this.clear(),0!==a.length&&(this.option.viewData=a,this.dataColumns&&Array.isArray(this.dataColumns)&&this._createDataBody(a,this.dataColumns,b),this._createFixedBody(a))},removeRowAt:function(){var c,d,e,f;if(viewData=this.getViewData(),0!==viewData.length&&0!==(f=arguments.length)){for(d=[],e=0;e<f;e++)c=arguments[e],a.core.isNumber(c)&&c>=0&&c<viewData.length&&d.push(c);if(0!==(f=d.length)){for(d.sort(function(a,b){return b-a}),e=0;e<f;e++)c=d[e],this.fixed.left&&b(this.fixed.left.bodyTable[0].rows[c]).remove(),this.fixed.right&&b(this.fixed.right.bodyTable[0].rows[c]).remove();this._super.apply(this,d)}}},updateRow:function(a,b){var c,d;c=this.getViewData(),0!==(d=c.length)&&(a<0||a>d||(this.fixed.left&&this.fixed.left.updateRow(a,b),this.fixed.right&&this.fixed.right.updateRow(a,b),this._super(a,b,this.dataColumns,function(a,b){return b.fixed?null:a})))},addRow:function(a){var b;if(a){if(b=this.getViewData(),0===b.length)return void this._super(a);this.fixed.left&&this.fixed.left.appendRow(a),this.fixed.right&&this.fixed.right.appendRow(a),this._super(a,this.dataColumns,function(a,b){return b.fixed?null:a})}},insertRow:function(a,b){var c,d;if(b){if(c=this.getViewData(),0===(d=c.length))return void this.addRow(b);a<0&&(a=0),a<d&&(this.fixed.left&&this.fixed.left.insertRow(a,b),this.fixed.right&&this.fixed.right.insertRow(a,b)),this._super(a,b,this.dataColumns,function(a,b){return b.fixed?null:a})}},moveRow:function(a,b){var c;c=this.getViewData(),0!==c.length&&(b<0?b=0:b>=c.length&&(b=c.length-1),a!==b&&(this.fixed.left&&this.fixed.left.moveRow(a,b),this.fixed.right&&this.fixed.right.moveRow(a,b),this._super(a,b)))},clear:function(){this._super(),this.bodyTable&&delete this.bodyTable,this.fixed.clear()}}),b.fn.reportView=function(b){if(0!==this.length)return a.ctrls.ReportView(b,this)}}(ui,ui.$),function(a,b){function c(a){if(!(this instanceof c))return new c(a);this.initialize(a)}function d(a){if(!(this instanceof d))return new d(a);this.initialize(a)}function e(a,b,c){if(!(this instanceof e))return new e(a,b,c);this.initialize(a,b,c)}c.prototype={constructor:c,initialize:function(b){var c;this.tabView=b,this.animationCssItem=b.isHorizontal?"left":"top",c=this,this.animator=a.animator({ease:a.AnimationStyle.easeFromTo,onChange:function(a){this.target.css(c.animationCssItem,a+"px")}}).add({ease:a.AnimationStyle.easeFromTo,onChange:function(a){this.target.css(c.animationCssItem,a+"px")}}),this.animator.onEnd=function(){c.currentIndex=c.nextIndex,b._current.css("display","none"),b._current=c.nextView,c.nextIndex=null,c.nextView=null,b.fire("changed",c.currentIndex)},a.core.isNumber(b.option.duration)?this.animator.duration=b.option.duration:this.animator.duration=500,this._initBodies()},_initBodies:function(){var a,c,d;for(a=this.tabView,a._current=b(a.bodies[0]),c=1,d=a.bodies.length;c<d;c++)b(a.bodies[c]).css("display","none")},_setCurrent:function(a,b,c){var d,e,f,g;if(d=this.tabView,f=0,this.animator.isStarted&&(this.animator.stop(),f=parseFloat(d._current.css(this.animationCssItem)),e=this.animator[1],e.target&&e.target.css("display","none")),this.currentIndex===b)return d._current.css(this.animationCssItem,0),this.nextIndex=null,void(this.nextView=null);if(!1!==d.fire("changing",b)){if(!1===c)return this.bodySet(b),void d.fire("changed",b);g=d.isHorizontal?d.bodyWidth:d.bodyHeight,0===f&&(this.animator.isNext=b>this.currentIndex),this.nextIndex=b,this.nextView=a,this.animator.isNext?this.nextView.css(this.animationCssItem,g+f+"px"):this.nextView.css(this.animationCssItem,-g+f+"px"),e=this.animator[0],e.target=d._current,e.begin=f,this.animator.isNext?e.end=-g:e.end=g,e=this.animator[1],e.target=this.nextView,e.begin=parseFloat(e.target.css(this.animationCssItem)),e.end=0,e.target.css("display","block"),this.animator.start()}},bodySet:function(a){var c,d;d=this.tabView,c=d.bodies,d._current&&d._current.removeClass("ui-tab-selection").css("display","none"),this.currentIndex=a,d._current=b(c[a]),d._current.css({display:"block",top:"0",left:"0"})},showIndex:function(a,c){var d,e;d=this.tabView,e=d.bodies,a>=0&&a<e.length&&this._setCurrent(b(e[a]),a,c)},putBodies:function(a,b){},restore:function(a){}},d.prototype={constructor:d,initialize:function(b){var c;this.tabView=b,this.animator=a.animator({target:b.bodyPanel,ease:a.AnimationStyle.easeFromTo}),a.core.isNumber(b.option.duration)?this.animator.duration=b.option.duration:this.animator.duration=800,c=this,b.isHorizontal?(this.animator[0].onChange=function(a){b.bodyPanel[0].scrollLeft=a},this.bodyShow=function(a){return c.animator.stop(),c.animator[0].begin=b.bodyPanel[0].scrollLeft,c.animator[0].end=a*b.bodyWidth,c.animator.start()}):(this.animator[0].onChange=function(a){b.bodyPanel.scrollTop(a)},this.bodyShow=function(a){return c.animator.stop(),c.animator[0].begin=b.bodyPanel.scrollTop(),c.animator[0].end=a*b.bodyHeight,c.animator.start()}),this._initTabs(),this._initBodies()},_initTabs:function(){var a,c;c=this.tabView,c.tabPanel&&0!==c.tabPanel.length&&(c.tabs=c.tabPanel.find(".ui-tab-button"),c.tabs.addClass("font-highlight-hover"),a=this,c.tabPanel.on("click",function(d){for(var e=b(d.target);!e.hasClass("ui-tab-button");){if(e[0]===c.tabPanel[0])return;e=e.parent()}a._setCurrent(e)}))},_initBodies:function(){},_setCurrent:function(b,c,d){var e;e=this.tabView,e._current&&e._current[0]===b[0]||(a.core.isNumber(c)||(c=e.getViewIndex(b)),!1!==e.fire("changing",c)&&(e._current&&e.tabs&&e._current.removeClass("ui-tab-selection").removeClass("border-highlight").removeClass("font-highlight"),e._current=b,e._current.addClass("ui-tab-selection"),e.tabs&&e._current.addClass("border-highlight").addClass("font-highlight"),!1===d?(this.bodySet(c),e.fire("changed",c)):this.bodyShow(c).then(function(){e.fire("changed",c)})))},bodySet:function(a){var b=this.tabView;b.isHorizontal?b.bodyPanel[0].scrollLeft=b.bodyWidth*a:b.bodyPanel[0].scrollTop=b.bodyHeight*a},showIndex:function(a,c){var d,e;d=this.tabView,e=d.tabs||d.bodies,a>=0&&a<e.length&&this._setCurrent(b(e[a]),a,c)},putBodies:function(a,c){var d,e,f,g,h=0;if(d=this.tabView,d.isHorizontal)for(e=0,f=d.bodies.length;e<f;e++)g=b(d.bodies[e]),g.css("left",h+"px"),h+=a||0;else for(e=0,f=d.bodies.length;e<f;e++)g=b(d.bodies[e]),g.css("top",h+"px"),h+=c||0},restore:function(a){var b,c;c=this.tabView,c._current&&(b=c.getViewIndex(c._current),!1===a?this.bodySet(b):this.bodyShow(b))}},a.ctrls.define("ctrls.TabView",{_defineOption:function(){return{type:"tab",tabPanel:null,bodyPanel:null,bodies:null,direction:"horizontal",duration:800}},_defineEvents:function(){return["changing","changed"]},_create:function(){this.tabPanel=null,this.bodyPanel=null,this.option.tabPanel&&(this.tabPanel=a.getJQueryElement(this.option.tabPanel)),this.option.bodyPanel&&(this.bodyPanel=a.getJQueryElement(this.option.bodyPanel)),this.bodies=this.option.bodies,this.bodies?this.bodyPanel||(this.bodyPanel=this.bodies.parent()):this.bodies=this.bodyPanel.children(".ui-tab-body"),this.isHorizontal="vertical"!==this.option.direction},_render:function(){"view"===this.option.type?this.model=c(this):this.model=d(this)},getCurrentIndex:function(){return this.getViewIndex(this._current)},getViewIndex:function(a){var b,c,d;if(d=this.tabs||this.bodies,a=a||this._current,d&&a)for(b=0,c=d.length;b<c;b++)if(d[b]===a[0])return b;return 0},showIndex:function(b,c){a.core.isNumber(b)||(b=0),!1!==c&&(c=!0),this.model.showIndex(b,c)},putBodies:function(b,c){a.core.isNumber(b)||(b=this.bodyPanel.width()),a.core.isNumber(c)||(c=this.bodyPanel.height()),this.bodyWidth=b,this.bodyHeight=c,this.model.putBodies(b,c)},restore:function(a){this.model.restore(a)}}),e.prototype={constructor:e,initialize:function(b,c,d){this.tabView=b,this.tabTools=[],this.tabLoadStates=[],a.core.isFunction(d)||(d=c,c=null),a.core.isFunction(c)||(c=function(a,b){this.showTools(b)}),this.tabView&&(this.tabView.changing(c.bind(this)),a.core.isFunction(d)&&this.tabView.changed(d.bind(this)))},addTools:function(){var c,d,e,f,g;for(c=0,d=arguments.length;c<d;c++){if(f=arguments[c],a.core.isString(f))e=b("#"+f),0===e.length&&(e=void 0);else if(Array.isArray(f)){for(e=[],g=0;g<f.length;g++)e.push(b("#"+f[g])),0===e[e.length-1].length&&e.pop();1===e.length&&(e=e[0])}this.tabTools.push(e)}},showTools:function(a){var b,c,d,e,f;for(b=0,c=this.tabTools.length;b<c;b++)if(e=this.tabTools[b])if(f=b===a?"block":"none",Array.isArray(e))for(d=0;d<e.length;d++)e[d].css("display",f);else e.css("display",f)},callWithCache:function(b,c,d){var e,f,g;if(a.core.isFunction(c)){for(e=[],g=arguments.length,f=3;f<g;f++)e.push(arguments[f]);this.tabLoadStates[b]||(c.apply(d,e),this.tabLoadStates[b]=!0)}},resetAt:function(a){a<0||a>=this.tabLoadStates.length||(this.tabLoadStates[a]=!1)},reset:function(){var a,b;for(a=0,b=this.tabLoadStates.length;a<b;a++)this.tabLoadStates[a]=!1}},a.ctrls.TabView.TabManager=e}(ui,ui.$),function(a,b){a.ctrls.define("ui.ctrls.TreeView",a.ctrls.SelectionTree,{_render:function(){var a;this.treePanel=this.element,a=this.treePanel.css("position"),this.treePanel.addClass("ui-selection-tree-panel").addClass("ui-tree-view-panel").css("position",a),this.treePanel.on("click",this.onTreeItemClickHandler),Array.isArray(this.option.viewData)&&this._fill(this.option.viewData)}}),b.fn.treeView=function(b){if(0!==this.length)return a.ctrls.TreeView(b,this)}}(ui,ui.$),function(a,b){function c(){}function d(b){var c=this.option.checkHandler,d=this;this.disabled||(clearTimeout(this.backTimeHandler),a.core.isFunction(c)&&!1===c.call(this)||(0===this.state?(this._next(),this.backTimeHandler=setTimeout(function(){d._back()},this.option.backTime)):1===this.state&&(this._next(),this.option.handler.call(this))))}a.ctrls.define("ui.ctrls.ConfirmButton",{_defineOption:function(){return{disabled:!1,backTime:3e3,checkHandler:!1,handler:!1,color:"#fff",backgroundColor:"#990000"}},_create:function(){this.state=0,("number"!==a.core.type(this.option.backTime)||this.option.backTime<=0)&&(this.option.backTime=5e3),a.core.isFunction(this.option.handler)||(this.option.handler=c),this.option.disabled=!!this.option.disabled,this.onButtonClickHandler=d.bind(this),this.defineProperty("disabled",this.getDisabled,this.setDisabled),this.defineProperty("text",this.getText,this.setText)},_render:function(){var a,c,d;a=this.element.text().trim(),c=b("<span class='text-state' />"),d=b("<i class='confirm-state' />"),c.text(a),d.text("确定"),this.option.backgroundColor&&d.css("background-color",this.option.backgroundColor),this.option.color&&d.css("color",this.option.color),this.element.addClass("confirm-button"),this.element.css("width",this.element.width()+"px"),this.element.empty().append(c).append(d),this.element.on("click",this.onButtonClickHandler),this._initAnimation(c,d),this.disabled=this.option.disabled},_initAnimation:function(b,c){this.changeAnimator=a.animator({target:b,ease:a.AnimationStyle.easeFromTo,onChange:function(a){
this.target.css("margin-left",a+"%")}}).add({target:c,ease:a.AnimationStyle.easeFromTo,onChange:function(a){this.target.css("left",a+"%")}}),this.changeAnimator.duration=200},_back:function(){var a;this.changeAnimator.isStarted||(this.state=0,a=this.changeAnimator[0],a.target.css("margin-left","-200%"),a.begin=-200,a.end=0,a=this.changeAnimator[1],a.target.css("left","0%"),a.begin=0,a.end=100,this.changeAnimator.start())},_next:function(a){var b;this.changeAnimator.isStarted||(0===this.state?(b=this.changeAnimator[0],b.target.css("margin-left","0%"),b.begin=0,b.end=-200,b=this.changeAnimator[1],b.target.css("left","100%"),b.begin=100,b.end=0,this.state=1):(b=this.changeAnimator[0],b.target.css("margin-left","100%"),b.begin=100,b.end=0,b=this.changeAnimator[1],b.target.css("left","0%"),b.begin=0,b.end=-100,this.state=0),this.changeAnimator.start())},getDisabled:function(){return this.option.disabled},setDisabled:function(a){this.option.disabled=!!a,this.option.disabled?this.element.attr("disabled","disabled"):this.element.removeAttr("disabled")},getText:function(){return this.element.children(".text-state").text()},setText:function(b){this.element.children(".text-state").text(a.str.trim(b+""))}}),b.fn.confirmClick=function(b){return this&&0!==this.length?(a.core.isFunction(b)&&(b=a.core.isFunction(arguments[1])?{checkHandler:b,handler:arguments[1]}:{handler:b}),a.ctrls.ConfirmButton(b,this)):null}}(ui,ui.$),function(a,b){a.ctrls.define("ui.ctrls.ExtendButton",{_defineOption:function(){return{buttonSize:32,centerIcon:"close",centerSize:null,buttons:[],parent:null}},_defineEvents:function(){return["showing","shown","hiding","hidden"]},_create:function(){this.parent=a.getJQueryElement(this.option.parent),this.parent?this.isBodyInside=!1:(this.parent=b(document.body),this.isBodyInside=!0),this.buttonPanelBGBorderWidth=0,"number"!==a.core.type(this.option.buttonSize)&&(this.option.buttonSize=32),this.centerSize=this.option.centerSize,"number"!==a.core.type(this.centerSize)&&(this.centerSize=this.option.buttonSize),"array"!==a.core.type(this.option.buttons)&&(this.option.buttons=[]),this.buttonPanel=b("<div class='extend-button-panel' />"),this.buttonPanelBackground=b("<div class='extend-button-background border-highlight' />"),this.hasCloseButton=!1,"close"===this.option.centerIcon?(this.hasCloseButton=!0,this.centerIcon=b("<a class='center-icon closable-button font-highlight' style='font-size:24px !important;' title='关闭'>×</a>")):"none"===this.option.centerIcon?(this.centerIcon=b("<a class='center-icon center-none border-highlight' />"),this.backgroundColorPanel=b("<div class='background-panel' />"),this.buttonPanelBackground.append(this.backgroundColorPanel),this.buttonPanelBackground.append(this.centerIcon),this.buttonPanelBackground.css("background-color","transparent")):(this.centerIcon=b("<a class='center-icon' />"),a.str.isEmpty(this.option.centerIcon)||this.centerIcon.append(this.option.centerIcon)),this._createAnimator()},_render:function(){var c,d=0,e=this;for(this._caculateSize(),this.buttonPanel.append(this.buttonPanelBackground),"none"===this.option.centerIcon?(this.backgroundColorPanel.css({width:this.centerSize+"px",height:this.centerSize+"px"}),this.buttonPanelAnimator[2].onChange=function(a){var b=(e.buttonPanelSize-e.centerSize)/2;b=a>e.centerSize?Math.ceil(b*(a/e.buttonPanelSize)):0,this.target.css({width:a+"px",height:a+"px"}),e.backgroundColorPanel.css("border-width",b+"px")},this.centerIcon.css({width:this.centerSize+"px",height:this.centerSize+"px","margin-left":-(this.centerSize/2+1)+"px","margin-top":-(this.centerSize/2+1)+"px"})):(this.centerIcon.css({width:this.centerSize+"px",height:this.centerSize+"px","line-height":this.centerSize-2+"px",top:this.centerTop-this.centerSize/2+"px",left:this.centerLeft-this.centerSize/2+"px"}),this.buttonPanel.append(this.centerIcon)),c=this.option.buttons.length;d<c;d++)this._createButton(this.option.buttons[d],this.deg*d);b.isFunction(this.element.addClass)&&this.element.addClass("extend-element"),this.parent.append(this.buttonPanel),this.buttonPanelBGBorderWidth=parseFloat(this.buttonPanelBackground.css("border-top-width"))||0,this.element.on("click",function(a){a.stopPropagation(),e.show()}),this.hasCloseButton?this.centerIcon.on("click",function(a){e.hide()}):a.page.htmlclick(function(a){e.hide()}),this.buttonPanel.on("click",function(a){a.stopPropagation()})},_createAnimator:function(){this.buttonPanelAnimator=a.animator({target:this.buttonPanelBackground,onChange:function(a){this.target.css("top",a+"px")}}).add({target:this.buttonPanelBackground,onChange:function(a){this.target.css("left",a+"px")}}).add({target:this.buttonPanelBackground,onChange:function(a){this.target.css({width:a+"px",height:a+"px"})}}).add({target:this.buttonPanelBackground,onChange:function(a){this.target.css("opacity",a/100)}}),this.buttonPanelAnimator.duration=240,this.buttonAnimator=a.animator(),this.buttonAnimator.duration=240},_getElementCenter:function(){var a=this.isBodyInside?this.element.offset():this.element.position(),b=this.element.getBoundingClientRect();return a.left=a.left+b.width/2,a.top=a.top+b.height/2,a},_setButtonPanelAnimationOpenValue:function(b){var c,d;c=b[0],d=c.target,c.begin=this.centerTop-this.centerSize/2,c.end=0-this.buttonPanelBGBorderWidth,c.ease=a.AnimationStyle.easeTo,c=b[1],c.begin=this.centerLeft-this.centerSize/2,c.end=0-this.buttonPanelBGBorderWidth,c.ease=a.AnimationStyle.easeTo,c=b[2],c.begin=this.centerSize,c.end=this.buttonPanelSize,c.ease=a.AnimationStyle.easeTo,c=b[3],c.begin=0,c.end=100,c.ease=a.AnimationStyle.easeFrom,d.css({left:this.centerLeft-this.buttonSize/2+"px",top:this.centerTop-this.buttonSize/2+"px",width:this.buttonSize+"px",height:this.buttonSize+"px"})},_setButtonPanelAnimationCloseValue:function(b){for(var c,d,e=0,f=b.length;e<f;e++)c=b[e],d=c.begin,c.begin=c.end,c.end=d,c.ease=a.AnimationStyle.easeFrom},_setButtonAnimationOpenValue:function(b){for(var c,d,e=0,f=b.length;e<f;e++)d=this.option.buttons[e],c=b[e],c.begin=0,c.end=100,c.ease=a.AnimationStyle.easeTo,c.target.css({top:d.startTop+"px",left:d.startLeft+"px"})},_setButtonAnimationCloseValue:function(b){for(var c,d=0,e=b.length;d<e;d++)this.option.buttons[d],c=b[d],c.begin=100,c.end=0,c.ease=a.AnimationStyle.easeFrom},_caculateSize:function(){var a=this.option.buttons.length;this.deg=360/a;var b=this.deg/180*Math.PI,c=this.option.buttonSize,d=c/2/Math.tan(b/2);d<=c/2&&(d=c/2+4),this.centerRadius=d+c/2,this.insideRadius=d+c,this.outsideRadius=Math.sqrt(this.insideRadius*this.insideRadius+c/2*(c/2)),this.outsideRadius+=20,this.buttonSize=c,this.buttonPanelSize=Math.ceil(2*this.outsideRadius),this.centerTop=this.centerLeft=this.buttonPanelSize/2},_setButtonPanelLocation:function(){var a=this._getElementCenter(),b=Math.floor(a.top-this.buttonPanelSize/2),c=Math.floor(a.left-this.buttonPanelSize/2);this.buttonPanel.css({top:b+"px",left:c+"px",width:this.buttonPanelSize+"px",height:this.buttonPanelSize+"px"})},_caculatePositionByCenter:function(a,b){var c={left:0,top:0};return c.left=a-this.buttonSize/2,c.top=b-this.buttonSize/2,c},_createButton:function(c,d){var e,f,g,h,i=this;c.elem=b("<a href='javascript:void(0)' class='extend-button background-highlight' />"),c.icon&&c.elem.append(c.icon),a.str.isEmpty(c.title)&&c.elem.prop("title",c.title),c.centerStartLeft=0,c.centerStartTop=0,e=d/180*Math.PI,g=this.centerRadius*Math.sin(e)+c.centerStartLeft,h=this.centerRadius*Math.cos(e)+c.centerStartTop,c.centerLeft=Math.floor(this.centerLeft+g),c.centerTop=Math.floor(this.centerTop-h),f=this._caculatePositionByCenter(this.centerLeft,this.centerTop),c.startLeft=f.left,c.startTop=f.top,c.elem.css({width:this.buttonSize+"px",height:this.buttonSize+"px","line-height":this.buttonSize-2+"px"}),this.buttonPanel.append(c.elem),this.buttonAnimator.add({target:c.elem,button:c,that:this,onChange:function(a){var b=(this.button.centerLeft-this.that.centerLeft)*a/100+this.that.centerLeft,c=(this.button.centerTop-this.that.centerTop)*a/100+this.that.centerTop,d=this.that._caculatePositionByCenter(b,c);this.target.css({left:d.left+"px",top:d.top+"px"})}}),a.core.isFunction(c.handler)&&c.elem.on("click",function(a){c.handler.call(i,c)})},isShow:function(){return"block"===this.buttonPanel.css("display")},show:function(a){var b=this;this.isShow()||!1!==this.fire("showing")&&(this._setButtonPanelLocation(),!1===a?this.buttonPanel.css("display","block"):(this.buttonPanel.css("display","block"),this._setButtonPanelAnimationOpenValue(this.buttonPanelAnimator),this._setButtonAnimationOpenValue(this.buttonAnimator),this.buttonPanelAnimator.start(),this.buttonAnimator.delayHandler=setTimeout(function(){b.buttonAnimator.delayHandler=null,b.buttonAnimator.start().then(function(){b.fire("shown")})},100)))},hide:function(a){var b=this;this.isShow()&&!1!==this.fire("hiding")&&(!1===a?this.buttonPanel.css("display","none"):(this._setButtonPanelAnimationCloseValue(this.buttonPanelAnimator),this._setButtonAnimationCloseValue(this.buttonAnimator),this.buttonAnimator.start(),this.buttonPanelAnimator.delayHandler=setTimeout(function(){b.buttonPanelAnimator.delayHandler=null,b.buttonPanelAnimator.start().then(function(){b.buttonPanel.css("display","none"),b.fire("hidden")})},100)))}}),b.fn.extendButton=function(b){return 0===this.length?null:a.ctrls.ExtendButton(b,this)}}(ui,ui.$),function(a,b){function c(a){for(var c,d=b(a.target);"LABEL"!==(c=d.nodeName());){if("DIV"===c)return;d=d.parent()}this._selectItem(d)}var d=0;a.ctrls.define("ui.ctrls.FilterButton",{_defineOption:function(){return{viewData:[],defaultIndex:0,filterCss:null}},_defineEvents:function(){return["selected","deselected"]},_create:function(){var e,f,g,h;for(this.filterPanel=b("<div class='filter-button-panel'>"),this.parent=this.element,this.radioName="filter_button_"+d++,this._current=null,this.onItemClickHandler=c.bind(this),h=this.getViewData(),e=0,f=h.length;e<f;e++)g=h[e],!0===g.selected&&(this.option.defaultIndex=e),this._createTool(g,e);this.option.filterCss&&this.filterPanel.css(this.option.filterCss),this.filterPanel.on("click",this.onItemClickHandler),this.parent.append(this.filterPanel),(!a.core.isNumber(this.option.defaultIndex)||this.option.defaultIndex>=f||this.option.defaultIndex<0)&&(this.option.defaultIndex=0),this.setIndex(this.option.defaultIndex)},_createTool:function(c,d){var e,f,g;a.core.isPlainObject(c)&&(e=b("<label class='filter-button-item' />"),f=b("<input type='radio' class='filter-button-item-radio' name='"+this.radioName+"'/>"),g=b("<span class='filter-button-item-text' />"),e.append(f).append(g),e.attr("data-index",d),0===d&&e.addClass("filter-button-item-first"),e.addClass("font-highlight").addClass("border-highlight"),f.prop("value",c.value||""),g.text(c.text||"tool"+d),this.filterPanel.append(e))},_getSelectionData:function(a){var b=parseInt(a.attr("data-index"),10);return{itemIndex:b,itemData:this.getViewData()[b]}},_selectItem:function(a){var b;if(this._current){if(a[0]===this._current[0])return;this._current.addClass("font-highlight").removeClass("background-highlight"),b=this._getSelectionData(this._current),this.fire("deselected",b)}this._current=a,a.find("input").prop("checked",!0),this._current.addClass("background-highlight").removeClass("font-highlight"),b=this._getSelectionData(this._current),this.fire("selected",b)},_getIndexByValue:function(a){var b,c,d;for(b=this.getViewData(),c=-1,d=b.length-1;d>=0;d--)if(b[d].value===a){c=d;break}return c},_setDisplayIndex:function(c,d){var e,f;e=this.getViewData(),0!==e.length&&(a.core.isNumber(c)||(c=0),c>=0&&c<e.length&&(f=b(this.filterPanel.children()[c]),d?f.addClass("filter-button-item-hide"):f.removeClass("filter-button-item-hide"),this._updateFirstClass()))},_updateFirstClass:function(){var a,c,d,e,f;for(a=this.filterPanel.children(),d=a.length;c<d;c++)e=b(a[c]),e.hasClass("filter-button-item-hide")||(f?e.removeClass("filter-button-item-first"):f=e);f&&f.addClass("filter-button-item-first")},getViewData:function(){return Array.isArray(this.option.viewData)?this.option.viewData:[]},getSelection:function(){return this._current?this._getSelectionData(this._current):null},setIndex:function(a){var c,d;c=this.getViewData(),0!==c.length&&(b.isNumeric(a)||(a=0),a>=0&&a<c.length&&(d=b(this.filterPanel.children()[a]),this._selectItem(d)))},setValue:function(a){var b=this._getIndexByValue(a);b>-1&&this.setIndex(b)},hideIndex:function(a){this._setDisplayIndex(a,!0)},hideValue:function(a){var b=this._getIndexByValue(a);b>-1&&this.hideIndex(b)},showIndex:function(a){this._setDisplayIndex(a,!1)},showValue:function(a){var b=this._getIndexByValue(a);b>-1&&this.showIndex(b)}}),b.fn.filterButton=function(b){return 0===this.length?null:a.ctrls.FilterButton(b,this)}}(ui,ui.$),function(a,b){function c(a){var b=a.clientX,c=a.clientY;if(!this.animator.isStarted){var d=this.target.offset(),e={top:Math.floor(d.top),left:Math.floor(d.left)};e.bottom=e.top+this.targetHeight,e.right=e.left+this.targetWidth,d=this.viewPanel.offset();var f={top:Math.floor(d.top),left:Math.floor(d.left)};f.bottom=f.top+this.height,f.right=f.left+this.width,console.log([f.left,f.right,e.left,e.right]);var g,h,i=-1,j=-1,k=e.top<f.top?e.top:f.top,l=e.bottom>f.bottom?e.bottom:f.bottom;if(e.left<f.left?(g=e.left,h=f.right):(g=f.left,h=e.right),b<g?i=g-b:b>h&&(i=b-h),c<k?j=k-c:c>l&&(j=c-l),-1===i&&-1===j&&(i=0,b>=e.left&&b<=e.right?(c<=e.top-this.buffer||c>=e.bottom+this.buffer)&&(j=this.buffer):b>=f.left&&b<=f.right&&(c<f.top?j=f.top-c:c>f.bottom&&(j=c-f.bottom)),-1===j))return void this.viewPanel.css("opacity",1);if(i>this.buffer||j>this.buffer)return void this.hide();var m=1-(i>j?i:j)/this.buffer;if(m<.2)return console.log("hide"),void this.hide();this.viewPanel.css("opacity",m)}}var d=1;a.ctrls.define("ui.ctrls.HoverView",{buffer:30,_defineOption:function(){return{width:160,height:160}},_defineEvents:function(){return["showing","shown","hiding","hidden"]},_create:function(){this.viewPanel=b("<div class='hover-view-panel border-highlight' />"),this.viewPanel.css({width:this.option.width+"px","max-height":this.option.height+"px"}),b(document.body).append(this.viewPanel),this.width=null,this.height=null,this.target=null,this.targetWidth=null,this.targetHeight=null,this.hasDocMousemoveEvent=!1,this.isShow=!1,(!a.core.isNumber(this.option.width)||this.option.width<=0)&&(this.option.width=160),(!a.core.isNumber(this.option.height)||this.option.height<=0)&&(this.option.height=160),this.onDocumentMousemoveHander=c.bind(this),this.onDocumentMousemoveHander.guid="hoverView"+d++,this.animator=a.animator({target:this.viewPanel,ease:a.AnimationStyle.easeFrom,onChange:function(a){this.target.css("opacity",a/100)}}).add({target:this.viewPanel,ease:a.AnimationStyle.easeTo,onChange:function(a){this.target.css("left",a+"px")}}).add({target:this.viewPanel,ease:a.AnimationStyle.easeTo,onChange:function(a){this.target.css("top",a+"px")}}),this.animator.duration=300},clear:function(){return this.viewPanel.empty(),this},append:function(a){return this.viewPanel.append(a),this},addDocMousemove:function(){this.hasDocMousemoveEvent||(this.hasDocMousemoveEvent=!0,b(document).on("mousemove",this.onDocumentMousemoveHander))},removeDocMousemove:function(){this.hasDocMousemoveEvent&&(this.hasDocMousemoveEvent=!1,b(document).off("mousemove",this.onDocumentMousemoveHander))},setLocation:function(){a.setLeft(this.target,this.viewPanel)},getLocation:function(){return a.getLeftLocation(this.target,this.width,this.height)},show:function(a){var b,c,d,e=this;this.target=a,!1!==this.fire("showing")&&(this.animator.stop(),b=this.getLocation(),this.isShow?(c=this.animator[0],c.current<100?(c.begin=c.current,c.end=100):c.begin=c.end=100,c=this.animator[1],c.begin=parseFloat(this.viewPanel.css("left")),c.end=b.left,c=this.animator[2],c.begin=parseFloat(this.viewPanel.css("top")),c.end=b.top):(this.viewPanel.css({top:b.top+"px",left:b.left+"px"}),c=this.animator[0],c.begin=0,c.end=100,c=this.animator[1],c.begin=c.end=b.left,c=this.animator[2],c.begin=c.end=b.top),this.isShow=!0,this.viewPanel.css("display","block"),d=this.target.getBoundingClientRect(),this.targetWidth=d.width,this.targetHeight=d.height,d=this.target.getBoundingClientRect(),this.width=d.width,this.height=d.height,this.animator.start().then(function(){e.addDocMousemove(),e.fire("shown")}))},hide:function(){var a,b=this;!1!==this.fire("hiding")&&(this.removeDocMousemove(),this.animator.stop(),a=this.animator[0],a.begin=100*(parseFloat(this.viewPanel.css("opacity"))||1),a.end=0,a=this.animator[1],a.begin=a.end=0,a=this.animator[2],a.begin=a.end=0,this.animator.start().then(function(){b.isShow=!1,b.viewPanel.css("display","none"),b.fire("hidden")}))}}),a.createHoverView=function(b){return a.ctrls.HoverView(b)},b.fn.addHoverView=function(b){if(0===this.length)return null;var c=this;b instanceof a.ctrls.HoverView&&this.mouseover(function(a){b.show(c)})}}(ui,ui.$),function(a,b){function c(a){return document.createElementNS(l,a)}function d(a,b,c){2===arguments.length&&b?Object.keys(b).forEach(function(c){a.setAttribute(c,b[c])}):arguments.length>2&&a.setAttribute(b,c)}function e(a,b,c){2===arguments.length&&b?Object.keys(b).forEach(function(c){a.style[c]=b[c]}):arguments.length>2&&(a.style[b]=c)}function f(){return"<span class='ui-progress-indication' style='color:"+this.progressColor+"'>"+this.percent+"%</span>"}function g(a){var b=this;Object.keys(a).forEach(function(c){Object.defineProperty(b,c,{get:function(){return a[c]},set:function(b){a[c]=b,this.update(c)},enumerable:!0,configurable:!0})})}function h(a){var b;if(a.type=(a.type||"circle").toLowerCase(),"circle"===a.type)g.prototype=i,b=new g(a);else if("dashboard"===a.type)g.prototype=j,b=new g(a);else{if("bar"!==a.type)return null;g.prototype=k,b=new g(a)}return b}var i,j,k,l="http://www.w3.org/2000/svg";i={render:function(){var a,f,g,h,i;return a=b("<div class='ui-progress-container' />"),a.css({width:this.size+"px",height:this.size+"px"}),f=b("<svg viewBox='0 0 100 100'></svg>"),i=50-Math.max(this.trackWidth,this.progressWidth)/2,this.trackLength=2*Math.PI*i,h=["M 50,50 m 0,",-i," a ",i,",",i," 0 1 1 0,",2*i," a ",i,",",i," 0 1 1 0,",2*-i],h=h.join(""),g=c("path"),d(g,{d:h,"fill-opacity":0,stroke:this.trackColor,"stroke-width":this.trackWidth}),f.append(g),g=c("path"),d(g,{d:h,"fill-opacity":0,"stroke-linecap":"round",stroke:this.progressColor,"stroke-width":this.progressWidth}),e(g,{"stroke-dasharray":this.trackLength+"px,"+this.trackLength+"px","stroke-dashoffset":(100-this.percent)/100*this.trackLength+"px",transition:"stroke-dashoffset 0.6s ease 0s, stroke 0.6s ease"}),f.append(g),a.append(f),this.textElem=b("<div class='ui-progress-text' />"),this.updateText(),a.append(this.textElem),this.contianer=a,this.progressElem=g,a},update:function(a){"percent"===a?(e(this.progressElem,"stroke-dashoffset",(100-this.percent)/100*this.trackLength+"px"),this.updateText()):"progressColor"===a&&(d(this.progressElem,"stroke",this.progressColor),this.updateText())},updateText:function(){!1!==this.textTemplate&&(a.core.isFunction(this.textTemplate)?this.textElem.html(this.textTemplate()):this.textElem.html(f.call(this)))},show:function(){this.contianer.css("display","block")},hide:function(){this.contianer.css("display","none")}},j={render:function(){var a,f,g,h,i;return a=b("<div class='ui-progress-container' />"),a.css({width:this.size+"px",height:this.size+"px"}),f=b("<svg viewBox='0 0 100 100'></svg>"),i=50-Math.max(this.trackWidth,this.progressWidth)/2,this.trackLength=2*Math.PI*i,this.gap=75,h=["M 50,50 m 0,",i," a ",i,",",i," 0 1 1 0,",2*-i," a ",i,",",i," 0 1 1 0,",2*i],h=h.join(""),g=c("path"),d(g,{d:h,"fill-opacity":0,stroke:this.trackColor,"stroke-width":this.trackWidth}),e(g,{"stroke-dasharray":this.trackLength-this.gap+"px,"+this.trackLength+"px","stroke-dashoffset":-this.gap/2+"px",transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .3s ease 0s, stroke .3s"}),f.append(g),g=c("path"),d(g,{d:h,"fill-opacity":0,"stroke-linecap":"butt",stroke:this.progressColor,"stroke-width":this.progressWidth}),e(g,{"stroke-dasharray":this.percent/100*(this.trackLength-this.gap)+"px,"+this.trackLength+"px","stroke-dashoffset":-this.gap/2+"px",transition:"stroke-dashoffset .3s ease 0s, stroke-dasharray .6s ease 0s, stroke .6s, stroke-width .06s ease .6s"}),f.append(g),a.append(f),this.textElem=b("<div class='ui-progress-text' />"),this.updateText(),a.append(this.textElem),this.contianer=a,this.progressElem=g,a},update:function(a){"percent"===a?(e(this.progressElem,"stroke-dasharray",percent/100*(this.trackLength-this.gap)+"px,"+this.trackLength+"px"),this.updateText()):"progressColor"===a&&(d(this.progressElem,"stroke",this.progressColor),this.updateText())},updateText:i.updateText,show:i.show,hide:i.hide},k={render:function(){var a,c;return a=b("<div class='ui-progress-track' />"),a.css({width:this.size+"px",height:this.progressWidth+"px"}),c=b("<div class='ui-progress-bar background-highlight' />"),c.css("width",this.percent+"%"),a.append(c),this.progressElem=c,a},update:function(a){"percent"===a&&this.progressElem.css("width",this.percent+"%")},show:function(){this.progressElem.parent().css("display","block")},hide:function(){this.progressElem.parent().css("display","none")}},a.ctrls.define("ui.ctrls.Progress",{_defineOption:function(){return{type:"circle",size:100,percent:0,trackColor:"#f1f1f1",trackWidth:5,progressColor:"#ff0066",progressWidth:6,textTemplate:f}},_create:function(){if(a.core.isNumber(this.option.percent)||(this.option.percent=0),this.view=h(this.option),!this.view)throw new TypeError("the option.type: "+this.option.type+" is invalid.");this.defineProperty("percent",this.getPercent,this.setPercent)},_render:function(){this.element.addClass("ui-progress"),this.element.append(this.view.render())},getPercent:function(){return this.view.percent},setPercent:function(b){a.core.isNumber(b)&&(this.view.percent=b)},show:function(){this.view.show()},hide:function(){this.view.hide()}}),b.fn.progress=function(b){return 0===this.length?null:a.ctrls.Progress(b,this)}}(ui,ui.$),function(a,b){function c(a){var b,c=a.option;b=this.isHorizontal()?this.track.width():this.track.height(),c.lengthValue=b}function d(a){var b,c=a.option;b=this.thumb.width()/2,this.isHorizontal()?e.call(this,a.x,b,c.lengthValue):f.call(this,a.y,b,c.lengthValue)}function e(a,b,c){var d,e;e=parseFloat(this.thumb.css("left"))||0,e+=a,d=i.call(this,e+b,0,c),this.percent!==d&&(this.percent=d,this.valuebar.css("width",this.percent+"%"),this.thumb.css("left",c*(this.percent/100)-b+"px"),this.fire("changed",d))}function f(a,b,c){var d,e;e=parseFloat(this.thumb.css("top"))||0,e+=a,d=i.call(this,e+b,0,c),this.percent!==d&&(this.percent=100-d,this.valuebar.css({top:d+"%",height:this.percent+"%"}),this.thumb.css("top",c*(d/100)-b+"px"),this.fire("changed",d))}function g(a){var b,c,e;this.mouseDragger._isDragStart||(e={},b=this.track.offset(),this.isHorizontal()?(c=this.track.width(),e.x=a.pageX-b.left,e.x-=parseFloat(this.thumb.css("left"))||0):(c=this.track.height(),e.y=a.pageY-b.top,e.y-=parseFloat(this.thumb.css("top"))||0),e.option={lengthValue:c},d.call(this,e))}function h(a){var b,c,e,f;a.stopPropagation(),this.mouseDragger._isDragStart||(c={},f=Math.trunc(a.deltaY||-a.wheelDelta),e=5*f,this.isHorizontal()?(b=this.track.width(),c.x=e):(b=this.track.height(),c.y=e),c.option={lengthValue:b},d.call(this,c))}function i(b,c,d){return b>d?100:b<c?0:a.fixedNumber(b/d*100,2)}a.ctrls.define("ui.ctrls.Slidebar",{_defineOption:function(){return{direction:"horizontal",iframeShield:!1,thickness:8,readonly:!1,disabled:!1}},_defineEvents:function(){return["changed"]},_create:function(){var a;this.percent=0,a=this.element.css("position"),"absolute"!==a&&"relative"!==a&&"fixed"!==a&&this.element.css("position","relative"),this.element.addClass("ui-slidebar"),this.defineProperty("readonly",this.getReadonly,this.setReadonly),this.defineProperty("disabled",this.getDisabled,this.setDisabled),this.defineProperty("percentValue",this.getPercent,this.setPercent),this.onMouseupHandler=g.bind(this),this.onMouseWheelHandler=h.bind(this)},_render:function(){this.track=b("<div class='ui-slidebar-track' />"),this.valuebar=b("<div class='ui-slidebar-value' />"),this.thumb=b("<b class='ui-slidebar-thumb' />"),this.track.append(this.valuebar),this.element.append(this.track).append(this.thumb),this._initScale(),this._initMouseDragger(),this.track.on("mouseup",this.onMouseupHandler),this.element.on("wheel",this.onMouseWheelHandler),this.readonly=this.option.readonly,this.disabled=this.option.disabled},_initScale:function(){var a=this.option.thickness,b=2*a;this.thumb.css({width:b+"px",height:b+"px"}),this.isHorizontal()?(this.track.css({width:"100%",height:a+"px",top:(b-a)/2+"px"}),this.valuebar.css("width","0"),this.thumb.css("left",-b/2+"px"),this.element.css("height",b+"px")):(this.track.css({width:a+"px",height:"100%",left:(b-a)/2+"px"}),this.valuebar.css({top:"100%",height:"0"}),this.thumb.css("top",this.track.height()-b/2+"px"),this.element.css("width",b+"px"))},_initMouseDragger:function(){var b={target:this.thumb,handle:this.thumb,context:this,onBeginDrag:function(a){var b=a.option,d=b.context;c.call(d,a)},onMoving:function(a){var b=a.option,c=b.context;d.call(c,a)}};this.mouseDragger=new a.MouseDragger(b)},isHorizontal:function(){return"horizontal"===this.option.direction},getReadonly:function(){return this.option.readonly},setReadonly:function(a){this.option.readonly=!!a,this.option.readonly?(this.mouseDragger.off(),this.valuebar.removeClass("background-highlight"),this.thumb.removeClass("background-highlight")):(this.mouseDragger.on(),this.valuebar.addClass("background-highlight"),this.thumb.addClass("background-highlight"))},getDisabled:function(){return this.option.disabled},setDisabled:function(a){this.option.disabled=!!a,this.option.disabled?(this.mouseDragger.off(),this.valuebar.removeClass("background-highlight"),this.thumb.removeClass("background-highlight")):(this.mouseDragger.on(),this.valuebar.addClass("background-highlight"),this.thumb.addClass("background-highlight"))},getPercent:function(){return this.percent},setPercent:function(b){var c,e={option:{}};c=b,a.core.isNumber(c)&&(c<0?c=0:c>100&&(c=100),this.isHorizontal()?(e.option.lengthValue=this.track.width(),e.x=e.option.lengthValue*c/100):(e.option.lengthValue=this.track.height(),e.y=e.option.lengthValue*(0-c)/100),d.call(this,e))}}),b.fn.slidebar=function(b){return 0===this.length?null:a.ctrls.Slidebar(b,this)}}(ui,ui.$),function(a,b){var c,d,e;c={open:function(){var a;this.animator.stop(),this.switchBox.addClass("switch-open"),this.inner.addClass("border-highlight").addClass("background-highlight"),a=this.animator[0],a.beginColor=this.option.thumbColor,a.endColor="#FFFFFF",a.begin=0,a.end=100,a=this.animator[1],a.begin=parseFloat(a.target.css("left")),a.end=this.width-this.thumbSize-4,this.animator.start()},close:function(){var a;this.animator.stop(),this.switchBox.removeClass("switch-open"),this.inner.removeClass("border-highlight").removeClass("background-highlight"),a=this.animator[0],a.beginColor="#FFFFFF",a.endColor=this.option.thumbColor,a.begin=0,a.end=100,a=this.animator[1],a.begin=parseFloat(a.target.css("left")),a.end=4,this.animator.start()},thumbSize:16},d={init:function(){this.switchBox.addClass("switch-lollipop")},open:function(){var a;this.animator.stop(),this.switchBox.addClass("switch-open"),this.inner.addClass("background-highlight"),this.thumb.addClass("border-highlight").addClass("background-highlight"),a=this.animator[0],a.begin=0,a.end=0,a=this.animator[1],a.begin=parseFloat(a.target.css("left")),a.end=this.option.width-this.thumbSize,this.animator.start()},close:function(){var a;this.animator.stop(),this.switchBox.removeClass("switch-open"),this.inner.removeClass("background-highlight"),this.thumb.removeClass("border-highlight").removeClass("background-highlight"),a=this.animator[0],a.begin=0,a.end=0,a=this.animator[1],a.begin=parseFloat(a.target.css("left")),a.end=0,this.animator.start()},thumbSize:24},e={init:function(){this.switchBox.addClass("switch-marshmallow")},open:d.open,close:d.close,thumbSize:24},a.ctrls.define("ui.ctrls.SwitchButton",{_defineOption:function(){return{width:44,height:24,thumbColor:null,readonly:!1,style:null}},_defineEvents:function(){return["changed"]},_create:function(){var f,g;this.switchBox=b("<label class='ui-switch-button' />"),this.inner=b("<div class='switch-inner' />"),this.thumb=b("<div class='switch-thumb' />"),g=a.core.isString(this.option.style)?"lollipop"===this.option.style?d:"marshmallow"===this.option.style?e:c:a.core.isObject(this.option.style)?this.option.style:c,a.core.isFunction(g.init)&&g.init.call(this),this._open=g.open,this._close=g.close,this.thumbSize=g.thumbSize,this._createAnimator(),this.element.wrap(this.switchBox),this.switchBox=this.element.parent(),this.switchBox.append(this.inner).append(this.thumb),this.option.thumbColor?this.thumb.css("background-color",this.option.thumbColor):this.option.thumbColor=this.thumb.css("background-color"),this.width=this.option.width||parseFloat(this.switchBox.css("width")),this.height=this.option.height||parseFloat(this.switchBox.css("height")),f=this,this.element.change(function(a){f.onChange()}),this.defineProperty("readonly",this.getReadonly,this.setReadonly),this.defineProperty("value",this.getValue,this.setValue),this.defineProperty("checked",this.getChecked,this.setChecked),this.readonly=!!this.option.readonly,this.checked&&this._open()},_createAnimator:function(){this.animator=a.animator({target:this.thumb,ease:a.AnimationStyle.easeTo,onChange:function(b){var c=a.color.overlay(this.beginColor,this.endColor,b/100);c=a.color.rgb2hex(c.red,c.green,c.blue),this.target.css("background-color",c)}}).add({target:this.thumb,ease:a.AnimationStyle.easeFromTo,onChange:function(a,b){b.css("left",a+"px")}}),this.animator.duration=200},onChange:function(){var a=this.element.prop("checked");if(this.readonly)return void this.element.prop("checked",!a);a?this._open():this._close(),this.fire("changed")},_isOpen:function(){return this.switchBox.hasClass("switch-open")},getReadonly:function(){return!!this.option.readonly},setReadonly:function(a){this.option.readonly=!!a,this.option.readonly?this.element.attr("readonly","readonly"):this.element.removeAttr("readonly")},getValue:function(){return this.element.val()},setValue:function(a){this.element.val(a)},getChecked:function(){return this.element.prop("checked")},setChecked:function(a){var b=this.element.prop("checked");!!arguments[0]!==b?(this.element.prop("checked",arguments[0]),this.onChange()):b&&!this._isOpen()?this._open():!b&&this._isOpen()&&this._close()}}),b.fn.switchButton=function(b){if(0===this.length)return null;if("INPUT"!==this.nodeName()&&"checkbox"!==this.prop("type"))throw new TypeError("the element is not checkbox");return a.ctrls.SwitchButton(b,this)}}(ui,ui.$),function(a,b){function c(){Object.keys(g).forEach(function(a){d(a,g[a])})}function d(b,c){var d,e=a.theme.backgroundColor||"#FFFFFF";d=a.color.overlay(e,c,.2),d=a.color.rgb2hex(d.red,d.green,d.blue),h||(h=a.StyleSheet.createStyleSheet("uiTagStyle")),h.setRule(a.str.format(".ui-tag-{0}",b),{"background-color":d,"border-color":c,color:c}),h.setRule(a.str.format(".ui-tag-{0} .ui-tag-close:hover",b),{"background-color":c,color:d})}var e,f={mini:16,small:20,normal:24,big:28},g={green:"#00AE6E",red:"#DE2B18",yellow:"#CCA700",purple:"#6064C5",blue:"#026AD8"},h=null;e=function(){a.on("click",".ui-tag",function(a){var c=b(a.target);if(c.hasClass("ui-tag-close"))c.parent().data("ui.ctrls.Tag").remove();else{for(;!c.hasClass("ui-tag");){if("BODY"===c.nodeName())return;c=c.parent()}c.data("ui.ctrls.Tag").fire("click")}}),e=function(){}},a.ctrls.define("ui.ctrls.Tag",{_defineOption:function(){return{color:"highlight",size:"normal",closable:!1,noBorder:!1,text:"Tag",marginRight:!1}},_defineEvents:function(){return["click","close"]},_create:function(){
a.core.isNumber(this.option.size)?this.height=this.option.size:this.height=f[this.option.size||"normal"]||f.normal,this.contentMargin=this.height/2,this.option.noBorder?this.borderWidth=0:this.borderWidth=1,this.defineProperty("text",this.getText,this.setText),c.isInitialized||(c(),c.isInitialized=!0),e()},_render:function(){var c=this.height-2*this.borderWidth;this.label=b("<label class='ui-tag' />"),this.label.css({height:this.height+"px","line-height":c+"px","border-radius":this.height/2+"px"}),this.option.marginRight&&this.label.css("margin-right",this.contentMargin+"px"),a.core.isString(this.option.color)?this.label.addClass(a.str.format("ui-tag-{0}",this.option.color)):this.label.addClass("ui-tag-highlight"),this.label.append(this._createContent()),this.option.closable&&this.label.append(this._createCloseButton()),this.option.noBorder&&this.label.addClass("ui-tag-noborder"),this.label.data(this.fullName,this),this.element&&this.element.append(this.label)},_createContent:function(){var a=b("<span />");return a.css("margin-left",this.contentMargin+"px"),this.option.closable||a.css("margin-right",this.contentMargin+"px"),this.content=a,this.setText(this.option.text),a},_createCloseButton:function(){var a,c,d,e,f,g;return c=this.height-2*this.borderWidth,d=e=c-6,f=g=3,e<14&&(d=e=14,f=g=(c-e)/2),a=b("<i href='javascript:void(0)'>×</i>"),a.addClass("ui-tag-close"),this.height<=20&&a.css("font-size","14px"),a.css({width:d+"px",height:e+"px","line-height":e-2+"px","margin-top":f+"px","margin-left":g+"px","margin-right":g+"px"}),this.closeButton=a,a},addTo:function(b){var b=a.getJQueryElement(b);b&&b.append(this.label)},remove:function(){this.fire("close"),this.label.removeData(this.fullName),this.label.remove()},setText:function(b){this.option.text=b||"Tag",a.core.isFunction(b)?this.content.append(b.call(null)):this.content.text(b)},getText:function(){return this.option.text}}),a.ctrls.Tag.addColor=function(b,c){if(g[b])throw new TypeError("the name "+b+" is exists.");a.core.isString(c)&&c&&(g[b]=c,d(b,c))}}(ui,ui.$),function(a,b){function c(){}function d(a){return 400===a?"上传文件请求格式错误":401===a?"需要登录以后才能上传文件":403===a?"您没有上传文件的权限，请联系管理员":404===a?"上传地址不存在，请联系管理员":"上传文件发生错误"}function e(a){this._reset(),this.fire("selected",this._inputFile[0]),this.option.autoUpload&&this.upload()}var f,g,h,i=0,j=a.core.global();h=j.FormData?function(){function b(b,h,i,j,k){var l,m,n,o;f.percent=Math.floor(h/j*1e3)/10,f.fire("progressing",f.percent),l=!1,g===c?(l=!0,m=j,n=i):(m=h+f.chunkSize,n=null,m>=j&&(m=j,l=!0),n=g.call(i,h,m)),o={fileInfo:{isEnd:l,isAbort:f.isAbort,fileName:b,index:h,end:m,total:j,fileId:k||""},file:i},a.upload(f.option.url,n,o.fileInfo,function(a){e(a.data,a.ajaxRequest,o)},function(a){var b;b=a.ajaxRequest.status,d(b),f.fire()},"json")}function e(c,e,g){var h,i=e.getResponseHeader("X-Responded-JSON");if(a.str.isEmpty(i))g.isEnd?(f.percent=100,f.fire("progressing",f.percent),f.fire("uploaded",c)):(h=g.fileInfo,h.isAbort?this.fire("uploaded",h):(h.fileId=c.fileId,b(h.fileName,h.end,h.file,h.total,h.fileId)));else try{i=JSON.parse(i),d(i.status)}catch(a){i=null,d()}}var f=this;this._upload=function(){var a,d,e,f,h,i,j,k;if((a=this._inputFile[0].files)&&0!==a.length){if(d=a[0],e=d.fileName||d.name,f=0,h=d.size,!g){for(k=["slice","webkitSlice","mozSlice"],i=0;i<k.length;i++)if((j=k[i])in d){g=function(a,b){return this[j](a,b)};break}g||(g=c)}b(e,f,d,h)}}}:function(){var a=b("<div class='ui-uploader-panel' />"),c="uploadFrameId_"+this._uploaderId;this._iframe=b("<iframe class='form-upload-iframe' />"),this._iframe.prop("id",c),this._iframe.prop("name",c),this._form=b("<form />"),this._form.attr("method","post"),this._form.attr("action",this.option.url),this._form.attr("enctype","multipart/form-data"),this._form.attr("target",c),this._form.append(this._inputFile),a.append(this._iframe),a.append(this._form),b(document.body).append(a),this._iframe[0].onload=function(){var a,b,c;if(this.percent=100,this.fire("progressing",this.percent),a=this._iframe[0].contentWindow,b=a.fileInfo,c=a.error,!b&&!c)return void this.fire("error",d());c?(c=error.errorMessage||d(),this.fire("error",c)):this.fire("uploaded",b)}.bind(this),f||(f=b("<input type='text' value='' style='position:absolute;left:-99px;top:-1px;width:0;height:0;' />"),(document.body||document.documentElement).insertBefore(f[0],null)),this._upload=function(){this.percent=20,this.fire("progressing",this.percent),this._form.submit(),f.focus()}},a.ctrls.define("ui.ctrls.Uploader",{_defineOption:function(){return{url:null,autoUpload:!0,chunkSize:512,filter:"*.*"}},_defineEvents:function(){return["selected","uploading","uploaded","progressing","error"]},_create:function(){this._uploaderId=++i,this._form=null,this._inputFile=null,this.chunkSize=1024*this.option.chunkSize||524288,this.onInputFileChangeHandler=e.bind(this),this._reset()},_render:function(){this._initUploadButton(),h.call(this)},_initUploadButton:function(){var a="inputFile_"+this._uploaderId;if(this.element||(this.element=b("<label />")),"LABEL"!==this.element.nodeName())throw TypeError("the element must be label element");this.element.addClass("ui-uploader-button"),this.element.prop("for",a),this._inputFile=b("<input type='file' class='ui-uploader-input-file' value='' />"),this._inputFile.prop("id",a),this._inputFile.prop("name",this._uploaderId),this._inputFile.change(this.onInputFileChangeHandler),this.element.append(this._inputFile)},_reset:function(){this.filePath=null,this.extension=null,this.fileName=null,this.percent=0,this.isAbort=!1},checkFile:function(a){var b=a.lastIndexOf(".");return-1!==b&&(this.fileName=a.substring(a.lastIndexOf("\\")+1,b),this.extension=a.substring(b).toLowerCase().trim(),"*.*"===this.option.filter||-1!==this.option.filter.indexOf(this.extension))},upload:function(){var a=this._inputFile.val();if(0===a.length)return void this.fire("error","没有选择要上传的文件");if(!this.checkFile(a))return void this.fire("error","不支持上传当前选择的文件格式");if(!this.option.url)throw new TypeError("the upload url is null.");!1!==this.fire("uploading",a)&&(this._upload(),this._inputFile.val(""))},abort:function(){this.isAbort=!0}}),b.fn.uploader=function(b){return 0===this.length?null:a.ctrls.Uploader(b,this)}}(ui,ui.$),function(a,b){function c(a){var c,d=b(a.target),e=d.nodeName();d.hasClass("chooser-queue")||("IMG"===e&&(d=d.parent()),c=parseInt(d.attr("data-index"),10),!1!==this.fire("changing",c)&&!1!==this.selectItem(c)&&this.imageViewer.showImage(c))}a.ctrls.define("ui.ctrls.ImagePreview",{_defineOption:function(){return{chooserButtonSize:16,imageMargin:10,direction:"horizontal"}},_defineEvents:function(){return["changing","changed","ready"]},_create:function(){if(this.element.addClass("image-preview"),this.viewer=this.element.children(".image-view-panel"),this.chooser=this.element.children(".image-preview-chooser"),0===this.viewer.length)throw new TypeError("需要设置一个class为image-view-panel的元素");if(0===this.chooser.length)throw new TypeError("需要设置一个class为image-preview-chooser的元素");this.isHorizontal="horizontal"===this.option.direction,(!a.core.type(this.option.chooserButtonSize)||this.option.chooserButtonSize<2)&&(this.option.chooserButtonSize=16),this.item=[],this._onChooserItemClickHandler=c.bind(this)},_render:function(){var c,d,e;this.chooserQueue=b("<div class='chooser-queue' />"),this.chooserPrev=b("<a href='javascript:void(0)' class='chooser-button font-highlight-hover'></a>"),this.chooserNext=b("<a href='javascript:void(0)' class='chooser-button font-highlight-hover'></a>"),this.chooser.append(this.chooserPrev).append(this.chooserQueue).append(this.chooserNext),e=this,this.chooserPrev.on("click",function(a){e.beforeItems()}),this.chooserNext.on("click",function(a){e.afterItems()}),this.chooserAnimator=a.animator({target:this.chooserQueue,ease:a.AnimationStyle.easeFromTo}),c=this.option.chooserButtonSize,this.isHorizontal?(this.smallImageSize=this.chooser.height(),this.chooserAnimator[0].onChange=function(a){this.target[0].scrollLeft=a},d={width:c+"px",height:"100%"},this.chooserPrev.append("<i class='far fa-angle-left'></i>").css(d),this.chooserNext.append("<i class='far fa-angle-right'></i>").css(d).css("right","0px"),this.isOverflow=function(){return this.chooserQueue[0].scrollWidth>this.chooserQueue.width()},this.showChooserButtons=function(){this.chooserPrev.css("display","block"),this.chooserNext.css("display","block"),this.chooserQueue.css({left:c+"px",width:this.chooser.width()-2*this.option.chooserButtonSize+"px"})},this.hideChooserButtons=function(){this.chooserPrev.css("display","none"),this.chooserNext.css("display","none"),this.chooserQueue.css({left:"0px",width:"100%"})}):(this.smallImageSize=this.chooser.width(),this.chooserAnimator[0].onChange=function(a){this.target.scrollTop(a)},d={height:c+"px",width:"100%","line-height":c+"px"},this.chooserPrev.append("<i class='far fa-angle-up'></i>").css(d),this.chooserNext.append("<i class='far fa-angle-down'></i>").css(d).css("bottom","0px"),d={display:"block"},this.isOverflow=function(){return this.chooserQueue[0].scrollHeight>this.chooserQueue.height()},this.showChooserButtons=function(){this.chooserPrev.css("display","block"),this.chooserNext.css("display","block"),this.chooserQueue.css({top:c+"px",height:this.chooser.height()-2*c+"px"})},this.hideChooserButtons=function(){this.chooserPrev.css("display","none"),this.chooserNext.css("display","none"),this.chooserQueue.css({top:"0px",height:"100%"})}),this.chooserQueue.on("click",this._onChooserItemClickHandler),this.setImages(this.option.images)},_initImages:function(a){var c,d,e,f,g,h,i,j,k,l;for(e=0,d=this.smallImageSize-4,c=d,this.imageSource=a,f=0,g=a.length;f<g;f++)h=a[f],l=this._getImageDisplay(c,d,h.width,h.height),i=b("<div class='small-img' />"),i.attr("data-index",f),j=b("<img alt='' />"),j.css({width:l.width,height:l.height,"margin-top":l.top,"margin-left":l.left}),j.prop("src",h.src),i.append(j),this.chooserQueue.append(i),k=i.getBoundingClientRect(),this.isHorizontal?(i.css("left",e+"px"),e+=this.option.imageMargin+k.width):(i.css("top",e+"px"),e+=this.option.imageMargin+k.height),this.items.push(i);this.isOverflow()?this.showChooserButtons():this.hideChooserButtons(),this.imageViewer.currentIndex>=0&&(this.selectItem(this.imageViewer.currentIndex),this.fire("changed",this.imageViewer.currentIndex))},_getImageDisplay:function(b,c,d,e){var f={width:b,height:c,originalWidth:d,originalHeight:e};return a.ImageLoader.centerCrop.call(f),{width:f.displayWidth+"px",height:f.displayHeight+"px",top:f.marginTop+"px",left:f.marginLeft+"px"}},selectItem:function(a){var b=this.items[a];if(this.currentChooser){if(this.currentChooser[0]===b[0])return!1;this.currentChooser.removeClass("chooser-selected").removeClass("border-highlight")}this.currentChooser=b,this.currentChooser.addClass("chooser-selected").addClass("border-highlight"),this.isOverflow()&&this._moveChooserQueue(a)},clear:function(){this.items=[],this.chooserQueue.empty(),this.imageViewer&&this.imageViewer.clear()},setImages:function(a){var b;Array.isArray(a)&&0!==a.length&&(this.clear(),this.option.images=a,this.imageViewer?this.imageViewer.setImages(a):(this.imageViewer=this.viewer.imageViewer(this.option),b=this,this.imageViewer.ready(function(a,c){b._initImages(c),b.fire("ready")}),this.imageViewer.changed(function(a,c){b.selectItem(c),b.fire("changed",c)})))},_caculateScrollValue:function(a){var b,c,d,e;return this.isHorizontal?(d=this.chooserQueue.width(),b=this.chooserQueue[0].scrollLeft,e=this.chooserQueue[0].scrollWidth):(d=this.chooserQueue.height(),b=this.chooserQueue.scrollTop(),e=this.chooserQueue[0].scrollHeight),c=a.call(this,d,b),c<0?c=0:c>e-d&&(c=e-d),{from:b,to:c}},_moveChooserQueue:function(a){var b=this._caculateScrollValue(function(b,c){var d=this.smallImageSize+this.option.imageMargin,e=Math.floor(b/d),f=Math.floor(e/2),g=a-f;return g<0?0:g+e>this.items.length-1?this.items.length*d:g*d});this._setScrollValue(b)},_setScrollValue:function(a){var b;isNaN(a.to)||(this.chooserAnimator.stop(),b=this.chooserAnimator[0],Math.abs(a.from-a.to)<this.smallImageSize?b.onChange.call(b,a.to):(b.begin=a.from,b.end=a.to,this.chooserAnimator.start()))},beforeItems:function(){var a=this._caculateScrollValue(function(a,b){var c=this.smallImageSize+this.option.imageMargin,d=Math.floor(a/c);return(Math.floor(b/c)+-1*d)*c});this._setScrollValue(a)},afterItems:function(){var a=this._caculateScrollValue(function(a,b){var c=this.smallImageSize+this.option.imageMargin,d=Math.floor(a/c);return(Math.floor(b/c)+d)*c});this._setScrollValue(a)}}),b.fn.imagePreview=function(b){if(0!==this.length)return a.ctrls.ImagePreview(b,this)}}(ui,ui.$),function(a,b){a.ctrls.define("ui.ctrls.ImageViewer",{_defineOption:function(){return{hasSwitchButtom:!1,interval:2e3,direction:"horizontal",images:[]}},_defineEvents:function(){return["changed","ready"]},_create:function(){Array.isArray(this.option.images)||(this.option.images=[]),!a.core.isNumber(this.option.interval)||this.option.interval<=0?this.isAutoView=!1:this.isAutoView=!0,this.stopAutoView=!1,this.currentIndex=-1,this.images=[],this.isHorizontal="horizontal"===this.option.direction,this.animationCssItem=this.isHorizontal?"left":"top"},_render:function(){var a=this;this.element.addClass("image-view-panel"),this.currentView=null,this.nextView=null,this._initAnimator(),this._loadImages(this.option.images),this.isAutoView&&(this.element.mouseenter(function(b){a.stopAutoView=!0,a._autoViewHandler&&clearTimeout(a._autoViewHandler)}),this.element.mouseleave(function(b){a.stopAutoView=!1,a._autoViewHandler=setTimeout(function(){a.next()},a.option.interval)}))},_initAnimator:function(){var b=this;this.viewAnimator=a.animator({ease:a.AnimationStyle.easeTo,onChange:function(a){this.target.css(b.animationCssItem,a+"px")}}).add({ease:a.AnimationStyle.easeTo,onChange:function(a){this.target.css(b.animationCssItem,a+"px")}}),this.viewAnimator.onEnd=function(){b.currentView.css("display","none"),b.currentView=b.nextView,b.nextView=null,b.isAutoView&&!b.stopAutoView&&(b._autoViewHandler=setTimeout(function(){b.next()},b.option.interval)),b.fire("changed",b.currentIndex,b.images[b.currentIndex])},this.viewAnimator.duration=500},setImages:function(){if(0!==arguments.length){this.clear();for(var b=[],c=0,d=arguments.length,e=null;c<d;c++)e=arguments[c],Array.isArray(e)?b=b.concat(e):"string"===a.core.type(e)&&b.push(e);this._loadImages(b)}},_loadImages:function(a){if(0!==a.length){!0===this.option.hasSwitchButtom&&(this.prevBtn=b("<a href='javascript:void(0)' class='image-switch-button switch-button-prev font-highlight-hover'><i class='far fa-angle-left'></i></a>"),this.nextBtn=b("<a href='javascript:void(0)' class='image-switch-button switch-button-next font-highlight-hover'><i class='far fa-angle-right'></i></a>"),this.prevBtn.on("click",function(a){this.prev()}.bind(this)),this.nextBtn.on("click",function(a){this.next()}.bind(this)),this.element.append(this.prevBtn).append(this.nextBtn));for(var c=[],d=0,e=this;d<a.length;d++)c.push(this._loadImage(a[d]));Promise.all(c).then(function(a){for(var c,d=0,f=a.length;d<f;d++)(c=a[d])&&(c.view=b("<div class='image-view' />"),c.view.append("<img src='"+c.src+"' alt='' />"),e.element.append(c.view),e.images.push(c));e.images.length>0&&e.showImage(0),e.fire("ready",e.images)})}},_loadImage:function(b){if("string"===a.core.type(b)&&0!==b.length){return new Promise(function(a,c){var d=new Image;d.onload=function(){d.onload=null,a({src:b,width:d.width,height:d.height})},d.onerror=function(){a(null)},d.src=b})}},_startView:function(a){this.viewAnimator.stop();var b,c=this.element.width(),d=this.element.height(),e=this.isHorizontal?c:d;b=this.viewAnimator[0],b.target=this.currentView,b.begin=parseFloat(b.target.css(this.animationCssItem)),b.end=a?-e:e,b=this.viewAnimator[1],b.target=this.nextView,b.begin=parseFloat(b.target.css(this.animationCssItem)),b.end=0,this.viewAnimator.start()},_setImage:function(a,b){var c,d,e=this.images[a],f=this.element.width(),g=this.element.height(),h=null;b=b||this.currentView,h=b.children("img"),f>g?(d=g,c=Math.floor(e.width*(d/e.height)),c>f?(c=f,d=Math.floor(e.height*(c/e.width)),h.css("top",Math.floor((g-d)/2)+"px")):h.css("left",Math.floor((f-c)/2)+"px")):(c=f,d=Math.floor(e.height*(c/e.width)),d>g?(d=g,c=Math.floor(e.width*(d/e.height)),h.css("left",Math.floor((f-c)/2)+"px")):h.css("top",Math.floor((g-d)/2)+"px")),h.css({width:c+"px",height:d+"px"})},showImage:function(a){if(0!==this.images.length){this._autoViewHandler&&clearTimeout(this._autoViewHandler);var b,c=this.element.width(),d=this.element.height(),e=this,f={display:"block"},g=this.isHorizontal?c:d;if(this.element.css("overflow","hidden"),this.currentIndex<0)return this.currentIndex=a,this.currentView=this.images[this.currentIndex].view,this._setImage(a),this.currentView.css("display","block"),void(this.isAutoView&&(this._autoViewHandler=setTimeout(function(){e.next()},this.option.interval)));this.nextView&&(this.currentView.css("display","none").css(this.animationCssItem,-g+"px"),this.currentView=this.nextView,this.currentView.css(this.animationCssItem,"0px")),a>this.currentIndex?(a>=this.images.length&&(a=0),f[this.animationCssItem]=g+"px",b=!0):(a<0&&(a=this.images.length-1),f[this.animationCssItem]=-g+"px",b=!1),this.nextView=this.images[a].view,this.nextView.css(f),this._setImage(a,this.nextView),this.currentIndex=a,this._startView(b)}},prev:function(){this.currentIndex>=0?this.showImage(this.currentIndex-1):this.showImage(0)},next:function(){this.currentIndex>=0?this.showImage(this.currentIndex+1):this.showImage(0)},clear:function(){this.images=[],this.currentIndex=-1,this.viewAnimator.stop(),clearTimeout(this._autoViewHandler),this.element.empty(),this.prevBtn=null,this.nextBtn=null,this.currentView=null,this.nextView=null}}),b.fn.imageViewer=function(b){if(0!==this.length)return a.ctrls.ImageViewer(b,this)}}(ui,ui.$),function(a,b){a.ctrls.define("ui.ctrls.ImageWatcher",{_defineOption:function(){return{position:"right",zoomWidth:null,zoomHeight:null}},_create:function(){this.borderWidth=1,this.viewMargin=10,this.option.position=this.option.position.toLowerCase(),this.zoomWidth=this.option.zoomWidth,this.zoomHeight=this.option.zoomHeight,this.element.addClass("image-watch-panel"),this.focusView=b("<div class='focus-view border-highlight' />"),this.zoomView=b("<div class='zoom-view border-highlight' />"),this.zoomImage=b("<img alt='' />"),this.zoomView.append(this.zoomImage),this.element.append(this.focusView).append(this.zoomView)},_render:function(){this._initImage(),this._initZoomer()},_initImage:function(){if(this.image=b(this.element.children("img")[0]),0===this.image.length)throw new Error("元素中没有图片，无法使用图片局部查看器");this.imageOffsetWidth=this.image.width(),this.imageOffsetHeight=this.image.height(),this.image.css({width:"auto",height:"auto"}),this.imageWidth=this.image.width(),this.imageHeight=this.image.height(),this.image.css({width:this.imageOffsetWidth+"px",height:this.imageOffsetHeight+"px"}),this.zoomImage.prop("src",this.image.prop("src"))},_initZoomer:function(){var b=this;a.core.isNumber(this.option.zoomHeight)||(this.zoomHeight=this.element.height()),a.core.isNumber(this.option.zoomWidth)||(this.zoomWidth=this.zoomHeight),this.zoomView.css({width:this.zoomWidth-2*this.borderWidth+"px",height:this.zoomHeight-2*this.borderWidth+"px"}),this.element.mouseenter(function(a){b.start=!0,b._setFocusView(a),b._setZoomView()}).mousemove(function(a){b.start&&(b._setFocusView(a),b._setZoomView())}).mouseleave(function(a){b.start=!1,b.focusView.css("display","none"),b.zoomView.css("display","none")})},_setFocusView:function(a){var b,c,d=this.image.offset(),e=a.clientX-d.left,f=a.clientY-d.top,g=this.imageOffsetWidth/this.imageWidth,h=this.zoomWidth*g,i=this.zoomHeight*g,j=this.element.offset(),k=d.top-j.top,l=d.left-j.left;if(e<0||e>this.imageOffsetWidth||f<0||f>this.imageOffsetHeight)return void this.focusView.css("display","none");c=e+l-h/2,c<l?c=l:c+h>this.imageOffsetWidth+l&&(c=this.imageOffsetWidth+l-h),b=f+k-i/2,b<k?b=k:b+i>this.imageOffsetHeight+k&&(b=this.imageOffsetHeight+k-i),this.focusView.css({display:"block",width:h-2*this.borderWidth+"px",height:i-2*this.borderWidth+"px",top:b+"px",left:c+"px"}),this.topRatio=(b-k)/this.imageOffsetHeight,this.leftRatio=(c-l)/this.imageOffsetWidth},_setZoomView:function(){var a,b,c;if("none"===this.focusView.css("display"))return void this.zoomView.css("display","none");c=this.element.getBoundingClientRect(),"top"===this.option.position?(b=0,a=-(this.zoomHeight+this.viewMargin)):"bottom"===this.option.position?(b=0,a=c.height+this.viewMargin):"left"===this.option.position?(b=-(this.zoomWidth+this.viewMargin),a=0):(b=c.width+this.viewMargin,a=0),this.zoomView.css({display:"block",top:a+"px",left:b+"px"}),this.zoomImage.css({top:-this.imageHeight*this.topRatio+"px",left:-this.imageWidth*this.leftRatio+"px"})}}),b.fn.imageWatcher=function(b){if(0!==this.length)return a.ctrls.ImageWatcher(b,this)}}(ui,ui.$),function(a,b){function c(a){var b=a.attr("data-large-src");return b||(b=a.prop("src")),b}function d(a){return new Promise(function(b,c){var d=new Image,e={src:a,width:-1,height:-1};d.onload=function(){d.onload=null,e.width=d.width,e.height=d.height,b(e)},d.onerror=function(){c(e)},d.src=a})}a.ctrls.define("ui.ctrls.ImageZoomer",{_defineOption:function(){return{parentContent:b(document.body),getNext:null,getPrev:null,hasNext:null,hasPrev:null,getLargeImageSrc:null}},_defineEvents:function(){return["hided"]},_create:function(){var d=this;this.parentContent=this.option.parentContent,this.closeButton=null,this.mask=null,this.width=null,this.height=null,this.target=null,this.targetTop=null,this.targetLeft=null,b.isFunction(this.option.getLargeImageSrc)?this._getLargeImageSrc=this.option.getLargeImageSrc:this._getLargeImageSrc=c,this._isKeydownEnabled=!1,["getNext","getPrev","hasNext","hasPrev"].forEach(function(b){var c=d.option[b];a.core.isFunction(c)?d.option[b]=c.bind(d):d.option[b]=null})},_render:function(){var c=this;this.imagePanel=b("<div class='show-image-panel' />"),this.currentView=b("<div class='image-view-panel' style='display:none;' />"),this.nextView=b("<div class='image-view-panel' style='display:none;' />"),this.currentView.append("<img class='image-view-img' />"),this.nextView.append("<img class='image-view-img' />"),this.closeButton=b("<a class='closable-button font-highlight-hover' href='javascript:void(0)'>×</a>"),this.closeButton.on("click",function(){c.hide()}),this.imagePanel.append(this.currentView).append(this.nextView).append(this.closeButton),this.option.getNext&&(this.nextButton=b("<a class='next-button font-highlight-hover disabled-button' style='right:10px;' href='javascript:void(0)'><i class='far fa-angle-right'></i></a>"),this.nextButton.on("click",function(a){c._doNextView()}),this.imagePanel.append(this.nextButton)),this.option.getPrev&&(this.prevButton=b("<a class='prev-button font-highlight-hover disabled-button' style='left:10px;' href='javascript:void(0)'><i class='far fa-angle-left'></i></a>"),this.prevButton.on("click",function(a){c._doPrevView()}),this.imagePanel.append(this.prevButton)),b(document.body).append(this.imagePanel),a.page.resize(function(a){c.resizeZoomImage()},a.eventPriority.ctrlResize),b(document).keydown(function(b){c._isKeydownEnabled&&(b.which===a.keyCode.LEFT?c._doPrevView():b.which===a.keyCode.RIGHT?c._doNextView():b.which===a.keyCode.ESCAPE&&c.hide())}),this.zoomAnimator=a.animator({ease:a.AnimationStyle.easeFromTo,onChange:function(a){this.target.css("top",a+"px")}}).add({ease:a.AnimationStyle.easeFromTo,onChange:function(a){this.target.css("left",a+"px")}}).add({ease:a.AnimationStyle.easeFromTo,onChange:function(a){this.target.css("width",a+"px")}}).add({ease:a.AnimationStyle.easeFromTo,onChange:function(a){this.target.css("height",a+"px")}}),this.zoomAnimator.duration=300,(this.prevButton||this.nextButton)&&(this.changeViewAnimator=a.animator({ease:a.AnimationStyle.easeFromTo,onChange:function(a){this.target.css("left",a+"px")}}).add({ease:a.AnimationStyle.easeFromTo,onChange:function(a){this.target.css("left",a+"px")}}))},_showOptionButtons:function(){this.prevButton&&this.prevButton.removeClass("disabled-button"),this.nextButton&&this.nextButton.removeClass("disabled-button")},_hideOptionButtons:function(){this.prevButton&&this.prevButton.addClass("disabled-button"),this.nextButton&&this.nextButton.addClass("disabled-button")},_updateButtonState:function(){this.option.hasNext&&(this.option.hasNext()?this.nextButton.removeClass("disabled-button"):this.nextButton.addClass("disabled-button")),this.option.hasPrev&&(this.option.hasPrev()?this.prevButton.removeClass("disabled-button"):this.prevButton.addClass("disabled-button"))},show:function(b){var c,d,e,f,g,h;this.target=b;var i=this._setImageSize();i&&(d={width:this.target.width(),height:this.target.height()},this._isKeydownEnabled=!0,c=this.currentView.children("img"),c.prop("src",this.target.prop("src")),c.css({width:d.width+"px",height:d.height+"px",left:this.targetLeft+"px",top:this.targetTop+"px"}),this.imagePanel.css({display:"block",width:i.parentW+"px",height:i.parentH+"px",left:i.parentLoc.left+"px",top:i.parentLoc.top+"px"}),this.currentView.css("display","block"),g=(i.parentW-this.width)/2,h=(i.parentH-this.height)/2,e=this,a.mask.open({opacity:.8}),f=this.zoomAnimator[0],f.target=c,f.begin=this.targetTop,f.end=h,f=this.zoomAnimator[1],f.target=c,f.begin=this.targetLeft,f.end=g,f=this.zoomAnimator[2],f.target=c,f.begin=d.width,f.end=this.width,f=this.zoomAnimator[3],f.target=c,f.begin=d.height,f.end=this.height,this.zoomAnimator.start().then(function(){e._updateButtonState()}))},hide:function(){var b,c=this,d=this.currentView.children("img");this.target.width(),this.target.height(),this._isKeydownEnabled=!1,a.mask.close(),b=this.zoomAnimator[0],b.target=d,b.begin=parseFloat(d.css("top")),b.end=this.targetTop,b=this.zoomAnimator[1],b.target=d,b.begin=parseFloat(d.css("left")),b.end=this.targetLeft,b=this.zoomAnimator[2],b.target=d,b.begin=parseFloat(d.css("width")),b.end=this.target.width(),b=this.zoomAnimator[3],b.target=d,b.begin=parseFloat(d.css("height")),b.end=this.target.height(),this.zoomAnimator.start().then(function(){c._hideOptionButtons(),c.imagePanel.css("display","none"),c.currentView.css("display","none"),c.fire("hided",c.target)})},_doNextView:function(){var a;this.changeViewAnimator.isStarted||(a=this.option.getNext())&&this._doChangeView(a,function(){this.target=a,this._updateButtonState(),this._changeView(-this.parentContent.width())})},_doPrevView:function(){var a;this.changeViewAnimator.isStarted||(a=this.option.getPrev())&&this._doChangeView(a,function(){this.target=a,this._updateButtonState(),this._changeView(this.parentContent.width())})},_doChangeView:function(a,b){var c=a.data("LargeSize"),e=this;c?b.call(this):d(this._getLargeImageSrc(a)).then(function(c){a.data("LargeSize",c),b.call(e)},function(a){b.call(e)})},_changeView:function(a){var b,c,d,e,f,g;b=this.currentView,this.currentView=this.nextView,this.nextView=b,c=this._getLargeImageSrc(this.target),(d=this._setImageSize())&&(e=this.currentView.children("img"),e.prop("src",c),e.css({left:(d.parentW-this.width)/2+"px",top:(d.parentH-this.height)/2+"px",width:this.width+"px",height:this.height+"px"}),this.currentView.css("display","block"),this.currentView.css("left",-a+"px"),f=this.changeViewAnimator[0],f.target=this.nextView,f.begin=0,f.end=a,f=this.changeViewAnimator[1],f.target=this.currentView,f.begin=-a,f.end=0,g=this,this.changeViewAnimator.start().then(function(){g.nextView.css("display","none")}))},resizeZoomImage:function(){var a,b,c,d;(a=this._setImageSize())&&(b=(a.parentW-this.width)/2,c=(a.parentH-this.height)/2,this.imagePanel.css({width:a.parentW+"px",height:a.parentH+"px"}),d=this.currentView.children("img"),d.css({left:b+"px",top:c+"px",width:this.width+"px",height:this.height+"px"}))},_getActualSize:function(a){var b,c,d,e=a.data("LargeSize");return e||(b={w:a.width(),h:a.height()},a.css({width:"auto",height:"auto"}),c=a.width(),d=a.height(),a.css({width:b.w+"px",height:b.h+"px"}),e={width:c,height:d}),e},_setImageSize:function(){var a,b,c,d,e,f,g;if(this.currentView&&this.target)return this.currentView.children("img"),this.zoomAnimator.stop(),a=this._getActualSize(this.target),c=this.parentContent.height(),b=this.parentContent.width(),d=a.width,e=a.height,d/b<e/c?(this.height=e>=c?c:e,this.width=Math.floor(d*(this.height/e))):(this.width=d>=b?b:e,this.height=Math.floor(e*(this.width/d))),f=this.target.offset(),g=this.parentContent.offset(),this.targetTop=f.top-g.top,this.targetLeft=f.left-g.left,{parentW:b,parentH:c,parentLoc:g}}}),b.fn.addImageZoomer=function(c){0!==this.length&&c instanceof a.ctrls.ImageZoomer&&this.on("click",function(a){var e=b(a.target);e.data("LargeSize")?c.show(e):d(c._getLargeImageSrc(e)).then(function(a){e.data("LargeSize",a),c.show(e)},function(a){c.show(e)})})}}(ui,ui.$);